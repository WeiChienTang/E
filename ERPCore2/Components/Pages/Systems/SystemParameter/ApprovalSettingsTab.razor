@* 審核管理 Tab *@

@inject IStringLocalizer<SharedResource> L

<div class="mt-2">
    <p class="text-muted mb-3">控制各單據類型的審核流程。啟用後，相關單據需經審核才能生效。</p>
    <div class="row row-cols-2 row-cols-md-3 row-cols-xl-4 g-2 mb-3">
        @foreach (var setting in approvalSettings)
        {
            var isEnabled = setting.GetValue();
            <div class="col">
                <div class="card h-100 @(isEnabled ? "border-success" : "border-secondary")">
                    <div class="card-body p-2 d-flex flex-column gap-1">
                        <div class="d-flex justify-content-between align-items-start">
                            <strong class="small">@setting.Label</strong>
                            <span class="badge @(isEnabled ? "bg-success" : "bg-secondary") ms-1 flex-shrink-0">
                                @(isEnabled ? "啟用" : "停用")
                            </span>
                        </div>
                        <div class="form-check form-switch mt-auto mb-0">
                            <input class="form-check-input"
                                   type="checkbox"
                                   role="switch"
                                   id="approval_@setting.Key"
                                   checked="@isEnabled"
                                   @onchange="@((e) => { setting.SetValue((bool)(e.Value ?? false)); StateHasChanged(); })" />
                            <label class="form-check-label small" for="approval_@setting.Key">開關</label>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

@code {
    [Parameter]
    public SystemParameter Model { get; set; } = new();

    private List<ApprovalSettingItem> approvalSettings = new();

    private record ApprovalSettingItem(string Key, string Label, Func<bool> GetValue, Action<bool> SetValue);

    protected override void OnInitialized()
    {
        approvalSettings = new List<ApprovalSettingItem>
        {
            new("quotation",         L["Field.EnableQuotationApproval"],         () => Model.EnableQuotationApproval,         v => Model.EnableQuotationApproval = v),
            new("purchaseOrder",     L["Field.EnablePurchaseOrderApproval"],     () => Model.EnablePurchaseOrderApproval,     v => Model.EnablePurchaseOrderApproval = v),
            new("purchaseReceiving", L["Field.EnablePurchaseReceivingApproval"], () => Model.EnablePurchaseReceivingApproval, v => Model.EnablePurchaseReceivingApproval = v),
            new("purchaseReturn",    L["Field.EnablePurchaseReturnApproval"],    () => Model.EnablePurchaseReturnApproval,    v => Model.EnablePurchaseReturnApproval = v),
            new("salesOrder",        L["Field.EnableSalesOrderApproval"],        () => Model.EnableSalesOrderApproval,       v => Model.EnableSalesOrderApproval = v),
            new("salesReturn",       L["Field.EnableSalesReturnApproval"],       () => Model.EnableSalesReturnApproval,      v => Model.EnableSalesReturnApproval = v),
            new("inventoryTransfer", L["Field.EnableInventoryTransferApproval"], () => Model.EnableInventoryTransferApproval, v => Model.EnableInventoryTransferApproval = v),
        };
    }
}
