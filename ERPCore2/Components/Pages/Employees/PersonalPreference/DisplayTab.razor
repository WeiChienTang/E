@* 顯示設定 Tab — 主題顏色 + 字型縮放 *@
@inject IStringLocalizer<SharedResource> L

<div class="p-2">

    @* 主題顏色 *@
    <div class="mb-1 fw-semibold text-secondary small text-uppercase">@L["Preference.Theme"]</div>
    <div class="d-flex gap-2 flex-wrap mb-4">
        @foreach (var option in _themeOptions)
        {
            var isSelected = (Model ?? _fallback).Theme == option.Value;
            <button type="button"
                    class="btn @(isSelected ? "btn-primary" : "btn-outline-secondary") theme-option-btn"
                    title="@option.Label"
                    @onclick="() => SelectTheme(option.Value)">
                <i class="bi @option.Icon theme-icon"></i>
                <span class="theme-label">@option.Label</span>
            </button>
        }
    </div>

    @* 字型縮放 *@
    <div class="mb-1 fw-semibold text-secondary small text-uppercase">@L["Preference.FontSize"]</div>
    <div class="d-flex gap-2 flex-wrap">
        @foreach (var option in _zoomOptions)
        {
            var isSelected = (Model ?? _fallback).Zoom == option.Value;
            <button type="button"
                    class="btn @(isSelected ? "btn-primary" : "btn-outline-secondary") zoom-option-btn"
                    title="@option.Label"
                    @onclick="() => SelectZoom(option.Value)">
                <span class="zoom-preview" style="font-size: @option.PreviewSize;">Aa</span>
                <span class="zoom-label">@option.Label</span>
            </button>
        }
    </div>

</div>

@code {
    [Parameter]
    public EmployeePreference? Model { get; set; }

    private readonly EmployeePreference _fallback = new();

    private record ThemeOption(AppTheme Value, string Label, string Icon);
    private record ZoomOption(ContentZoom Value, string Label, string PreviewSize);

    private List<ThemeOption> _themeOptions = new();

    private static readonly List<ZoomOption> _zoomOptions = new()
    {
        new(ContentZoom.XSmall,  "75%",  "0.75rem"),
        new(ContentZoom.Small,   "90%",  "0.9rem"),
        new(ContentZoom.Medium,  "100%", "1rem"),
        new(ContentZoom.Large,   "110%", "1.1rem"),
        new(ContentZoom.XLarge,  "125%", "1.25rem"),
        new(ContentZoom.XXLarge, "150%", "1.5rem"),
    };

    protected override void OnInitialized()
    {
        _themeOptions = new List<ThemeOption>
        {
            new(AppTheme.Light, L["Preference.ThemeLight"], "bi-sun"),
            new(AppTheme.Dark,  L["Preference.ThemeDark"],  "bi-moon-stars"),
        };
    }

    private void SelectTheme(AppTheme value)
    {
        (Model ?? _fallback).Theme = value;
        StateHasChanged();
    }

    private void SelectZoom(ContentZoom value)
    {
        (Model ?? _fallback).Zoom = value;
        StateHasChanged();
    }
}
