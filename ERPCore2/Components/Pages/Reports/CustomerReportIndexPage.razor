@*
    客戶報表中心
    用途：顯示所有客戶相關的報表清單
    開啟方式：透過導航 Action 觸發
*@

@using ERPCore2.Data
@using ERPCore2.Models

<ReportIndexModalComponent IsVisible="@IsVisible"
                          IsVisibleChanged="@IsVisibleChanged"
                          Title="客戶報表中心"
                          Icon="bi-people"
                          Reports="@reports"
                          OnReportSelected="@HandleReportSelected" />

@code {
    // ===== 參數定義 =====
    
    /// <summary>
    /// Modal 是否顯示（由外部控制）
    /// </summary>
    [Parameter]
    public bool IsVisible { get; set; }
    
    /// <summary>
    /// Modal 顯示狀態變更事件
    /// </summary>
    [Parameter]
    public EventCallback<bool> IsVisibleChanged { get; set; }
    
    /// <summary>
    /// 報表選擇事件（傳遞 ActionId 給 MainLayout 處理）
    /// </summary>
    [Parameter]
    public EventCallback<string> OnReportSelected { get; set; }
    
    // ===== 私有欄位 =====
    
    private List<ReportDefinition> reports = new();
    
    // ===== 生命週期方法 =====
    
    protected override void OnInitialized()
    {
        // 載入客戶相關報表
        reports = ReportRegistry.GetCustomerReports();
    }
    
    // ===== 事件處理方法 =====
    
    private async Task HandleReportSelected(string actionId)
    {
        // 將 ActionId 傳遞給父組件（MainLayout）處理
        if (OnReportSelected.HasDelegate)
        {
            await OnReportSelected.InvokeAsync(actionId);
        }
    }
}
