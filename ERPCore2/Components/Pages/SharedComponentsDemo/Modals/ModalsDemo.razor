@page "/sharedcomponentsdemo/modals"
@using static ERPCore2.Components.Shared.Buttons.ButtonComponent
@using static ERPCore2.Components.Shared.Alerts.AlertComponent
@using ERPCore2.Components.Shared.Tables
@using System.ComponentModel.DataAnnotations
@inject IJSRuntime JSRuntime
@rendermode InteractiveServer

<PageTitle>Modals 元件展示</PageTitle>

<div class="container-fluid">
    <h1 class="h3 mb-4">Modals 元件展示</h1>
    
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Modal 元件範例</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-4">
                        Modal 組件提供統一的對話框樣式，支援不同尺寸、自定義內容和各種互動功能。本專案包含 GenericManagementModal 和專門的管理模態視窗。
                    </p>
                    
                    <h6>範例 1: 基本模態視窗</h6>
                    <div class="border p-3 mb-4 bg-light">
                        <ButtonComponent Text="開啟基本模態視窗" 
                                       Variant="ButtonVariant.Primary"
                                       IconClass="bi bi-window"
                                       OnClick="@(() => OpenModal("basicModal"))" />
                        
                        <!-- 基本模態視窗 -->
                        <div class="modal fade" id="basicModal" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header bg-primary text-white">
                                        <h5 class="modal-title">
                                            <i class="bi bi-info-circle me-2"></i>
                                            基本模態視窗
                                        </h5>
                                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                                    </div>
                                    <div class="modal-body">
                                        <p>這是一個基本的模態視窗範例。</p>
                                        <p>您可以在這裡放置任何內容，例如表單、文字或其他組件。</p>
                                    </div>
                                    <div class="modal-footer">                                        <ButtonComponent Text="取消" 
                                                       Variant="ButtonVariant.Secondary"
                                                       OnClick="@(async () => await CloseModal("basicModal"))" /><ButtonComponent Text="確定" 
                                                       Variant="ButtonVariant.Primary"
                                                       OnClick="@(async () => { await CloseModal("basicModal"); ShowMessage("已確認操作"); })" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <h6>範例 2: 不同尺寸的模態視窗</h6>
                    <div class="border p-3 mb-4 bg-light">
                        <div class="d-flex gap-2 flex-wrap">
                            <ButtonComponent Text="小型模態視窗" 
                                           Variant="ButtonVariant.Info"
                                           Size="ButtonSize.Small"
                                           OnClick="@(() => OpenModal("smallModal"))" />
                            <ButtonComponent Text="大型模態視窗" 
                                           Variant="ButtonVariant.Success"
                                           OnClick="@(() => OpenModal("largeModal"))" />
                            <ButtonComponent Text="超大型模態視窗" 
                                           Variant="ButtonVariant.Warning"
                                           OnClick="@(() => OpenModal("xlModal"))" />
                        </div>
                        
                        <!-- 小型模態視窗 -->
                        <div class="modal fade" id="smallModal" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog modal-sm">
                                <div class="modal-content">
                                    <div class="modal-header bg-info text-white">
                                        <h6 class="modal-title">小型模態視窗</h6>
                                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                                    </div>
                                    <div class="modal-body">
                                        <p class="small">這是一個小型的模態視窗，適合簡單的確認對話框。</p>
                                    </div>
                                    <div class="modal-footer">                                        <ButtonComponent Text="關閉" 
                                                       Variant="ButtonVariant.Secondary"
                                                       Size="ButtonSize.Small"
                                                       OnClick="@(async () => await CloseModal("smallModal"))" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 大型模態視窗 -->
                        <div class="modal fade" id="largeModal" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content">
                                    <div class="modal-header bg-success text-white">
                                        <h5 class="modal-title">
                                            <i class="bi bi-card-text me-2"></i>
                                            大型模態視窗
                                        </h5>
                                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <h6>左側內容</h6>
                                                <p>大型模態視窗提供更多空間來展示複雜的內容。</p>
                                                <ul>
                                                    <li>支援複雜的表單</li>
                                                    <li>可以包含多個區塊</li>
                                                    <li>適合數據管理功能</li>
                                                </ul>
                                            </div>
                                            <div class="col-md-6">
                                                <h6>右側內容</h6>
                                                <p>您可以在這裡放置圖表、表格或其他視覺化內容。</p>
                                                <div class="bg-light p-3 rounded">
                                                    <i class="bi bi-graph-up text-primary" style="font-size: 2rem;"></i>
                                                    <p class="mb-0 mt-2">模擬圖表區域</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer">                                        <ButtonComponent Text="取消" 
                                                       Variant="ButtonVariant.Secondary"
                                                       OnClick="@(async () => await CloseModal("largeModal"))" /><ButtonComponent Text="儲存" 
                                                       Variant="ButtonVariant.Success"
                                                       IconClass="bi bi-check-lg"
                                                       OnClick="@(async () => { await CloseModal("largeModal"); ShowMessage("大型模態視窗操作已儲存"); })" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 超大型模態視窗 -->
                        <div class="modal fade" id="xlModal" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog modal-xl">
                                <div class="modal-content">
                                    <div class="modal-header bg-warning text-dark">
                                        <h5 class="modal-title">
                                            <i class="bi bi-window-fullscreen me-2"></i>
                                            超大型模態視窗
                                        </h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="row">
                                            <div class="col-md-8">
                                                <h6>主要內容區域</h6>
                                                <p>超大型模態視窗幾乎佔滿整個螢幕，適合複雜的應用程式介面。</p>
                                                
                                                <!-- 模擬表格內容 -->
                                                <TableComponent TItem="DemoItem"
                                                              Items="@demoItems"
                                                              Headers="@demoHeaders"
                                                              Size="TableComponent<DemoItem>.TableSize.Small">
                                                    <RowTemplate Context="item">
                                                        <td>@item.Id</td>
                                                        <td>@item.Name</td>
                                                        <td>@item.Value</td>
                                                    </RowTemplate>
                                                </TableComponent>
                                            </div>
                                            <div class="col-md-4">
                                                <h6>側邊欄</h6>
                                                <div class="card">
                                                    <div class="card-body">
                                                        <h6 class="card-title">操作面板</h6>
                                                        <p class="card-text">在這裡可以放置相關的控制項目。</p>
                                                        <ButtonComponent Text="動作 1" 
                                                                       Variant="ButtonVariant.OutlinePrimary"
                                                                       CssClass="w-100 mb-2"
                                                                       OnClick="@(() => ShowMessage("執行了動作 1"))" />
                                                        <ButtonComponent Text="動作 2" 
                                                                       Variant="ButtonVariant.Success"
                                                                       CssClass="w-100"
                                                                       OnClick="@(() => ShowMessage("執行了動作 2"))" />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <ButtonComponent Text="重設" 
                                                       Variant="ButtonVariant.OutlineWarning"
                                                       OnClick="@(() => ShowMessage("已重設設定"))" />                                        <ButtonComponent Text="取消" 
                                                       Variant="ButtonVariant.Secondary"
                                                       OnClick="@(async () => await CloseModal("xlModal"))" />                                        <ButtonComponent Text="套用設定" 
                                                       Variant="ButtonVariant.Warning"
                                                       IconClass="bi bi-gear"
                                                       OnClick="@(async () => { await CloseModal("xlModal"); ShowMessage("超大型模態視窗設定已套用"); })" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <h6>範例 3: 表單模態視窗</h6>
                    <div class="border p-3 mb-4 bg-light">                        <ButtonComponent Text="開啟表單模態視窗" 
                                       Variant="ButtonVariant.Success"
                                       IconClass="bi bi-plus-circle"
                                       OnClick="@(async () => { ResetForm(); await OpenModal("formModal"); })" />
                        
                        <!-- 表單模態視窗 -->
                        <div class="modal fade" id="formModal" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content">
                                    <div class="modal-header bg-success text-white">
                                        <h5 class="modal-title">
                                            <i class="bi bi-person-plus me-2"></i>
                                            新增用戶
                                        </h5>
                                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                                    </div>
                                    <EditForm Model="@formModel" OnValidSubmit="@HandleValidSubmit">
                                        <DataAnnotationsValidator />
                                        <div class="modal-body">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="form-group mb-3">
                                                        <label class="form-label">姓名 *</label>
                                                        <InputText @bind-Value="formModel.Name" class="form-control" placeholder="請輸入姓名" />
                                                        <ValidationMessage For="@(() => formModel.Name)" class="text-danger" />
                                                    </div>
                                                    
                                                    <div class="form-group mb-3">
                                                        <label class="form-label">電子郵件 *</label>
                                                        <InputText @bind-Value="formModel.Email" class="form-control" placeholder="請輸入電子郵件" />
                                                        <ValidationMessage For="@(() => formModel.Email)" class="text-danger" />
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-group mb-3">
                                                        <label class="form-label">部門</label>
                                                        <InputSelect @bind-Value="formModel.Department" class="form-select">
                                                            <option value="">請選擇部門</option>
                                                            <option value="資訊部">資訊部</option>
                                                            <option value="行銷部">行銷部</option>
                                                            <option value="財務部">財務部</option>
                                                            <option value="人資部">人資部</option>
                                                        </InputSelect>
                                                    </div>
                                                    
                                                    <div class="form-group mb-3">
                                                        <label class="form-label">電話</label>
                                                        <InputText @bind-Value="formModel.Phone" class="form-control" placeholder="請輸入電話號碼" />
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="form-group">
                                                <label class="form-label">備註</label>
                                                <InputTextArea @bind-Value="formModel.Notes" class="form-control" rows="3" placeholder="其他備註資訊..." />
                                            </div>
                                        </div>
                                        <div class="modal-footer">                                            <ButtonComponent Text="取消" 
                                                           Variant="ButtonVariant.Secondary"
                                                           OnClick="@(async () => await CloseModal("formModal"))" />
                                            <ButtonComponent Text="儲存" 
                                                           Variant="ButtonVariant.Success"
                                                           IconClass="bi bi-check-lg"
                                                           IsSubmit="true" />
                                        </div>
                                    </EditForm>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <h6>範例 4: 確認對話框</h6>
                    <div class="border p-3 mb-4 bg-light">
                        <div class="d-flex gap-2 flex-wrap">
                            <ButtonComponent Text="刪除確認" 
                                           Variant="ButtonVariant.Danger"
                                           IconClass="bi bi-trash"
                                           OnClick="@(() => OpenModal("deleteConfirmModal"))" />
                            <ButtonComponent Text="警告對話框" 
                                           Variant="ButtonVariant.Warning"
                                           IconClass="bi bi-exclamation-triangle"
                                           OnClick="@(() => OpenModal("warningModal"))" />
                            <ButtonComponent Text="成功通知" 
                                           Variant="ButtonVariant.Success"
                                           IconClass="bi bi-check-circle"
                                           OnClick="@(() => OpenModal("successModal"))" />
                        </div>
                        
                        <!-- 刪除確認模態視窗 -->
                        <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header bg-danger text-white">
                                        <h5 class="modal-title">
                                            <i class="bi bi-exclamation-triangle me-2"></i>
                                            確認刪除
                                        </h5>
                                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="text-center">
                                            <i class="bi bi-trash text-danger" style="font-size: 3rem;"></i>
                                            <h5 class="mt-3">您確定要刪除此項目嗎？</h5>
                                            <p class="text-muted">此操作無法復原，請謹慎考慮。</p>
                                        </div>
                                    </div>
                                    <div class="modal-footer justify-content-center">                                        <ButtonComponent Text="取消" 
                                                       Variant="ButtonVariant.Secondary"
                                                       OnClick="@(async () => await CloseModal("deleteConfirmModal"))" />                                        <ButtonComponent Text="確定刪除" 
                                                       Variant="ButtonVariant.Danger"
                                                       IconClass="bi bi-trash"
                                                       OnClick="@(async () => { await CloseModal("deleteConfirmModal"); ShowMessage("項目已刪除"); })" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 警告模態視窗 -->
                        <div class="modal fade" id="warningModal" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header bg-warning text-dark">
                                        <h5 class="modal-title">
                                            <i class="bi bi-exclamation-triangle me-2"></i>
                                            系統警告
                                        </h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="d-flex align-items-start">
                                            <i class="bi bi-exclamation-triangle-fill text-warning me-3" style="font-size: 1.5rem;"></i>
                                            <div>
                                                <h6>注意事項</h6>
                                                <p>系統偵測到以下問題，請檢查後再繼續：</p>
                                                <ul>
                                                    <li>網路連線不穩定</li>
                                                    <li>部分功能可能受影響</li>
                                                    <li>建議稍後再試</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer">                                        <ButtonComponent Text="我知道了" 
                                                       Variant="ButtonVariant.Warning"
                                                       OnClick="@(async () => { await CloseModal("warningModal"); ShowMessage("已確認警告訊息"); })" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 成功模態視窗 -->
                        <div class="modal fade" id="successModal" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header bg-success text-white">
                                        <h5 class="modal-title">
                                            <i class="bi bi-check-circle me-2"></i>
                                            操作成功
                                        </h5>
                                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="text-center">
                                            <i class="bi bi-check-circle-fill text-success" style="font-size: 4rem;"></i>
                                            <h4 class="mt-3 text-success">完成！</h4>
                                            <p>您的操作已成功完成。</p>
                                            <div class="bg-light p-3 rounded mt-3">
                                                <small class="text-muted">
                                                    <strong>操作時間：</strong> @DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss")
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer justify-content-center">                                        <ButtonComponent Text="關閉" 
                                                       Variant="ButtonVariant.Success"
                                                       OnClick="@(async () => { await CloseModal("successModal"); ShowMessage("操作已完成"); })" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <h6>範例 5: 載入狀態模態視窗</h6>
                    <div class="border p-3 mb-4 bg-light">
                        <ButtonComponent Text="模擬處理" 
                                       Variant="ButtonVariant.Info"
                                       IconClass="bi bi-gear"
                                       OnClick="SimulateProcessing"
                                       IsDisabled="@isProcessing" />
                        
                        <!-- 載入狀態模態視窗 -->
                        <div class="modal fade @(isProcessing ? "show" : "")" id="processingModal" tabindex="-1" aria-hidden="@(!isProcessing)" style="display: @(isProcessing ? "block" : "none");">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header bg-info text-white">
                                        <h5 class="modal-title">
                                            <i class="bi bi-gear-fill me-2"></i>
                                            處理中
                                        </h5>
                                    </div>
                                    <div class="modal-body text-center py-4">
                                        <LoadingComponent IsLoading="true" ShowText="true" LoadingText="正在處理您的請求，請稍候..." Size="LoadingComponent.LoadingSize.Large" />
                                        <div class="mt-3">
                                            <small class="text-muted">這可能需要幾秒鐘的時間...</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        @if (isProcessing)
                        {
                            <div class="modal-backdrop fade show"></div>
                        }
                    </div>
                    
                    @if (!string.IsNullOrEmpty(message))
                    {
                        <div class="alert alert-info alert-dismissible fade show mt-4" role="alert">
                            <i class="bi bi-info-circle me-2"></i>
                            @message
                            <button type="button" class="btn-close" @onclick="ClearMessage"></button>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    private string message = string.Empty;
    private bool isProcessing = false;
    private UserFormModel formModel = new();
    
    // 示範用的簡單資料類別
    public class DemoItem
    {
        public int Id { get; set; }
        public string Name { get; set; } = string.Empty;
        public string Value { get; set; } = string.Empty;
    }
    
    public class UserFormModel
    {
        [Required(ErrorMessage = "姓名為必填欄位")]
        public string Name { get; set; } = string.Empty;
        
        [Required(ErrorMessage = "電子郵件為必填欄位")]
        [EmailAddress(ErrorMessage = "請輸入有效的電子郵件格式")]
        public string Email { get; set; } = string.Empty;
        
        public string Department { get; set; } = string.Empty;
        public string Phone { get; set; } = string.Empty;
        public string Notes { get; set; } = string.Empty;
    }
    
    private List<string> demoHeaders = new() { "ID", "名稱", "值" };
    private List<DemoItem> demoItems = new();
    
    protected override void OnInitialized()
    {
        demoItems = new List<DemoItem>
        {
            new() { Id = 1, Name = "項目 A", Value = "值 1" },
            new() { Id = 2, Name = "項目 B", Value = "值 2" },
            new() { Id = 3, Name = "項目 C", Value = "值 3" }
        };
    }
    
    private async Task OpenModal(string modalId)
    {
        await JSRuntime.InvokeVoidAsync("eval", $"new bootstrap.Modal(document.getElementById('{modalId}')).show()");
    }
    
    private async Task CloseModal(string modalId)
    {
        await JSRuntime.InvokeVoidAsync("eval", $"bootstrap.Modal.getInstance(document.getElementById('{modalId}'))?.hide()");
    }
    
    private async Task SimulateProcessing()
    {
        isProcessing = true;
        StateHasChanged();
        
        await Task.Delay(3000);
        
        isProcessing = false;
        StateHasChanged();
        ShowMessage("處理完成！");
    }
    
    private void ResetForm()
    {
        formModel = new UserFormModel();
    }
    
    private async Task HandleValidSubmit()
    {
        await CloseModal("formModal");
        ShowMessage($"用戶 '{formModel.Name}' 已成功建立");
        ResetForm();
    }
    
    private void ShowMessage(string msg)
    {
        message = msg;
        StateHasChanged();
    }
    
    private void ClearMessage()
    {
        message = string.Empty;
        StateHasChanged();
    }
}
