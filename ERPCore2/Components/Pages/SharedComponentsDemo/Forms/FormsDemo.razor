@page "/sharedcomponentsdemo/forms"
@using ERPCore2.Components.Shared.Forms
@using ERPCore2.Components.Shared.Buttons
@using static ERPCore2.Components.Shared.Buttons.ButtonComponent
@rendermode InteractiveServer

<PageTitle>Forms 元件展示</PageTitle>

<div class="container-fluid">
    <h1 class="h3 mb-4">Forms 元件展示</h1>
    
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Forms 元件範例</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-4">
                        Forms 元件提供統一的表單輸入體驗，包含 InputComponent、FormSectionComponent 等，
                        支援驗證、狀態管理和響應式設計。
                    </p>
                    
                    <h6>範例 1: 基本輸入元件</h6>
                    <div class="border p-3 mb-4 bg-light">
                        <div class="row">
                            <div class="col-md-6">
                                <InputComponent Label="客戶名稱" 
                                              @bind-Value="formData.CustomerName" 
                                              Placeholder="請輸入客戶名稱" 
                                              IsRequired="true" />
                            </div>
                            <div class="col-md-6">
                                <InputComponent Label="統一編號" 
                                              @bind-Value="formData.TaxId" 
                                              Placeholder="請輸入統一編號" 
                                              HelpText="8位數統一編號" />
                            </div>
                            <div class="col-md-6">
                                <InputComponent Label="電話號碼" 
                                              @bind-Value="formData.Phone" 
                                              InputType="tel" 
                                              Placeholder="(02) 1234-5678" />
                            </div>
                            <div class="col-md-6">
                                <InputComponent Label="電子郵件" 
                                              @bind-Value="formData.Email" 
                                              InputType="email" 
                                              Placeholder="example@company.com" />
                            </div>
                        </div>
                    </div>
                    
                    <h6>範例 2: 不同類型的輸入元件</h6>
                    <div class="border p-3 mb-4 bg-light">
                        <div class="row">
                            <div class="col-md-6">
                                <InputComponent Label="密碼" 
                                              @bind-Value="formData.Password" 
                                              InputType="password" 
                                              Placeholder="請輸入密碼" />
                            </div>
                            <div class="col-md-6">
                                <InputComponent Label="數量" 
                                              @bind-Value="formData.Quantity" 
                                              InputType="number" 
                                              Placeholder="0" />
                            </div>
                            <div class="col-md-6">
                                <InputComponent Label="日期" 
                                              @bind-Value="formData.Date" 
                                              InputType="date" />
                            </div>
                            <div class="col-md-6">
                                <InputComponent Label="網站" 
                                              @bind-Value="formData.Website" 
                                              InputType="url" 
                                              Placeholder="https://example.com" />
                            </div>
                            <div class="col-md-6">
                                <InputComponent Label="顏色選擇" 
                                              @bind-Value="formData.Color" 
                                              InputType="color" />
                            </div>
                            <div class="col-md-6">
                                <InputComponent Label="備註" 
                                              @bind-Value="formData.Description" 
                                              InputType="textarea" 
                                              Placeholder="請輸入備註說明..." />
                            </div>
                        </div>
                    </div>
                    
                    <h6>範例 3: 表單驗證狀態</h6>
                    <div class="border p-3 mb-4 bg-light">
                        <div class="row">
                            <div class="col-md-4">
                                <InputComponent Label="正確欄位" 
                                              @bind-Value="validationData.ValidField" 
                                              />
                            </div>
                            <div class="col-md-4">
                                <InputComponent Label="錯誤欄位" 
                                              @bind-Value="validationData.InvalidField" 
                                              ErrorMessage="此欄位為必填" />
                            </div>
                            <div class="col-md-4">
                                <InputComponent Label="警告欄位" 
                                              @bind-Value="validationData.WarningField" 
                                              ErrorMessage="請確認輸入內容" />
                            </div>
                        </div>
                    </div>
                    
                    <h6>範例 4: 表單區塊元件</h6>
                    <div class="border p-3 mb-4 bg-light">
                        <FormSectionComponent Title="基本資料" 
                                            IconClass="bi bi-person-circle" 
                                            CompletedFieldsCount="@GetCompletedBasicFields()">
                            <div class="row">
                                <div class="col-md-6">
                                    <InputComponent Label="公司名稱" 
                                                  @bind-Value="sectionData.CompanyName" 
                                                  Placeholder="請輸入公司名稱" />
                                </div>
                                <div class="col-md-6">
                                    <InputComponent Label="聯絡人" 
                                                  @bind-Value="sectionData.ContactPerson" 
                                                  Placeholder="請輸入聯絡人姓名" />
                                </div>
                                <div class="col-md-6">
                                    <InputComponent Label="聯絡電話" 
                                                  @bind-Value="sectionData.ContactPhone" 
                                                  InputType="tel" 
                                                  Placeholder="(02) 1234-5678" />
                                </div>
                                <div class="col-md-6">
                                    <InputComponent Label="聯絡信箱" 
                                                  @bind-Value="sectionData.ContactEmail" 
                                                  InputType="email" 
                                                  Placeholder="contact@company.com" />
                                </div>
                            </div>
                        </FormSectionComponent>
                    </div>
                    
                    <h6>範例 5: 地址資料區塊</h6>
                    <div class="border p-3 mb-4 bg-light">
                        <FormSectionComponent Title="地址資料" 
                                            IconClass="bi bi-geo-alt" 
                                            CompletedFieldsCount="@GetCompletedAddressFields()">
                            <div class="row">
                                <div class="col-md-6">
                                    <InputComponent Label="城市" 
                                                  @bind-Value="sectionData.City" 
                                                  Placeholder="請選擇城市" />
                                </div>
                                <div class="col-md-6">
                                    <InputComponent Label="區域" 
                                                  @bind-Value="sectionData.District" 
                                                  Placeholder="請選擇區域" />
                                </div>
                                <div class="col-md-6">
                                    <InputComponent Label="郵遞區號" 
                                                  @bind-Value="sectionData.PostalCode" 
                                                  Placeholder="100" />
                                </div>
                                <div class="col-md-6">
                                    <InputComponent Label="詳細地址" 
                                                  @bind-Value="sectionData.Address" 
                                                  Placeholder="請輸入詳細地址" />
                                </div>
                                <div class="col-md-6">
                                    <InputComponent Label="公司網站" 
                                                  @bind-Value="sectionData.Website" 
                                                  InputType="url" 
                                                  Placeholder="https://www.company.com" />
                                </div>
                                <div class="col-md-6">
                                    <InputComponent Label="員工人數" 
                                                  @bind-Value="sectionData.EmployeeCount" 
                                                  InputType="number" 
                                                  Placeholder="50" />
                                </div>
                                <div class="col-12">
                                    <InputComponent Label="備註" 
                                                  @bind-Value="sectionData.Notes" 
                                                  InputType="textarea" 
                                                  Placeholder="其他補充說明..." />
                                </div>
                            </div>                </FormSectionComponent>
                    </div>
                    
                    <h6>範例 6: 動態表單模式</h6>
                    <div class="border p-3 mb-4 bg-light">
                        <div class="mb-3">
                            <label class="form-label">表單模式</label>
                            <div class="btn-group" role="group">                                <button type="button" 
                                        class="btn @(mode == "edit" ? "btn-primary" : "btn-outline-primary")"
                                        @onclick='() => SwitchMode("edit")'>
                                    編輯模式
                                </button>
                                <button type="button" 
                                        class="btn @(mode == "readonly" ? "btn-primary" : "btn-outline-primary")"
                                        @onclick='() => SwitchMode("readonly")'>
                                    唯讀模式
                                </button>
                                <button type="button" 
                                        class="btn @(mode == "disabled" ? "btn-primary" : "btn-outline-primary")"
                                        @onclick='() => SwitchMode("disabled")'>
                                    禁用模式
                                </button>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <InputComponent Label="產品名稱" 
                                              @bind-Value="dynamicData.ProductName" 
                                              IsReadonly="@(mode == "readonly")" 
                                              IsDisabled="@(mode == "disabled")" 
                                              Placeholder="請輸入產品名稱" />
                            </div>
                            <div class="col-md-6">
                                <InputComponent Label="價格" 
                                              @bind-Value="dynamicData.Price" 
                                              InputType="number" 
                                              IsReadonly="@(mode == "readonly")" 
                                              IsDisabled="@(mode == "disabled")" 
                                              Placeholder="0.00" />
                            </div>
                            <div class="col-12">
                                <InputComponent Label="產品描述" 
                                              @bind-Value="dynamicData.Description" 
                                              InputType="textarea" 
                                              IsReadonly="@(mode == "readonly")" 
                                              IsDisabled="@(mode == "disabled")" 
                                              Placeholder="請輸入產品描述..." />
                            </div>
                        </div>
                    </div>
                    
                    <h6>範例 7: 表單提交與驗證</h6>
                    <div class="border p-3 mb-4 bg-light">
                        <div class="row">
                            <div class="col-md-6">
                                <InputComponent Label="使用者名稱" 
                                              @bind-Value="submitData.Username" 
                                              ErrorMessage="@GetFieldError("Username")" />
                            </div>
                            <div class="col-md-6">
                                <InputComponent Label="確認密碼" 
                                              @bind-Value="submitData.ConfirmPassword" 
                                              InputType="password" 
                                              ErrorMessage="@GetFieldError("ConfirmPassword")" />
                            </div>
                            <div class="col-12">
                                <InputComponent Label="個人簡介" 
                                              @bind-Value="submitData.Bio" 
                                              InputType="textarea" 
                                              Placeholder="請輸入個人簡介..." />
                            </div>
                            <div class="col-12 mt-3">
                                <ButtonComponent Text="提交表單" 
                                               IconClass="bi bi-check-circle" 
                                               OnClick="@HandleSubmit" />
                                <ButtonComponent Text="重設" 
                                               IconClass="bi bi-arrow-clockwise" 
                                               OnClick="@HandleReset" />
                                <ButtonComponent Text="驗證" 
                                               IconClass="bi bi-shield-check" 
                                               OnClick="@HandleValidate" />
                            </div>
                        </div>
                    </div>
                    
                    @if (!string.IsNullOrEmpty(actionMessage))
                    {
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle me-2"></i>@actionMessage
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    private string actionMessage = "";
    private string mode = "edit";
    private List<string> validationErrors = new();
    
    private FormData formData = new();
    private ValidationData validationData = new()
    {
        ValidField = "正確的輸入值",
        InvalidField = "",
        WarningField = "可能有問題的值"
    };
    private SectionData sectionData = new();
    private DynamicData dynamicData = new()
    {
        ProductName = "範例產品",
        Price = "299.00",
        Description = "這是一個範例產品的描述..."
    };
    private SubmitData submitData = new();
    
    private void SwitchMode(string newMode)
    {
        mode = newMode;
        actionMessage = $"表單模式已切換為：{GetModeText(newMode)}";
    }
    
    private string GetModeText(string modeValue)
    {
        return modeValue switch
        {
            "edit" => "編輯模式",
            "readonly" => "唯讀模式",
            "disabled" => "禁用模式",
            _ => "未知模式"
        };
    }
    
    private int GetCompletedBasicFields()
    {
        int completed = 0;
        if (!string.IsNullOrWhiteSpace(sectionData.CompanyName)) completed++;
        if (!string.IsNullOrWhiteSpace(sectionData.ContactPerson)) completed++;
        if (!string.IsNullOrWhiteSpace(sectionData.ContactPhone)) completed++;
        if (!string.IsNullOrWhiteSpace(sectionData.ContactEmail)) completed++;
        return completed;
    }
    
    private int GetCompletedAddressFields()
    {
        int completed = 0;
        if (!string.IsNullOrWhiteSpace(sectionData.City)) completed++;
        if (!string.IsNullOrWhiteSpace(sectionData.District)) completed++;
        if (!string.IsNullOrWhiteSpace(sectionData.PostalCode)) completed++;
        if (!string.IsNullOrWhiteSpace(sectionData.Address)) completed++;
        if (!string.IsNullOrWhiteSpace(sectionData.Website)) completed++;
        if (!string.IsNullOrWhiteSpace(sectionData.EmployeeCount)) completed++;
        return completed;
    }
    
    private string GetValidationState(string fieldName)
    {
        if (validationErrors.Any(e => e.StartsWith($"{fieldName}:")))
            return "Invalid";
        return "None";
    }
    
    private string GetFieldError(string fieldName)
    {
        var error = validationErrors.FirstOrDefault(e => e.StartsWith($"{fieldName}:"));
        return error?.Substring(fieldName.Length + 2) ?? "";
    }
    
    private void HandleSubmit()
    {
        validationErrors.Clear();
        
        // 簡單驗證邏輯
        if (string.IsNullOrWhiteSpace(submitData.Username))
        {
            validationErrors.Add("Username: 使用者名稱為必填");
        }
        else if (submitData.Username.Length < 3)
        {
            validationErrors.Add("Username: 使用者名稱至少需要3個字元");
        }
        
        if (string.IsNullOrWhiteSpace(submitData.ConfirmPassword))
        {
            validationErrors.Add("ConfirmPassword: 確認密碼為必填");
        }
        else if (submitData.ConfirmPassword.Length < 6)
        {
            validationErrors.Add("ConfirmPassword: 密碼長度至少需要6個字元");
        }
        
        if (validationErrors.Any())
        {
            actionMessage = $"驗證錯誤：發現 {validationErrors.Count} 個錯誤";
        }
        else
        {
            actionMessage = "表單驗證通過！";
        }
    }
    
    private void HandleReset()
    {
        submitData = new();
        validationErrors.Clear();
        actionMessage = "表單已重設";
    }
    
    private void HandleValidate()
    {
        HandleSubmit();
    }
    
    // 資料模型類別
    private class FormData
    {
        public string CustomerName { get; set; } = string.Empty;
        public string TaxId { get; set; } = string.Empty;
        public string Phone { get; set; } = string.Empty;
        public string Email { get; set; } = string.Empty;
        public string Password { get; set; } = string.Empty;
        public string Quantity { get; set; } = string.Empty;
        public string Date { get; set; } = DateTime.Today.ToString("yyyy-MM-dd");
        public string Website { get; set; } = string.Empty;
        public string Color { get; set; } = "#007bff";
        public string Description { get; set; } = string.Empty;
    }
    
    private class ValidationData
    {
        public string ValidField { get; set; } = string.Empty;
        public string InvalidField { get; set; } = string.Empty;
        public string WarningField { get; set; } = string.Empty;
    }
    
    private class SectionData
    {
        public string CompanyName { get; set; } = string.Empty;
        public string ContactPerson { get; set; } = string.Empty;
        public string ContactPhone { get; set; } = string.Empty;
        public string ContactEmail { get; set; } = string.Empty;
        public string City { get; set; } = string.Empty;
        public string District { get; set; } = string.Empty;
        public string PostalCode { get; set; } = string.Empty;
        public string Address { get; set; } = string.Empty;
        public string Website { get; set; } = string.Empty;
        public string EmployeeCount { get; set; } = string.Empty;
        public string Notes { get; set; } = string.Empty;
    }
    
    private class DynamicData
    {
        public string ProductName { get; set; } = string.Empty;
        public string Price { get; set; } = string.Empty;
        public string Description { get; set; } = string.Empty;
    }
    
    private class SubmitData
    {
        public string Username { get; set; } = string.Empty;
        public string ConfirmPassword { get; set; } = string.Empty;
        public string Bio { get; set; } = string.Empty;
    }
}
