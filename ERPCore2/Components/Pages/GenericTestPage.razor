@page "/generic-test"
@using ERPCore2.Data.Entities
@using ERPCore2.Components.Shared.Tables
@using ERPCore2.Components.Shared.Forms

<h1>簡單組件測試</h1>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h6>GenericTableComponent 測試</h6>
            </div>
            <div class="card-body">
                <GenericTableComponent TItem="TestItem"
                                     Items="@testItems"
                                     ColumnDefinitions="@tableColumns"
                                     ShowRowNumbers="true"
                                     CssClass="table table-striped" />
            </div>
        </div>
    </div>
</div>

<div class="row mt-3">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h6>GenericFormComponent 測試</h6>
            </div>
            <div class="card-body">
                <GenericFormComponent TModel="TestItem"
                                    Model="@currentItem"
                                    FieldDefinitions="@formFields"
                                    ShowSubmitButton="true"
                                    SubmitButtonText="測試提交" />
            </div>
        </div>
    </div>
</div>

@code {
    private List<TestItem> testItems = new();
    private TestItem currentItem = new();
    private List<TableColumnDefinition> tableColumns = new();
    private List<FormFieldDefinition> formFields = new();

    protected override void OnInitialized()
    {
        InitializeTestData();
        InitializeConfigurations();
    }

    private void InitializeTestData()
    {
        testItems = new List<TestItem>
        {
            new() { Id = 1, Name = "測試項目 1", Description = "這是第一個測試項目", IsActive = true, CreatedDate = DateTime.Now.AddDays(-5) },
            new() { Id = 2, Name = "測試項目 2", Description = "這是第二個測試項目", IsActive = false, CreatedDate = DateTime.Now.AddDays(-3) },
            new() { Id = 3, Name = "測試項目 3", Description = "這是第三個測試項目", IsActive = true, CreatedDate = DateTime.Now.AddDays(-1) }
        };

        currentItem = new TestItem { IsActive = true, CreatedDate = DateTime.Now };
    }

    private void InitializeConfigurations()
    {
        tableColumns = new List<TableColumnDefinition>
        {
            new() { PropertyName = "Id", Header = "ID", DataType = ColumnDataType.Number, Width = "80px" },
            new() { PropertyName = "Name", Header = "名稱", DataType = ColumnDataType.Text, IsSortable = true },
            new() { PropertyName = "Description", Header = "說明", DataType = ColumnDataType.Text },
            new() { PropertyName = "IsActive", Header = "啟用", DataType = ColumnDataType.Boolean, Width = "80px" },
            new() { PropertyName = "CreatedDate", Header = "建立日期", DataType = ColumnDataType.Date, Width = "120px" }
        };

        formFields = new List<FormFieldDefinition>
        {
            new() { PropertyName = "Name", Label = "名稱", Type = FormFieldType.Text, IsRequired = true, CssClass = "col-md-6" },
            new() { PropertyName = "Description", Label = "說明", Type = FormFieldType.TextArea, Rows = 3, CssClass = "col-12" },
            new() { PropertyName = "IsActive", Label = "啟用", Type = FormFieldType.Checkbox, CssClass = "col-md-6" },
            new() { PropertyName = "CreatedDate", Label = "建立日期", Type = FormFieldType.Date, CssClass = "col-md-6" }
        };
    }

    public class TestItem
    {
        public int Id { get; set; }
        public string Name { get; set; } = string.Empty;
        public string Description { get; set; } = string.Empty;
        public bool IsActive { get; set; }
        public DateTime CreatedDate { get; set; }
    }
}
