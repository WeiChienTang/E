@* 搜尋欄組件 - 用於列表頁面的搜尋功能 *@
<div class="input-group @CssClass">
    <span class="input-group-text">
        <i class="fas fa-search"></i>
    </span>
    <input type="text" 
           class="form-control" 
           placeholder="@Placeholder"
           value="@SearchTerm"
           @oninput="OnSearchTermChanged"
           @onkeypress="OnKeyPress" />
    @if (ShowClearButton && !string.IsNullOrEmpty(SearchTerm))
    {
        <button class="btn btn-outline-secondary" type="button" @onclick="ClearSearch">
            <i class="fas fa-times"></i>
        </button>
    }
</div>

@code {
    [Parameter] public string SearchTerm { get; set; } = string.Empty;
    [Parameter] public EventCallback<string> SearchTermChanged { get; set; }
    [Parameter] public EventCallback<string> OnSearch { get; set; }
    [Parameter] public string Placeholder { get; set; } = "請輸入搜尋關鍵字...";
    [Parameter] public bool ShowClearButton { get; set; } = true;
    [Parameter] public string CssClass { get; set; } = string.Empty;

    private async Task OnSearchTermChanged(ChangeEventArgs e)
    {
        SearchTerm = e.Value?.ToString() ?? string.Empty;
        await SearchTermChanged.InvokeAsync(SearchTerm);
    }

    private async Task OnKeyPress(KeyboardEventArgs e)
    {
        if (e.Key == "Enter" && OnSearch.HasDelegate)
        {
            await OnSearch.InvokeAsync(SearchTerm);
        }
    }

    private async Task ClearSearch()
    {
        SearchTerm = string.Empty;
        await SearchTermChanged.InvokeAsync(SearchTerm);
        
        if (OnSearch.HasDelegate)
        {
            await OnSearch.InvokeAsync(SearchTerm);
        }
    }
}
