/* InteractiveTableComponent 專用樣式 */

/* ===== 序號欄位固定寬度 ===== */
.row-number-column {
    width: 50px !important;
    min-width: 50px !important;
    max-width: 50px !important;
    box-sizing: border-box !important;
}

/* ===== 表格基礎佈局 ===== */
.interactive-table {
    table-layout: auto; /* 使用 auto 佈局，讓欄位可以根據內容和設定的寬度自動調整 */
    width: auto; /* 讓表格寬度由內容決定 */
    min-width: max-content; /* 確保表格寬度至少等於所有欄位 min-width 的總和，不會被壓縮 */
}

/* ===== 表頭樣式 - 參考 GenericEditModalComponent Header 但保持適當字體大小 ===== */

.interactive-table thead {
    background: #1F2937 !important;
    color: white !important;
    border-radius: 12px 12px 0 0 !important;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15) !important;
}

.interactive-table thead th {
    background: transparent !important;
    color: white !important;
    border-color: rgba(255, 255, 255, 0.2) !important; /* 恢復分隔線，使用半透明白色 */
    border-left: 1px solid rgba(255, 255, 255, 0.2) !important;
    border-right: 1px solid rgba(255, 255, 255, 0.2) !important;
    border-bottom: 2px solid rgba(255, 255, 255, 0.3) !important; /* 底部邊框稍粗 */
    border-top: none !important;
    padding: 0.125rem 0.75rem !important; /* 縮小上下內邊距至 0.125rem */
    font-weight: 600 !important;
    font-size: 1rem !important; /* 調整為正常大小，不再過大 */
    vertical-align: middle !important;
    transition: all 0.2s ease !important;
}

/* 移除表頭第一個儲存格的左邊框 */
.interactive-table thead tr th:first-child {
    border-top-left-radius: 12px !important;
    border-left: none !important;
}

/* 移除表頭最後一個儲存格的右邊框 */
.interactive-table thead tr th:last-child {
    border-top-right-radius: 12px !important;
    border-right: none !important;
}

/* 表頭圖標樣式 */
.interactive-table thead th i {
    color: rgba(255, 255, 255, 0.9) !important;
    margin-right: 0.5rem;
}

/* 表頭必填標記樣式 */
.interactive-table thead th .text-danger {
    color: rgba(255, 150, 150, 0.95) !important;
    font-weight: bold !important;
}

/* 表格基本樣式 */
.interactive-table tbody tr {
    transition: background-color 0.15s ease-in-out, color 0.15s ease-in-out; /* 添加平滑過渡效果 */
}

/* Hover 效果 - 符合規格：文字 #92400e，背景 #fde68a */
.interactive-table tbody tr:hover td {
    background-color: #fde68a !important;
    color: #92400e !important;
}

/* 選取的 Row 樣式 - 使用較深的黃色背景以區分 */
.interactive-table tbody tr.row-selected td {
    background-color: #fcd34d !important; /* 較深的黃色，與 hover 的 #fde68a 區分 */
    color: #92400e !important;
    font-weight: 500;
}

/* 選取的 Row 在 Hover 時的樣式 - 使用更深的顏色 */
.interactive-table tbody tr.row-selected:hover td {
    background-color: #fbbf24 !important; /* 更深的黃色 */
    color: #78350f !important; /* 更深的棕色 */
}

/* 表格儲存格的 padding 設定 */
.interactive-table tbody td {
    padding: 0.125rem 0.75rem !important; /* 縮小上下內邊距至 0.125rem */
    vertical-align: middle; /* 所有儲存格內容垂直置中 */
    transition: background-color 0.15s ease-in-out, color 0.15s ease-in-out; /* 添加平滑過渡效果 */
}

    /* 操作欄位智慧調整樣式 - 手機版也使用自動調整 */
    .table-responsive .table .table-actions-column {
        min-width: 100px; /* 增加最小寬度以確保有足夠空間容納按鈕 */
        max-width: none; /* 移除最大寬度限制，允許根據內容擴展 */
        white-space: nowrap; /* 防止內容換行 */
        padding: 0.25rem 0.5rem !important; /* 確保有適當的內邊距 */
        vertical-align: middle !important; /* 垂直置中 */
        text-align: center !important; /* 水平置中 */
        /* 移除固定寬度限制，讓組件的 GetActionsColumnStyle() 方法來控制寬度 */
    }
    
    /* 當操作欄位有明確寬度設定時，在行動裝置上也要尊重該設定 */
    .table-responsive .table .table-actions-column[style*="width"] {
        min-width: unset !important; /* 移除最小寬度限制，完全依賴 inline style 設定 */
        max-width: unset !important; /* 移除最大寬度限制 */
        /* inline style 的寬度會自動生效，不需要額外設定 */
    }

/* 表格控件樣式 - 縮減 Padding - 使用 ::deep 確保能夠影響到 CustomTemplate */
::deep .interactive-table-container .form-control,
::deep .interactive-table-container .form-select,
::deep .interactive-table .form-control,
::deep .interactive-table .form-select,
::deep .interactive-table tbody .form-control,
::deep .interactive-table tbody .form-select {
    padding: 0.125rem 0.5rem !important; /* 縮小上下內邊距至 0.125rem */
    font-size: 1rem !important;
    border-radius: 0.25rem;
}

/* textarea 特別調整 */
::deep .interactive-table-container textarea.form-control,
::deep .interactive-table textarea.form-control {
    padding: 0.125rem 0.5rem !important; /* 縮小上下內邊距至 0.125rem */
    font-size: 1rem !important;
}

/* 驗證錯誤樣式 */
.interactive-table-container .is-invalid {
    border-color: #dc3545;
    box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
}

/* 勾選框置中樣式 */
.interactive-table-container .form-check.form-switch {
    padding-left: 0;
}

.interactive-table-container .form-check-input {
    margin-left: 0;
}

/* 按鈕在表格中的樣式調整 */
.interactive-table-container .btn-sm {
    padding: 0.125rem 0.5rem; /* 縮小上下內邊距至 0.125rem */
    font-size: 1rem;
}

/* 操作欄位基礎樣式設置 - 適用於所有螢幕尺寸 */
.table-actions-column {
    min-width: 80px; /* 基礎最小寬度以容納操作按鈕 */
    max-width: none; /* 允許欄位根據內容擴展 */
    white-space: nowrap; /* 防止內容換行 */
    vertical-align: middle !important; /* 垂直置中 */
    text-align: center !important; /* 水平置中 */
    padding: 0.125rem 0.25rem !important; /* 縮小上下內邊距至 0.125rem */
}

/* 當操作欄位有明確寬度設定時，尊重該設定 */
.table-actions-column[style*="width"] {
    min-width: unset; /* 移除最小寬度限制 */
    max-width: unset; /* 移除最大寬度限制 */
}

/* 操作欄位內容容器樣式 */
.table-actions-column .d-flex {
    align-items: center !important; /* 垂直置中 */
    justify-content: center !important; /* 水平置中 */
    height: 100%; /* 占滿整個儲存格高度 */
    gap: 0.25rem; /* 按鈕間距 */
    flex-wrap: nowrap; /* 確保按鈕不會換行 */
    min-width: fit-content; /* 確保容器能夠適應內容大小 */
}

/* 操作欄位內按鈕樣式 */
.table-actions-column .btn {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    white-space: nowrap; /* 確保按鈕文字不會換行 */
    min-width: fit-content; /* 按鈕寬度適應內容 */
}

/* 操作欄位的正方形按鈕 - 縮小至 24px 以配合緊湊行高 */
/* btn-square 預設 30px，此處覆蓋避免撐高行距 */
::deep .table-actions-column .btn-square {
    width: 24px !important;
    height: 24px !important;
}

/* 手機版優化 */
@media (max-width: 767px) {
    /* 表頭在手機版的樣式調整 */
    .interactive-table thead th {
        padding: 0.125rem 0.5rem !important; /* 縮小上下內邊距至 0.125rem */
        font-size: 1rem !important; /* 手機版使用稍小的字體 */
    }
    
    /* 表格容器水平滾動設置 */
    .table-responsive {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch; /* iOS 平滑滾動 */
        width: 100%;
        max-width: 100%;
    }
    
    /* 確保表格不會被壓縮，保持最小寬度 */
    .table-responsive .table {
        min-width: 900px; /* 進一步增加表格最小寬度以確保操作欄位有足夠空間 */
        margin-bottom: 0;
        white-space: nowrap; /* 防止文字換行 */
        table-layout: auto; /* 使用 auto 佈局，配合 min-width 避免欄位被壓縮 */
        width: max-content; /* 讓表格寬度適應內容 */
    }
    
    /* 表格儲存格在手機版的樣式調整 */
    .table-responsive .table td,
    .table-responsive .table th {
        padding: 0.125rem 0.75rem; /* 縮小上下內邊距至 0.125rem */
        white-space: nowrap;
    }
    
    /* 只對沒有明確寬度設定且非操作欄位的儲存格設置最小寬度 */
    .table-responsive .table td:not([style*="width"]):not(.table-actions-column),
    .table-responsive .table th:not([style*="width"]):not(.table-actions-column) {
        min-width: 80px; /* 設置儲存格最小寬度 */
    }
    
    /* 控制項在手機版的樣式調整 */
    .interactive-table-container .form-control-sm,
    .interactive-table-container .form-select-sm {
        font-size: 1rem;
        padding: 0.125rem 0.5rem; /* 縮小上下內邊距至 0.125rem */
        min-height: 32px; /* 調整最小高度以配合較小的 padding */
        min-width: 120px; /* 確保輸入框有足夠寬度 */
    }
    
    .interactive-table-container .btn-sm {
        min-height: 32px; /* 調整最小高度以配合較小的 padding */
        padding: 0.125rem 0.5rem; /* 縮小上下內邊距至 0.125rem */
        min-width: 60px; /* 確保按鈕有足夠寬度 */
        font-size: 1rem; /* 確保字體大小正常 */
    }
    
    /* 確保表格內按鈕圖標大小正常 */
    .interactive-table-container .btn i {
        font-size: 1rem; /* 確保圖標大小正常 */
    }
    
    /* 針對特定欄位類型的寬度設置 */
    .table-responsive .table td input[type="text"],
    .table-responsive .table td input[type="number"] {
        min-width: 100px;
    }
    
    .table-responsive .table td select {
        min-width: 120px;
    }
    
    /* 行號欄位保持固定寬度 */
    .row-number-column {
        width: 50px !important;
        min-width: 50px !important;
        max-width: 50px !important;
        padding: 0.5rem 0.25rem !important;
        box-sizing: border-box !important;
    }

    /* 操作欄位適當樣式 */
    .table-responsive .table .table-actions-column {
        min-width: 120px !important; /* 增加最小寬度以確保有足夠空間容納按鈕 */
        white-space: nowrap; /* 防止內容換行 */
        padding: 0.125rem 0.75rem !important; /* 縮小上下內邊距至 0.125rem */
        vertical-align: middle !important; /* 垂直置中 */
        text-align: center !important; /* 水平置中 */
    }
    
    /* 當操作欄位有明確寬度設定時，在行動裝置上也要尊重該設定 */
    .table-responsive .table .table-actions-column[style*="width"] {
        min-width: unset !important; /* 移除最小寬度限制 */
    }
    
    /* 操作欄位內的按鈕樣式 - 保持彈性尺寸 */
    .table-responsive .table .table-actions-column .btn {
        padding: 0.125rem 0.5rem; /* 縮小上下內邊距至 0.125rem */
        font-size: 1rem; /* 按鈕字體大小 */
        margin: 0 0.125rem; /* 按鈕間距 */
        min-width: 32px; /* 調整最小寬度以配合較小的 padding */
        min-height: 32px; /* 調整最小高度以配合較小的 padding */
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        /* 讓按鈕能夠根據內容自動調整大小 */
        width: auto; /* 自動寬度 */
    }
    
    /* 操作欄位內的圖標樣式 */
    .table-responsive .table .table-actions-column .btn i {
        font-size: 1rem !important; /* 確保圖標大小正常，使用 !important 覆蓋其他樣式 */
    }
    
    /* 操作欄位內的 flex 容器樣式 - 支援智慧調整 */
    .table-responsive .table .table-actions-column .d-flex {
        gap: 0.375rem !important; /* 稍微增加按鈕之間的間距 */
        justify-content: center !important;
        align-items: center !important;
        height: 100% !important; /* 占滿整個儲存格高度 */
        flex-wrap: nowrap !important; /* 確保按鈕不會換行 */
        min-width: fit-content; /* 確保容器能夠適應內容大小 */
    }
    
    /* 為手機用戶添加滾動提示 */
    .table-responsive::after {
        display: block;
        text-align: center;
        padding: 0.5rem;
        background-color: #f8f9fa;
        color: #6c757d;
        font-size: 1rem;
        border-top: 1px solid #dee2e6;
    }
    
    /* 當表格內容超出容器寬度時才顯示提示 */
    .table-responsive .table {
        position: relative;
    }
}

/* 數字輸入框樣式 */
.interactive-table-container input[type="number"] {
    text-align: right;
}

/* 隱藏 number input 的上下箭頭 */
.interactive-table-container input[type="number"]::-webkit-outer-spin-button,
.interactive-table-container input[type="number"]::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

.interactive-table-container input[type="number"] {
    appearance: textfield;
    -moz-appearance: textfield;
}

/* 唯讀控件樣式 */
.interactive-table-container .form-control[readonly],
.interactive-table-container .form-select[disabled] {
    background-color: #f8f9fa;
    cursor: not-allowed;
}

/* 必填欄位標記 */
.interactive-table-container .text-danger {
    color: #dc2626 !important;
    font-weight: bold;
}

/* 行號樣式 */
.interactive-table-container .row-number {
    color: #6c757d;
    font-weight: 500;
    font-size: 1rem;
}

/* 水平滾動條樣式優化 - 始終可見 */
.table-responsive::-webkit-scrollbar {
    height: 10px; /* 稍微加大滾動條高度以便操作 */
}

.table-responsive::-webkit-scrollbar-track {
    background: #e9ecef;
    border-radius: 4px;
    box-shadow: inset 0 0 2px rgba(0, 0, 0, 0.1);
}

.table-responsive::-webkit-scrollbar-thumb {
    background: linear-gradient(180deg, #a0a0a0, #888888);
    border-radius: 4px;
    border: 1px solid #d0d0d0;
}

.table-responsive::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(180deg, #888888, #666666);
}

/* Firefox 滾動條樣式 */
.table-responsive {
    scrollbar-width: auto; /* 使用標準滾動條寬度 */
    scrollbar-color: #888888 #e9ecef; /* thumb 和 track 顏色 */
}

/* 確保表格在所有螢幕尺寸下都能正常顯示 */
.table-responsive {
    border-radius: 12px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
    overflow-x: auto !important; /* 始終啟用水平滾動，避免欄位被壓縮 */
    overflow-y: visible; /* 垂直方向允許內容超出（例如下拉選單） */
    -webkit-overflow-scrolling: touch; /* iOS 平滑滾動 */
}

/* 確保 .table-responsive 內的表格正確擴展 */
.table-responsive .interactive-table {
    width: 100%; /* 預設填滿容器 */
    min-width: max-content; /* 但不會小於內容所需的最小寬度 */
}

/* 表格整體容器樣式 */
.interactive-table-container {
    border-radius: 12px;
    overflow: visible; /* 改為 visible 以支援下拉選單和滾動條正常顯示 */
}

/* 表格本身的樣式 */
.interactive-table {
    margin-bottom: 0 !important;
    border-collapse: separate;
    border-spacing: 0;
}

/* 確保 tbody 與 thead 無縫連接 */
.interactive-table tbody tr:first-child td {
    border-top: 2px solid var(--border-light) !important;
}

/* 搜尋下拉選單樣式優化 - 使用 fixed 定位解決手機版被裁切問題 */
/* position: fixed 的元素不受父容器 overflow 影響，所以不需要修改父容器的 overflow */
::deep .searchable-dropdown.show {
    position: fixed !important; /* 使用 fixed 定位，脫離文檔流，相對於視窗定位 */
    z-index: 99999 !important; /* 極高層級，確保顯示在 Modal 和其他元素之上 */
    transform: none !important; /* 移除可能的變換效果 */
    will-change: auto !important; /* 優化渲染性能 */
    -webkit-transform: none !important; /* Safari 兼容 */
    background-color: var(--bg-primary) !important;
    border: 1px solid var(--border-color) !important;
    border-radius: 0.375rem !important;
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
}

/* 隱藏數字輸入框的上下拉桿 (spinner) - 適用於所有瀏覽器 */
/* 使用 ::deep 讓樣式能夠穿透到 CustomTemplate 中的 input */
/* Chrome, Safari, Edge, Opera */
::deep input[type="number"]::-webkit-outer-spin-button,
::deep input[type="number"]::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

/* Firefox */
::deep input[type="number"] {
    -moz-appearance: textfield;
    appearance: textfield;
}

/* 下拉選單在手機版的優化 */
@media (max-width: 767px) {
    /* 下拉選項在手機版的觸控優化 */
    ::deep .dropdown-item {
        padding: 12px 16px !important; /* 增加觸控區域 */
        line-height: 1.4;
        font-size: 1rem;
    }
    
    /* 下拉選單項目選中狀態在手機版的顯示優化 */
    ::deep .dropdown-item.active {
        background-color: #007bff !important;
    }
    
    /* 手機版搜尋下拉選單 - 使用 fixed 定位 */
    ::deep .searchable-dropdown.show {
        position: fixed !important;
        z-index: 99999 !important;
        max-height: 40vh !important; /* 限制最大高度 */
        overflow-y: auto !important;
        -webkit-overflow-scrolling: touch; /* iOS 平滑滾動 */
    }
}

/* ===== 拖放功能樣式 ===== */

/* 可拖曳的行 - 使用 !important 確保覆蓋其他游標樣式 */
::deep tr[draggable="true"] {
    cursor: grab !important;
    user-select: none;
}

::deep tr[draggable="true"]:active {
    cursor: grabbing !important;
}

/* 正在被拖曳的行 */
::deep tr.dragging {
    opacity: 0.5;
    background-color: #e3f2fd !important;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

::deep tr.dragging td {
    background-color: #e3f2fd !important;
    color: #1976d2 !important;
}

/* 拖曳經過的目標行（顯示插入位置） */
::deep tr.drag-over {
    position: relative;
}

::deep tr.drag-over::after {
    content: '';
    position: absolute;
    left: 0;
    right: 0;
    bottom: -2px;
    height: 3px;
    background: linear-gradient(90deg, #1976d2, #42a5f5, #1976d2);
    border-radius: 2px;
    animation: drag-indicator-pulse 1s ease-in-out infinite;
}

@keyframes drag-indicator-pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
}

/* 放置目標區域（表格層級） */
::deep tbody.drop-target-active {
    background-color: rgba(25, 118, 210, 0.05);
    outline: 2px dashed #1976d2;
    outline-offset: -2px;
    transition: all 0.2s ease;
}

/* 空表格的放置區域 */
::deep .drop-zone {
    min-height: 120px;
    transition: all 0.2s ease;
}

::deep tr.drop-zone-active td {
    background-color: rgba(25, 118, 210, 0.1) !important;
    border: 2px dashed #1976d2 !important;
}

::deep .drop-zone-hint {
    padding: 1rem;
    animation: drop-zone-hint-bounce 0.5s ease-in-out;
}

@keyframes drop-zone-hint-bounce {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

::deep .drop-zone-hint i {
    color: #1976d2 !important;
    animation: drop-icon-pulse 1.5s ease-in-out infinite;
}

@keyframes drop-icon-pulse {
    0%, 100% { 
        transform: scale(1);
        opacity: 1;
    }
    50% { 
        transform: scale(1.1);
        opacity: 0.8;
    }
}

/* 拖曳時的行選取樣式覆蓋 */
::deep tr.dragging.row-selected td {
    background-color: #bbdefb !important;
}

/* 拖放提示圖標 */
::deep .drag-handle {
    cursor: grab;
    color: #9e9e9e;
    transition: color 0.2s ease;
}

::deep .drag-handle:hover {
    color: #616161;
}

::deep tr.dragging .drag-handle {
    cursor: grabbing;
    color: #1976d2;
}

/* ===== 深色模式覆寫 ===== */

/* 表格 body hover / 選取列：使用 CSS 變數替換硬編碼的黃色 */
[data-bs-theme=dark] .interactive-table tbody tr:hover td {
    background-color: var(--table-hover-bg) !important;
    color: var(--table-hover-text) !important;
}

[data-bs-theme=dark] .interactive-table tbody tr.row-selected td {
    background-color: var(--table-hover-bg-striped) !important;
    color: var(--table-hover-text) !important;
}

[data-bs-theme=dark] .interactive-table tbody tr.row-selected:hover td {
    background-color: var(--table-hover-bg-striped) !important;
    color: var(--table-hover-text) !important;
}

/* 唯讀 / 停用控件背景 */
[data-bs-theme=dark] .interactive-table-container .form-control[readonly],
[data-bs-theme=dark] .interactive-table-container .form-select[disabled] {
    background-color: var(--bg-tertiary) !important;
    color: var(--text-secondary) !important;
}

/* 搜尋下拉選單深色模式 — 已移至全域 app.css
   原因：在 .razor.css 中，[data-bs-theme=dark] 選擇器無法與 Blazor scope attribute
   正確組合（會被編譯為 [data-bs-theme=dark][b-xxx]，永遠不匹配），
   因此統一在全域 CSS 中處理，不依賴 scoped CSS isolation。*/

/* 滾動條深色模式 */
[data-bs-theme=dark] .table-responsive::-webkit-scrollbar-track {
    background: var(--bg-tertiary);
    box-shadow: inset 0 0 2px rgba(0, 0, 0, 0.3);
}

[data-bs-theme=dark] .table-responsive::-webkit-scrollbar-thumb {
    background: linear-gradient(180deg, #4e5058, #3d3f47);
    border: 1px solid var(--border-color);
}

[data-bs-theme=dark] .table-responsive::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(180deg, #6e7178, #5d5f67);
}

[data-bs-theme=dark] .table-responsive {
    scrollbar-color: #4e5058 var(--bg-tertiary);
}

