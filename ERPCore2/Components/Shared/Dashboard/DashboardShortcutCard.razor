@using ERPCore2.Models.Navigation
@using ERPCore2.Data.Navigation
@using Microsoft.Extensions.Localization
@inject IStringLocalizer<SharedResource> L

<div class="shortcut-card @(IsEditMode ? "edit-mode" : "")"
     @onclick="HandleClick"
     title="@NavigationItem.Description">

    @if (IsEditMode)
    {
        <button class="btn-remove" @onclick="HandleRemove" @onclick:stopPropagation="true" title="@L["Dashboard.RemoveShortcut"]">
            <i class="bi bi-x-lg"></i>
        </button>
    }

    <div class="shortcut-icon">
        <i class="@GetEffectiveIcon()"></i>
    </div>
    <div class="shortcut-name">@NavigationItem.Name</div>
</div>

@code {
    [Parameter, EditorRequired]
    public NavigationItem NavigationItem { get; set; } = default!;

    [Parameter]
    public bool IsEditMode { get; set; } = false;

    [Parameter]
    public EventCallback OnRemove { get; set; }

    [Parameter]
    public EventCallback OnClick { get; set; }

    private async Task HandleClick()
    {
        if (!IsEditMode && OnClick.HasDelegate)
        {
            await OnClick.InvokeAsync();
        }
    }

    private async Task HandleRemove()
    {
        if (OnRemove.HasDelegate)
        {
            await OnRemove.InvokeAsync();
        }
    }

    /// <summary>
    /// 取得有效的圖示
    /// 如果項目圖示為空或箭頭，則使用 Category 對應圖示
    /// </summary>
    private string GetEffectiveIcon()
    {
        var icon = NavigationItem.IconClass;
        
        // 無效圖示：空、箭頭
        if (string.IsNullOrWhiteSpace(icon) || icon == "bi bi-caret-right-fill")
        {
            return NavigationConfig.GetCategoryIcon(NavigationItem.Category);
        }
        
        return icon;
    }
}
