@namespace ERPCore2.Components

<!DOCTYPE html>
<html lang="@System.Globalization.CultureInfo.CurrentUICulture.TwoLetterISOLanguageName">

<head>    
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <base href="/" />    <link rel="stylesheet" href="@Assets["lib/bootstrap/dist/css/bootstrap.min.css"]" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />    
    <link rel="stylesheet" href="@Assets["css/colors.css"]" />
    <link rel="stylesheet" href="@Assets["css/app.css"]" />
    <link rel="stylesheet" href="@Assets["css/toast.css"]" />
    <link rel="stylesheet" href="@Assets["ERPCore2.styles.css"]" />
    <ImportMap />
    <link rel="icon" type="image/png" href="favicon.png" />
    <HeadOutlet />
</head>

<body>    
    <Routes @rendermode="InteractiveServer" />
    
    <script src="@Assets["lib/bootstrap/dist/js/bootstrap.bundle.min.js"]"></script>
    @* 暫時停用以診斷連線問題 - 診斷完成後再開啟 *@
    @* <script src="@Assets["js/blazor-error-handler.js"]"></script> *@
    <script src="@Assets["js/bootstrap-helpers.js"]"></script>
    <script src="@Assets["js/toast.js"]"></script>
    <script src="@Assets["js/clipboard-helper.js"]"></script>
    <script src="@Assets["js/modal-helpers.js"]"></script>
    <script src="@Assets["js/nav-menu-mobile.js"]"></script>
    <script src="@Assets["js/batch-print-helpers.js"]"></script>
    <script src="@Assets["js/date-input-helper.js"]"></script>
    <script src="@Assets["js/mobile-phone-helper.js"]"></script>
    <script src="@Assets["js/number-input-helper.js"]"></script>
    <script src="@Assets["js/interactiveTableDropdown.js"]"></script>
    <script src="@Assets["js/drag-drop-helper.js"]"></script>
    <script src="@Assets["js/file-download-helper.js"]"></script>
    <script src="@Assets["js/culture-helper.js"]"></script>

    @* JsBarcode CDN - 用於條碼生成（defer 避免阻塞 blazor.web.js 載入）*@
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js" defer></script>
    <script src="@Assets["js/barcode-generator.js"]"></script>
    
    <script src="_framework/blazor.web.js"></script>

    @* ── 診斷用全域導航追蹤（偵錯完成後移除） ── *@
    <script>
        (function () {
            console.log('[App] 頁面載入，URL:', location.href);

            // 攔截 history.pushState（Blazor enhanced navigation 使用此方式改 URL）
            const _origPushState = history.pushState;
            history.pushState = function (state, title, url) {
                console.log('[Nav] pushState →', url);
                return _origPushState.apply(history, arguments);
            };
            window.addEventListener('popstate', function () {
                console.log('[Nav] popstate，URL:', location.href);
            });

            // Blazor Enhanced Navigation 事件
            document.addEventListener('enhancednavigationstart', function (e) {
                console.log('[Nav] Enhanced START →', e.detail?.url ?? '(unknown)', '| 當前:', location.href);
            });
            document.addEventListener('enhancednavigationend', function (e) {
                console.log('[Nav] Enhanced END，URL:', location.href);
            });

            // Blazor Circuit 連線狀態（blazor.web.js 載入後才有 Blazor 物件）
            document.addEventListener('DOMContentLoaded', function () {
                console.log('[App] DOMContentLoaded，URL:', location.href);
            });
        })();
    </script>
</body>

</html>
