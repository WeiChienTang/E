# å•†å“æ’ç¨‹è£½ä½œç³»çµ±è¨­è¨ˆæ–‡ä»¶

> æ–‡ä»¶å»ºç«‹æ—¥æœŸï¼š2024/12/06  
> ç‰ˆæœ¬ï¼šv1.0

---

## ç›®éŒ„

1. [ç³»çµ±æ¦‚è¿°](#ç³»çµ±æ¦‚è¿°)
2. [æ¥­å‹™æµç¨‹](#æ¥­å‹™æµç¨‹)
3. [è¨­è¨ˆæ±ºç­–æ‘˜è¦](#è¨­è¨ˆæ±ºç­–æ‘˜è¦)
4. [è³‡æ–™æ¨¡å‹è¨­è¨ˆ](#è³‡æ–™æ¨¡å‹è¨­è¨ˆ)
5. [é é¢è¨­è¨ˆ](#é é¢è¨­è¨ˆ)
6. [é–‹ç™¼è¦ç¯„](#é–‹ç™¼è¦ç¯„)
7. [å¯¦ä½œæ­¥é©Ÿè¦åŠƒ](#å¯¦ä½œæ­¥é©Ÿè¦åŠƒ)
8. [ç›¸é—œæª”æ¡ˆæ¸…å–®](#ç›¸é—œæª”æ¡ˆæ¸…å–®)

---

## ç³»çµ±æ¦‚è¿°

### ç›®æ¨™

å»ºç«‹å®Œæ•´çš„ç”Ÿç”¢æ’ç¨‹ç³»çµ±ï¼Œè®“ä½¿ç”¨è€…å¯ä»¥ï¼š

1. å¾**éŠ·è²¨è¨‚å–®é é¢**ç¯©é¸éœ€è¦ç”Ÿç”¢çš„è¨‚å–®æ˜ç´°
2. é€é**ç”Ÿç”¢æ’ç¨‹ï¼ˆè£½ä½œè¡¨ï¼‰**å®‰æ’å“ªäº›è¨‚å–®è¦è¢«åˆ—å…¥æ’ç¨‹
3. è¿½è¹¤ç”Ÿç”¢é€²åº¦ç›´åˆ°å®Œæˆå…¥åº«

### æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½æ¨¡çµ„ | èªªæ˜ |
|---------|------|
| éŠ·è²¨è¨‚å–®ç®¡ç† | ç¯©é¸åº«å­˜ä¸è¶³çš„è¨‚å–®ï¼Œæ”¯æ´æ‰¹æ¬¡è½‰æ’ç¨‹ |
| ç”Ÿç”¢æ’ç¨‹ç·¨è¼¯ | ç®¡ç†æ’ç¨‹é …ç›®ã€å±•é–‹ BOM çµ„ä»¶ã€è¿½è¹¤ç‹€æ…‹ |
| è½‰æ’ç¨‹åŠŸèƒ½ | å¾éŠ·è²¨è¨‚å–® BOM ç·¨è¼¯ç•«é¢ç›´æ¥è½‰å…¥æ’ç¨‹ |
| ç‹€æ…‹è¿½è¹¤ | é€éå®Œå·¥ç™»éŒ„è‡ªå‹•æ›´æ–°ç”Ÿç”¢ç‹€æ…‹ |

---

## æ¥­å‹™æµç¨‹

### å®Œæ•´æµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”Ÿç”¢æ’ç¨‹å®Œæ•´æµç¨‹                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  éŠ·è²¨è¨‚å–®é é¢                                              ç”Ÿç”¢æ’ç¨‹
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ è¨‚å–®æ˜ç´°     â”‚â”€â”€(BOMç·¨è¼¯â†’è½‰æ’ç¨‹)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚   è£½ä½œè¡¨    â”‚
 â”‚ + BOMçµ„æˆ   â”‚                                        â”‚ æ’ç¨‹æ˜ç´°    â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                                                        â”‚
      â”‚                                                        â”‚
      â”‚                                                        â–¼
      â”‚                                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                                                  â”‚ å±•é–‹ BOM    â”‚
      â”‚                                                  â”‚ çµ„ä»¶éœ€æ±‚    â”‚
      â”‚                                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                                                        â”‚
      â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚    â”‚
      â”‚    â–¼
      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  â”‚   å¾…ç”Ÿç”¢    â”‚â”€â”€â”€â”€â†’â”‚   è£½ä½œä¸­    â”‚â”€â”€â”€â”€â†’â”‚   å·²å®Œæˆ    â”‚
      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚         â”‚                   â”‚                    â”‚
      â”‚         â”‚                   â”‚                    â”‚
      â”‚      é–‹å§‹ç”Ÿç”¢            çµ„ä»¶é ˜æ–™            å®Œå·¥ç™»éŒ„
      â”‚                                                  â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€(å›å¯«å·²æ’ç¨‹æ¨™è¨˜)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æµç¨‹èªªæ˜

#### Step 1ï¼šéŠ·è²¨è¨‚å–®å»ºç«‹

1. å»ºç«‹éŠ·è²¨è¨‚å–®åŠæ˜ç´°
2. ç·¨è¼¯ BOM çµ„æˆï¼ˆSalesOrderCompositionDetailï¼‰
3. ç³»çµ±è‡ªå‹•æª¢æŸ¥åº«å­˜ç‹€æ…‹

#### Step 2ï¼šå¾è¨‚å–®è½‰å…¥æ’ç¨‹

1. åœ¨éŠ·è²¨è¨‚å–®é é¢ç¯©é¸éœ€è¦æ’ç¨‹çš„è¨‚å–®
2. é–‹å•Ÿè¨‚å–®ç·¨è¼¯ï¼Œé€²å…¥ BOM çµ„æˆç·¨è¼¯
3. é»æ“Šã€Œè½‰æ’ç¨‹ã€æŒ‰éˆ•
4. ç³»çµ±å»ºç«‹ç”Ÿç”¢æ’ç¨‹ä¸¦å±•é–‹ BOM

#### Step 3ï¼šå»ºç«‹ç”Ÿç”¢æ’ç¨‹

1. ç³»çµ±å»ºç«‹ ProductionSchedule ä¸»æª”
2. å»ºç«‹ ProductionScheduleItemï¼ˆæˆå“å±¤ç´šï¼‰
3. æ¯å€‹è¨‚å–®æ˜ç´°ç¨ç«‹å»ºç«‹æ’ç¨‹é …ç›®
4. è‡ªå‹•å±•é–‹ BOMï¼Œå»ºç«‹ ProductionScheduleDetailï¼ˆçµ„ä»¶éœ€æ±‚ï¼‰
5. è¿½è¹¤çµ„ä»¶åº«å­˜ç‹€æ…‹èˆ‡é ˜æ–™è¨˜éŒ„

#### Step 4ï¼šç”Ÿç”¢èˆ‡å…¥åº«

1. ç”Ÿç”¢äººå“¡ä¾æ’ç¨‹é€²è¡Œç”Ÿç”¢
2. é€éå…¥åº«å–®è§¸ç™¼ç‹€æ…‹è®Šæ›´
3. ç‹€æ…‹ï¼šå¾…ç”Ÿç”¢ â†’ è£½ä½œä¸­ â†’ å·²å…¥åº«

---

## è¨­è¨ˆæ±ºç­–æ‘˜è¦

### æ ¸å¿ƒæ±ºç­–

| æ±ºç­–é …ç›® | é¸æ“‡ | èªªæ˜ |
|---------|------|------|
| æ•´é«”æ–¹æ¡ˆ | æ–¹æ¡ˆ Aï¼ˆç°¡æ˜“æ¨¡å¼ï¼‰ | é©åˆä¸­å°ä¼æ¥­ï¼Œæ‰‹å‹•é¸æ“‡è¦æ’ç¨‹çš„è¨‚å–® |
| æ’ç¨‹ç²’åº¦ | æ··åˆæ¨¡å¼ | ä»¥ç”¢å“ç‚ºå–®ä½ç”Ÿç”¢ï¼ˆæ•ˆç‡ï¼‰ï¼Œä½†ä¿ç•™è¨‚å–®è¿½æº¯ï¼ˆå¯è¿½æº¯æ€§ï¼‰ |
| åˆä½µç”Ÿç”¢æ™‚æ©Ÿ | ä½¿ç”¨è€…é¸æ“‡ | è½‰æ’ç¨‹æ™‚è©¢å•ã€Œæ˜¯å¦åˆä½µç›¸åŒç”¢å“ï¼Ÿã€ |
| åº«å­˜æ‰£æŠµ | é¡¯ç¤ºåƒè€ƒ | é¡¯ç¤ºåº«å­˜æ•¸é‡ä¾›ä½¿ç”¨è€…åƒè€ƒï¼Œä¸è‡ªå‹•æ‰£æŠµè¨ˆç®— |
| ç‹€æ…‹è¿½è¹¤ | ç°¡åŒ–ä¸‰æ…‹ | å¾…ç”Ÿç”¢ â†’ è£½ä½œä¸­ â†’ å·²å…¥åº« |
| BOM è™•ç† | å±•é–‹é¡¯ç¤º | å¾ ProductCompositionDetail å±•é–‹ BOM çµ„ä»¶ |

### ç´°ç¯€æ±ºç­–

| æ±ºç­–é …ç›® | é¸æ“‡ | èªªæ˜ |
|---------|------|------|
| ä¾†æºè¨‚å–®é¡¯ç¤º | å¯å±•é–‹æŸ¥çœ‹ | æ’ç¨‹é …ç›®å¯å±•é–‹æŸ¥çœ‹è©³ç´°çš„è¨‚å–®åˆ†é…æ˜ç´° |
| çµ„ä»¶åº«å­˜ä¸è¶³ | æç¤ºå¾Œé¸æ“‡ | é¡¯ç¤ºè­¦ç¤ºï¼Œä½¿ç”¨è€…å¯é¸æ“‡ç¹¼çºŒæˆ–å–æ¶ˆ |
| ç‹€æ…‹è®Šæ›´æ™‚æ©Ÿ | æŒ‰éˆ•è§¸ç™¼ | ã€Œé–‹å§‹ç”Ÿç”¢ã€â†’è£½ä½œä¸­ã€ã€Œå®Œæˆå…¥åº«ã€â†’å·²å…¥åº« |
| è½‰æ’ç¨‹å…¥å£é» | A + B | A: BOM ç·¨è¼¯ Modalã€B: è¨‚å–®ç·¨è¼¯ Modal |
| éƒ¨åˆ†æ’ç¨‹ | å…è¨± | å¯é¸æ“‡æ’ç¨‹éƒ¨åˆ†æ•¸é‡ï¼Œå‰©é¤˜æ•¸é‡å¯å¾ŒçºŒå†æ’ç¨‹ |
| åˆä½µç›¸åŒç”¢å“ | ä¸åˆä½µ | æ¯å€‹è¨‚å–®æ˜ç´°ç¨ç«‹å»ºç«‹æ’ç¨‹é …ç›®ï¼Œç°¡åŒ–è¿½æº¯ |
| å…¥åº«æ–¹å¼ | å®Œæ•´ç‰ˆ | å»ºç«‹ ProductionScheduleCompletion è¨˜éŒ„æ¯æ¬¡å…¥åº« |
| å…¥åº«è§¸ç™¼ | æ’ç¨‹å…§æ“ä½œ | é»æ“Šã€Œå®Œæˆå…¥åº«ã€æŒ‰éˆ•ç›´æ¥è™•ç† |
| çµ„ä»¶é ˜æ–™ | è‡ªå‹•æ‰£é™¤ | é–‹å§‹ç”Ÿç”¢æ™‚è‡ªå‹•æ‰£åº«å­˜ï¼Œè¨˜éŒ„ã€Œç”Ÿç”¢ä¸­ã€æ•¸é‡ |

---

## è³‡æ–™æ¨¡å‹è¨­è¨ˆ

### å¯¦é«”é—œè¯åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ProductionSchedule              â”‚  (ç”Ÿç”¢æ’ç¨‹ä¸»æª”)
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ Id                              â”‚
â”‚ Code (æ’ç¨‹ä»£ç¢¼)                  â”‚
â”‚ ScheduleDate (æ’ç¨‹æ—¥æœŸ)          â”‚
â”‚ CustomerId (å®¢æˆ¶ï¼Œå¯ç‚ºç©º)         â”‚
â”‚ CreatedByEmployeeId (è£½å–®äººå“¡)   â”‚
â”‚ Remarks (å‚™è¨»)                   â”‚
â”‚ Status (EntityStatus)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ 1:N
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ProductionScheduleItem (æ’ç¨‹é …ç›®)                         â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ Id                                                       â”‚
â”‚ ProductionScheduleId (FK â†’ ProductionSchedule)           â”‚
â”‚ ProductId (FK â†’ Productï¼Œæˆå“)                            â”‚
â”‚ SalesOrderDetailId (FK â†’ SalesOrderDetailï¼Œä¾†æºè¨‚å–®)      â”‚
â”‚ ScheduledQuantity (æ’ç¨‹æ•¸é‡)                              â”‚
â”‚ CompletedQuantity (å·²å®Œæˆæ•¸é‡)                            â”‚
â”‚ ProductionItemStatus (å¾…ç”Ÿç”¢/è£½ä½œä¸­/å·²å…¥åº«)                â”‚
â”‚ Remarks (å‚™è¨»)                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ 1:N
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ProductionScheduleDetail      â”‚  â”‚ ProductionScheduleCompletion    â”‚
â”‚ (çµ„ä»¶éœ€æ±‚)                     â”‚  â”‚ (å®Œå·¥è¨˜éŒ„)                       â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ Id                            â”‚  â”‚ Id                              â”‚
â”‚ ProductionScheduleItemId (FK) â”‚  â”‚ ProductionScheduleItemId (FK)   â”‚
â”‚ ComponentProductId (FK)       â”‚  â”‚ Quantity (å…¥åº«æ•¸é‡)              â”‚
â”‚ ProductCompositionDetailId    â”‚  â”‚ WarehouseId (å…¥åº«å€‰åº«)           â”‚
â”‚ RequiredQuantity (éœ€æ±‚æ•¸é‡)    â”‚  â”‚ CompletionDate (å…¥åº«æ—¥æœŸ)        â”‚
â”‚ IssuedQuantity (å·²é ˜æ•¸é‡)      â”‚  â”‚ Remarks                         â”‚
â”‚ WarehouseId (é ˜æ–™å€‰åº«)         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ FK
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    SalesOrderDetail           â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ ScheduledQuantity (å·²æ’ç¨‹æ•¸é‡) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ–°å¢åˆ—èˆ‰

```csharp
// æª”æ¡ˆï¼šData/Enums/ProductionItemStatus.cs

namespace ERPCore2.Data.Enums
{
    /// <summary>
    /// ç”Ÿç”¢æ’ç¨‹é …ç›®ç‹€æ…‹
    /// </summary>
    public enum ProductionItemStatus
    {
        /// <summary>
        /// å¾…ç”Ÿç”¢ - æ’ç¨‹å·²å»ºç«‹ï¼Œç­‰å¾…é–‹å§‹ç”Ÿç”¢
        /// </summary>
        Pending = 0,

        /// <summary>
        /// è£½ä½œä¸­ - æ­£åœ¨ç”Ÿç”¢
        /// </summary>
        InProgress = 1,

        /// <summary>
        /// å·²å…¥åº« - ç”Ÿç”¢å®Œæˆä¸¦å·²å…¥åº«
        /// </summary>
        Completed = 2
    }
}
```

### æ–°å¢å¯¦é«”ï¼šProductionScheduleItem

```csharp
// æª”æ¡ˆï¼šData/Entities/ProductionManagement/ProductionScheduleItem.cs

using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;
using Microsoft.EntityFrameworkCore;
using ERPCore2.Data.Enums;

namespace ERPCore2.Data.Entities
{
    /// <summary>
    /// ç”Ÿç”¢æ’ç¨‹é …ç›® - è¨˜éŒ„è¦ç”Ÿç”¢çš„å•†å“é …ç›®ï¼ˆä»¥ç”¢å“ç‚ºå–®ä½ï¼‰
    /// æ¯å€‹éŠ·å”®è¨‚å–®æ˜ç´°è½‰æ’ç¨‹æœƒç”¢ç”Ÿä¸€ç­† ProductionScheduleItem
    /// </summary>
    [Index(nameof(ProductionScheduleId), nameof(ProductId))]
    [Index(nameof(SalesOrderDetailId))]
    [Index(nameof(ProductionItemStatus))]
    public class ProductionScheduleItem : BaseEntity
    {
        // === ç”Ÿç”¢è³‡è¨Š ===
        
        /// <summary>
        /// æ’ç¨‹æ•¸é‡ - æœ¬æ¬¡è¦ç”Ÿç”¢çš„æ•¸é‡
        /// </summary>
        [Required(ErrorMessage = "æ’ç¨‹æ•¸é‡ç‚ºå¿…å¡«")]
        [Display(Name = "æ’ç¨‹æ•¸é‡")]
        [Column(TypeName = "decimal(18,3)")]
        public decimal ScheduledQuantity { get; set; } = 0;
        
        /// <summary>
        /// å·²å®Œæˆæ•¸é‡ - å·²å…¥åº«çš„å®Œæˆå“æ•¸é‡
        /// </summary>
        [Display(Name = "å·²å®Œæˆæ•¸é‡")]
        [Column(TypeName = "decimal(18,3)")]
        public decimal CompletedQuantity { get; set; } = 0;
        
        /// <summary>
        /// å¾…å®Œæˆæ•¸é‡ - è¨ˆç®—å±¬æ€§
        /// </summary>
        [Display(Name = "å¾…å®Œæˆæ•¸é‡")]
        [NotMapped]
        public decimal PendingQuantity => ScheduledQuantity - CompletedQuantity;
        
        /// <summary>
        /// ç”Ÿç”¢é …ç›®ç‹€æ…‹
        /// </summary>
        [Required(ErrorMessage = "ç”Ÿç”¢ç‹€æ…‹ç‚ºå¿…å¡«")]
        [Display(Name = "ç”Ÿç”¢ç‹€æ…‹")]
        public ProductionItemStatus ProductionItemStatus { get; set; } = ProductionItemStatus.Pending;
        
        /// <summary>
        /// å‚™è¨»
        /// </summary>
        [Display(Name = "å‚™è¨»")]
        [StringLength(500)]
        public string? Remarks { get; set; }
        
        // === é—œè¯è³‡è¨Š ===
        
        /// <summary>
        /// ç”Ÿç”¢æ’ç¨‹ä¸»æª”ID (FK)
        /// </summary>
        [Required(ErrorMessage = "ç”Ÿç”¢æ’ç¨‹ä¸»æª”ç‚ºå¿…å¡«")]
        [Display(Name = "ç”Ÿç”¢æ’ç¨‹ä¸»æª”")]
        [ForeignKey(nameof(ProductionSchedule))]
        public int ProductionScheduleId { get; set; }
        
        /// <summary>
        /// ç”¢å“ID (FK) - è¦ç”Ÿç”¢çš„æˆå“
        /// </summary>
        [Required(ErrorMessage = "ç”¢å“ç‚ºå¿…å¡«")]
        [Display(Name = "ç”¢å“")]
        [ForeignKey(nameof(Product))]
        public int ProductId { get; set; }
        
        /// <summary>
        /// éŠ·è²¨è¨‚å–®æ˜ç´°ID (FK) - ä¾†æºè¨‚å–®æ˜ç´°
        /// </summary>
        [Display(Name = "éŠ·è²¨è¨‚å–®æ˜ç´°")]
        [ForeignKey(nameof(SalesOrderDetail))]
        public int? SalesOrderDetailId { get; set; }
        
        // === Navigation Properties ===
        
        public ProductionSchedule ProductionSchedule { get; set; } = null!;
        public Product Product { get; set; } = null!;
        public SalesOrderDetail? SalesOrderDetail { get; set; }
        
        /// <summary>
        /// æ’ç¨‹æ˜ç´°ï¼ˆBOM çµ„ä»¶éœ€æ±‚ï¼‰
        /// </summary>
        public ICollection<ProductionScheduleDetail> ScheduleDetails { get; set; } = new List<ProductionScheduleDetail>();
        
        /// <summary>
        /// å®Œå·¥è¨˜éŒ„
        /// </summary>
        public ICollection<ProductionScheduleCompletion> Completions { get; set; } = new List<ProductionScheduleCompletion>();
        
        // === è¨ˆç®—å±¬æ€§ ===
        
        [NotMapped]
        public bool IsCompleted => CompletedQuantity >= ScheduledQuantity;

        [NotMapped]
        public decimal CompletionPercentage => ScheduledQuantity > 0 
            ? Math.Round(CompletedQuantity / ScheduledQuantity * 100, 2) 
            : 0;
    }
}
```

### ~~æ–°å¢å¯¦é«”ï¼šProductionScheduleAllocation~~ï¼ˆå·²ç§»é™¤ï¼‰

**2024/12/08 æ›´æ–°**ï¼šæ­¤å¯¦é«”å·²åœ¨æ¶æ§‹å„ªåŒ–ä¸­ç§»é™¤ã€‚è¨‚å–®è¿½æº¯æ”¹ç‚ºé€é `ProductionScheduleItem.SalesOrderDetailId` ç›´æ¥é—œè¯,ç°¡åŒ–äº†è³‡æ–™çµæ§‹ã€‚

### èª¿æ•´ç¾æœ‰å¯¦é«”ï¼šProductionScheduleDetail

éœ€èª¿æ•´é—œè¯å¾ `ProductionScheduleId` æ”¹ç‚º `ProductionScheduleItemId`ï¼š

```csharp
// åŸæœ¬ï¼špublic int ProductionScheduleId { get; set; }
// æ”¹ç‚ºï¼špublic int ProductionScheduleItemId { get; set; }

// ä¸¦æ›´æ–° Navigation Property
// åŸæœ¬ï¼špublic ProductionSchedule ProductionSchedule { get; set; } = null!;
// æ”¹ç‚ºï¼špublic ProductionScheduleItem ProductionScheduleItem { get; set; } = null!;
```

### SalesOrderDetail æ–°å¢æ¬„ä½

```csharp
// åœ¨ SalesOrderDetail ä¸­æ–°å¢ï¼Œç”¨æ–¼è¿½è¹¤æ’ç¨‹ç‹€æ…‹

[Display(Name = "å·²æ’ç¨‹æ•¸é‡")]
[Column(TypeName = "decimal(18,4)")]
public decimal ScheduledQuantity { get; set; } = 0;

[NotMapped]
public bool IsFullyScheduled => ScheduledQuantity >= Quantity;

[NotMapped]
public decimal UnscheduledQuantity => Quantity - ScheduledQuantity;
```

---

## è½‰æ’ç¨‹å…¥å£é»è¨­è¨ˆ

### è½‰æ’ç¨‹å…¥å£é»ï¼šBOM ç·¨è¼¯ Modal

**ä½ç½®**ï¼š`SalesOrderCompositionEditModal.razor` çš„ HeaderButtons

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ ç·¨è¼¯ BOM çµ„æˆ - æˆå“X                          [è½‰æ’ç¨‹] [å„²å­˜] [å–æ¶ˆ] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ...BOM çµ„ä»¶åˆ—è¡¨...                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åŠŸèƒ½**ï¼š
- å°‡ç•¶å‰ç·¨è¼¯çš„å–®ä¸€è¨‚å–®æ˜ç´°è½‰å…¥æ’ç¨‹
- ç›´æ¥å»ºç«‹ç”Ÿç”¢æ’ç¨‹ä¸¦å±•é–‹ BOM çµ„ä»¶
- é¡¯ç¤ºåº«å­˜æª¢æŸ¥èˆ‡è­¦ç¤ºè¨Šæ¯

---

## è½‰æ’ç¨‹ç¢ºèª Modal è¨­è¨ˆ

### å–®ä¸€æ˜ç´°è½‰æ’ç¨‹ï¼ˆå…¥å£é» Aï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ è½‰å…¥ç”Ÿç”¢æ’ç¨‹                                                    [X]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   ç”¢å“è³‡è¨Š                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ ç”¢å“ï¼š[P001] æˆå“X                                              â”‚  â”‚
â”‚   â”‚ è¨‚å–®ç·¨è™Ÿï¼šSO2024-001                                            â”‚  â”‚
â”‚   â”‚ å®¢æˆ¶ï¼šå®¢æˆ¶A                                                     â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â”‚   æ•¸é‡è³‡è¨Š                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ è¨‚å–®æ•¸é‡ï¼š      100                                             â”‚  â”‚
â”‚   â”‚ å·²æ’ç¨‹æ•¸é‡ï¼š    30                                              â”‚  â”‚
â”‚   â”‚ å¯æ’ç¨‹æ•¸é‡ï¼š    70                                              â”‚  â”‚
â”‚   â”‚                                                                 â”‚  â”‚
â”‚   â”‚ æœ¬æ¬¡æ’ç¨‹æ•¸é‡ï¼š  [____70____]  â† å¯ç·¨è¼¯ï¼Œé è¨­ç‚ºå¯æ’ç¨‹æ•¸é‡         â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â”‚   åº«å­˜ç‹€æ…‹                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ æˆå“åº«å­˜ï¼š30                                                    â”‚  â”‚
â”‚   â”‚ åº«å­˜ç¼ºå£ï¼š40 (æœ¬æ¬¡æ’ç¨‹ 70 - åº«å­˜ 30)                            â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â”‚   BOM çµ„ä»¶åº«å­˜æª¢æŸ¥                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ çµ„ä»¶      â”‚ éœ€æ±‚æ•¸é‡ â”‚ åº«å­˜  â”‚ ç‹€æ…‹                             â”‚  â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚   â”‚ åŸæ–™A     â”‚ 140     â”‚ 500  â”‚ âœ… è¶³å¤                            â”‚  â”‚
â”‚   â”‚ åŸæ–™B     â”‚ 105     â”‚ 100  â”‚ âš ï¸ ä¸è¶³ 5                        â”‚  â”‚
â”‚   â”‚ åŠæˆå“C   â”‚ 70      â”‚ 50   â”‚ âš ï¸ ä¸è¶³ 20                       â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â”‚   âš ï¸ æœ‰ 2 é …çµ„ä»¶åº«å­˜ä¸è¶³ï¼Œæ˜¯å¦ä»è¦å»ºç«‹æ’ç¨‹ï¼Ÿ                            â”‚
â”‚                                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              [å–æ¶ˆ]  [ç¢ºèªè½‰æ’ç¨‹]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## é é¢è¨­è¨ˆ

### 1. ç”Ÿç”¢æ’ç¨‹ç·¨è¼¯ï¼ˆè£½ä½œè¡¨ï¼‰

**æª”æ¡ˆè·¯å¾‘**ï¼š`Components/Pages/ProductionManagement/ProductionScheduleEditModalComponent.razor`ï¼ˆå¢å¼·ç¾æœ‰ï¼‰

#### UI è¨­è¨ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ ç”Ÿç”¢æ’ç¨‹ PS2024-001                              [å„²å­˜] [å–æ¶ˆ]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åŸºæœ¬è³‡è¨Š                                                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ æ’ç¨‹ä»£ç¢¼ï¼šPS2024-001          æ’ç¨‹æ—¥æœŸï¼š2024/12/10                   â”‚â”‚
â”‚ â”‚ å®¢æˆ¶ï¼š(ä¾é …ç›®)                è£½å–®äººå“¡ï¼šç‹å°æ˜                        â”‚â”‚
â”‚ â”‚ å‚™è¨»ï¼š_______________________________________________                 â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ã€æ’ç¨‹é …ç›®ã€‘                                               [æ–°å¢é …ç›®]   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ç”¢å“      â”‚éœ€æ±‚æ•¸é‡â”‚ åº«å­˜ â”‚å·²å®Œæˆâ”‚ ç‹€æ…‹  â”‚å„ªå…ˆåºâ”‚ ä¾†æºè¨‚å–®    â”‚ æ“ä½œ  â”‚â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚ â”‚[P001]æˆå“Xâ”‚ 180   â”‚ 30  â”‚ 0   â”‚å¾…ç”Ÿç”¢ â”‚ 1   â”‚ 2ç­† [å±•é–‹â–¼]â”‚[åˆªé™¤]â”‚â”‚
â”‚ â”‚[P003]æˆå“Zâ”‚ 30    â”‚ 10  â”‚ 0   â”‚å¾…ç”Ÿç”¢ â”‚ 2   â”‚ 1ç­† [å±•é–‹â–¼]â”‚[åˆªé™¤]â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                         â”‚
â”‚ ã€è¨‚å–®åˆ†é…æ˜ç´° - æˆå“Xã€‘                                   [æ”¶åˆ â–²]     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ è¨‚å–®ç·¨è™Ÿ     â”‚ å®¢æˆ¶     â”‚ åˆ†é…æ•¸é‡ â”‚ å·²å‡ºè²¨ â”‚ äº¤æœŸ     â”‚ å‚™è¨»       â”‚â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚ â”‚ SO2024-001   â”‚ å®¢æˆ¶A   â”‚ 100     â”‚ 0     â”‚ 12/15   â”‚            â”‚â”‚
â”‚ â”‚ SO2024-002   â”‚ å®¢æˆ¶B   â”‚ 80      â”‚ 0     â”‚ 12/18   â”‚            â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                         â”‚
â”‚ ã€BOM çµ„ä»¶å±•é–‹ - æˆå“X (éœ€æ±‚: 180)ã€‘                       [æ”¶åˆ â–²]     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ çµ„ä»¶        â”‚å–®ä½éœ€æ±‚ â”‚ ç¸½éœ€æ±‚  â”‚ åº«å­˜  â”‚ ç‹€æ…‹     â”‚ é ˜æ–™å€‰åº«    â”‚â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚ â”‚ [M001]åŸæ–™A â”‚ 2.00   â”‚ 360    â”‚ 500  â”‚ âœ… è¶³å¤   â”‚ [åŸæ–™å€‰ â–¼] â”‚â”‚
â”‚ â”‚ [M002]åŸæ–™B â”‚ 1.50   â”‚ 270    â”‚ 100  â”‚ âš ï¸ ä¸è¶³ â”‚ [åŸæ–™å€‰ â–¼] â”‚â”‚
â”‚ â”‚ [S001]åŠæˆå“Câ”‚ 1.00   â”‚ 180    â”‚ 50   â”‚ âš ï¸ ä¸è¶³ â”‚ [åŠæˆå“å€‰â–¼]â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                         â”‚
â”‚ âš ï¸ è­¦å‘Šï¼šæœ‰ 2 é …çµ„ä»¶åº«å­˜ä¸è¶³ï¼Œè«‹ç¢ºèªæ˜¯å¦ç¹¼çºŒå»ºç«‹æ’ç¨‹ï¼Ÿ                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### åŠŸèƒ½èªªæ˜

| å€å¡Š | åŠŸèƒ½ |
|------|------|
| åŸºæœ¬è³‡è¨Š | æ’ç¨‹ä¸»æª”è³‡è¨Šç·¨è¼¯ |
| æ’ç¨‹é …ç›® | ä½¿ç”¨ InteractiveTableComponent ç®¡ç†æˆå“é …ç›® |
| è¨‚å–®åˆ†é…æ˜ç´° | å¯å±•é–‹æŸ¥çœ‹è©²é …ç›®ä¾†è‡ªå“ªäº›è¨‚å–®ï¼ˆå”¯è®€ï¼‰ |
| BOM çµ„ä»¶å±•é–‹ | è‡ªå‹•å¾ ProductCompositionDetail å±•é–‹ï¼Œé¡¯ç¤ºåº«å­˜ç‹€æ…‹ |
| åº«å­˜è­¦ç¤º | çµ„ä»¶åº«å­˜ä¸è¶³æ™‚é¡¯ç¤ºè­¦ç¤ºï¼Œä½¿ç”¨è€…å¯é¸æ“‡ç¹¼çºŒæˆ–å–æ¶ˆ |

---

### 2. éŠ·è²¨è¨‚å–® BOM ç·¨è¼¯ï¼ˆè½‰æ’ç¨‹åŠŸèƒ½ï¼‰

**æª”æ¡ˆè·¯å¾‘**ï¼š`Components/Shared/BaseModal/Modals/Sales/SalesOrderCompositionEditModal.razor`

#### è½‰æ’ç¨‹æŒ‰éˆ•

åœ¨ BOM ç·¨è¼¯ Modal çš„ HeaderButtons å€åŸŸæ–°å¢ã€Œè½‰æ’ç¨‹ã€æŒ‰éˆ•ï¼š

```razor
<GenericButtonComponent Text="è½‰æ’ç¨‹"
                       Icon="bi bi-calendar-plus"
                       Variant="ButtonVariant.Success"
                       OnClick="@HandleTransferToSchedule"
                       IsDisabled="@(!CanTransferToSchedule())" />
```

#### åŠŸèƒ½æµç¨‹

1. æª¢æŸ¥è¨‚å–®æ˜ç´°æ˜¯å¦å·²å®Œå…¨æ’ç¨‹
2. å»ºç«‹ ProductionSchedule + ProductionScheduleItem
3. è‡ªå‹•å±•é–‹ BOM å»ºç«‹ ProductionScheduleDetail
4. æª¢æŸ¥çµ„ä»¶åº«å­˜ç‹€æ…‹ä¸¦é¡¯ç¤ºè­¦ç¤º
5. å›å¯« SalesOrderDetail.ScheduledQuantity
6. å°èˆªè‡³ç”Ÿç”¢æ’ç¨‹ç·¨è¼¯é é¢

---

## é–‹ç™¼è¦ç¯„

### çµ„ä»¶ä½¿ç”¨è¦ç¯„

æœ¬å°ˆæ¡ˆæ‰€æœ‰ UI é–‹ç™¼å¿…é ˆéµå¾ªä»¥ä¸‹è¦ç¯„ï¼š

#### Modal çµ„ä»¶è¦ç¯„

**æ‰€æœ‰ Modal å¿…é ˆä½¿ç”¨ `BaseModalComponent` ä½œç‚ºåŸºç¤æ¡†æ¶**

æª”æ¡ˆä½ç½®ï¼š`Components/Shared/BaseModal/BaseFrameworkComponent/BaseModalComponent.razor`

```razor
<BaseModalComponent IsVisible="@IsVisible"
                   IsVisibleChanged="@IsVisibleChanged"
                   Title="Modal æ¨™é¡Œ"
                   Icon="bi bi-diagram-3"
                   HeaderColor="BaseModalComponent.HeaderVariant.Info"
                   ShowFooter="false"
                   CloseOnBackdropClick="false"
                   CloseOnEscape="true"
                   IsLoading="@isLoading"
                   LoadingMessage="è¼‰å…¥ä¸­..."
                   HeaderButtons="@HeaderButtons"
                   BodyContent="@BodyContent" />
```

**ä¸»è¦åƒæ•¸èªªæ˜ï¼š**

| åƒæ•¸ | é¡å‹ | èªªæ˜ |
|------|------|------|
| `IsVisible` | bool | æ§åˆ¶ Modal é¡¯ç¤º/éš±è— |
| `IsVisibleChanged` | EventCallback<bool> | é¡¯ç¤ºç‹€æ…‹è®Šæ›´å›èª¿ |
| `Title` | string | Modal æ¨™é¡Œ |
| `Icon` | string | æ¨™é¡Œåœ–ç¤ºï¼ˆBootstrap Iconsï¼‰ |
| `HeaderColor` | HeaderVariant | Header é¡è‰²è®Šé«” |
| `Size` | ModalSize | Modal å°ºå¯¸ï¼ˆSmall/Default/Large/ExtraLarge/Desktopï¼‰ |
| `HeaderButtons` | RenderFragment | Header å³å´æŒ‰éˆ•å€ |
| `BodyContent` | RenderFragment | Modal ä¸»é«”å…§å®¹ |
| `ShowFooter` | bool | æ˜¯å¦é¡¯ç¤º Footer |
| `IsLoading` | bool | è¼‰å…¥ä¸­ç‹€æ…‹ |

#### è¡¨æ ¼çµ„ä»¶è¦ç¯„

**æ‰€æœ‰å¯ç·¨è¼¯è¡¨æ ¼å¿…é ˆä½¿ç”¨ `InteractiveTableComponent` ä½œç‚ºåŸºç¤æ¡†æ¶**

æª”æ¡ˆä½ç½®ï¼š`Components/Shared/BaseModal/BaseTableComponent/InteractiveTableComponent.razor`

```razor
<InteractiveTableComponent TItem="ProductionScheduleItem"
                          Items="@scheduleItems"
                          ColumnDefinitions="@GetColumnDefinitions()"
                          IsReadOnly="@IsReadOnly"
                          ShowHeader="true"
                          ShowActions="false"
                          ShowBuiltInActions="true"
                          ShowBuiltInDeleteButton="true"
                          OnItemDelete="@HandleItemDelete"
                          EnableAutoEmptyRow="true"
                          CreateEmptyItem="@CreateEmptyItem"
                          DataLoadCompleted="@_dataLoadCompleted"
                          IsStriped="true"
                          IsHoverable="true"
                          IsBordered="true"
                          EmptyMessage="å°šæœªæ–°å¢é …ç›®" />
```

**ä¸»è¦åƒæ•¸èªªæ˜ï¼š**

| åƒæ•¸ | é¡å‹ | èªªæ˜ |
|------|------|------|
| `TItem` | æ³›å‹ | è³‡æ–™é …ç›®é¡å‹ |
| `Items` | List<TItem> | è³‡æ–™é›†åˆ |
| `ColumnDefinitions` | List<InteractiveColumnDefinition> | æ¬„ä½å®šç¾© |
| `IsReadOnly` | bool | æ˜¯å¦å”¯è®€æ¨¡å¼ |
| `ShowBuiltInActions` | bool | é¡¯ç¤ºå…§å»ºæ“ä½œæŒ‰éˆ•ï¼ˆåˆªé™¤ç­‰ï¼‰ |
| `EnableAutoEmptyRow` | bool | è‡ªå‹•ç®¡ç†ç©ºè¡Œ |
| `CreateEmptyItem` | Func<TItem> | å»ºç«‹ç©ºè¡Œçš„æ–¹æ³• |
| `DataLoadCompleted` | bool | è³‡æ–™è¼‰å…¥å®Œæˆæ¨™è¨˜ |
| `OnItemDelete` | EventCallback<TItem> | åˆªé™¤é …ç›®äº‹ä»¶ |

**æ¬„ä½é¡å‹ (InteractiveColumnType)ï¼š**

| é¡å‹ | èªªæ˜ |
|------|------|
| `Display` | ç´”é¡¯ç¤ºï¼ˆå”¯è®€ï¼‰ |
| `Input` | æ–‡å­—è¼¸å…¥ |
| `Number` | æ•¸å­—è¼¸å…¥ |
| `Select` | ä¸‹æ‹‰é¸å–® |
| `Checkbox` | å‹¾é¸æ¡† |
| `Button` | æŒ‰éˆ• |
| `Custom` | è‡ªè¨‚æ¨¡æ¿ |
| `SearchableSelect` | å¯æœå°‹ä¸‹æ‹‰é¸å–® |

### æœ¬å°ˆæ¡ˆéœ€è¦å»ºç«‹çš„ Modal

| Modal åç¨± | ç”¨é€” | åŸºç¤çµ„ä»¶ |
|-----------|------|---------|
| `ProductionScheduleItemEditModal` | æ’ç¨‹é …ç›®ç·¨è¼¯èˆ‡ç‹€æ…‹ç®¡ç† | BaseModalComponent |
| `ProductionCompletionModal` | å®Œå·¥ç™»éŒ„ | BaseModalComponent |
| `MaterialIssueModal` | çµ„ä»¶é ˜æ–™ | BaseModalComponent |

### æœ¬å°ˆæ¡ˆéœ€è¦ä½¿ç”¨è¡¨æ ¼çš„é é¢

| é é¢/çµ„ä»¶ | è¡¨æ ¼ç”¨é€” | åŸºç¤çµ„ä»¶ |
|----------|---------|---------|
| `ProductionScheduleEditModalComponent` | æ’ç¨‹é …ç›®åˆ—è¡¨ | äº’å‹•å¼å¡ç‰‡å±•ç¤º |
| `ProductionScheduleItemEditModal` | BOM çµ„ä»¶å±•é–‹é¡¯ç¤º | HTML Table |
| `ProductionScheduleIndex` | æ’ç¨‹æ¸…å–® | GenericIndexPageComponent |

---

## å¯¦ä½œæ­¥é©Ÿè¦åŠƒ

### Phase 1ï¼šè³‡æ–™æ¨¡å‹å»ºç«‹

**é è¨ˆå·¥æ™‚**ï¼š6-8 å°æ™‚

| æ­¥é©Ÿ | æª”æ¡ˆ | èªªæ˜ |
|------|------|------|
| 1.1 | `Data/Enums/ProductionItemStatus.cs` | æ–°å¢ç”Ÿç”¢ç‹€æ…‹åˆ—èˆ‰ |
| 1.2 | `Data/Entities/ProductionManagement/ProductionScheduleItem.cs` | æ–°å¢æ’ç¨‹é …ç›®å¯¦é«” |
| 1.3 | `Data/Entities/ProductionManagement/ProductionScheduleAllocation.cs` | æ–°å¢è¨‚å–®åˆ†é…å¯¦é«” |
| 1.4 | `Data/Entities/ProductionManagement/ProductionScheduleCompletion.cs` | æ–°å¢å…¥åº«è¨˜éŒ„å¯¦é«” |
| 1.5 | `Data/Entities/ProductionManagement/ProductionScheduleDetail.cs` | èª¿æ•´é—œè¯åˆ° Item |
| 1.6 | `Data/Entities/Sales/SalesOrderDetail.cs` | æ–°å¢ ScheduledQuantity æ¬„ä½ |
| 1.7 | `Data/Entities/Warehouses/InventoryStockDetail.cs` | æ–°å¢ InProductionStock æ¬„ä½ |
| 1.8 | `Data/Entities/Warehouses/InventoryStock.cs` | èª¿æ•´ TotalAvailableStock è¨ˆç®— |
| 1.9 | `Data/Context/AppDbContext.cs` | è¨»å†Šæ–°å¯¦é«” |
| 1.10 | `Migrations/` | å»ºç«‹ Migration |

### Phase 2ï¼šService å±¤å»ºç«‹

**é è¨ˆå·¥æ™‚**ï¼š6-8 å°æ™‚

| æ­¥é©Ÿ | æª”æ¡ˆ | èªªæ˜ |
|------|------|------|
| 2.1 | `Services/ProductionManagement/IProductionScheduleItemService.cs` | ä»‹é¢å®šç¾© |
| 2.2 | `Services/ProductionManagement/ProductionScheduleItemService.cs` | æœå‹™å¯¦ä½œ |
| 2.3 | `Services/ProductionManagement/IProductionScheduleAllocationService.cs` | ä»‹é¢å®šç¾© |
| 2.4 | `Services/ProductionManagement/ProductionScheduleAllocationService.cs` | æœå‹™å¯¦ä½œ |
| 2.5 | `Services/ProductionManagement/IProductionScheduleCompletionService.cs` | å…¥åº«è¨˜éŒ„ä»‹é¢ |
| 2.6 | `Services/ProductionManagement/ProductionScheduleCompletionService.cs` | å…¥åº«è¨˜éŒ„æœå‹™ |
| 2.7 | `Services/ProductionManagement/ProductionScheduleService.cs` | èª¿æ•´ç¾æœ‰æœå‹™ |
| 2.8 | `Services/ProductionManagement/IProductionTransferService.cs` | è½‰æ’ç¨‹ä»‹é¢ |
| 2.9 | `Services/ProductionManagement/ProductionTransferService.cs` | è½‰æ’ç¨‹æ¥­å‹™é‚è¼¯ |
| 2.10 | `Services/ProductionManagement/IProductionExecutionService.cs` | ç”Ÿç”¢åŸ·è¡Œä»‹é¢ï¼ˆé–‹å§‹ç”Ÿç”¢ã€å®Œæˆå…¥åº«ï¼‰ |
| 2.11 | `Services/ProductionManagement/ProductionExecutionService.cs` | ç”Ÿç”¢åŸ·è¡Œæœå‹™ |
| 2.12 | `Data/ServiceRegistration.cs` | è¨»å†Šæ–°æœå‹™ |

### Phase 3ï¼šå¾…æ’ç¨‹å·¥ä½œå°

**é è¨ˆå·¥æ™‚**ï¼š6-8 å°æ™‚ï¼ˆPhase 2 é€²éšåŠŸèƒ½ï¼Œå¯å»¶å¾Œï¼‰

| æ­¥é©Ÿ | æª”æ¡ˆ | èªªæ˜ |
|------|------|------|
| 3.1 | `Components/Pages/ProductionManagement/ProductionPendingWorkbench.razor` | é é¢å»ºç«‹ |
| 3.2 | `Services/ProductionManagement/PendingScheduleQueryService.cs` | å¾…æ’ç¨‹æŸ¥è©¢æœå‹™ |
| 3.3 | ç¯©é¸åŠŸèƒ½ | äº¤æœŸã€å®¢æˆ¶ã€ç”¢å“ç¯©é¸ |
| 3.4 | å‹¾é¸åŠŸèƒ½ | å¤šé¸é …ç›® |
| 3.5 | è½‰æ’ç¨‹åŠŸèƒ½ | å€‹åˆ¥/åˆä½µå»ºç«‹ |

### Phase 4ï¼šç”Ÿç”¢æ’ç¨‹ç·¨è¼¯å¢å¼·

**é è¨ˆå·¥æ™‚**ï¼š8-10 å°æ™‚

| æ­¥é©Ÿ | æª”æ¡ˆ | èªªæ˜ |
|------|------|------|
| 4.1 | `ProductionScheduleEditModalComponent.razor` | é‡æ§‹ç¾æœ‰çµ„ä»¶ |
| 4.2 | æ’ç¨‹é …ç›®è¡¨æ ¼ | ä½¿ç”¨ InteractiveTableComponent |
| 4.3 | è¨‚å–®åˆ†é…å±•é–‹ | å¯å±•é–‹/æ”¶åˆçš„å­è¡¨æ ¼ |
| 4.4 | BOM å±•é–‹é¡¯ç¤º | è‡ªå‹•å±•é–‹ä¸¦é¡¯ç¤ºåº«å­˜ç‹€æ…‹ |
| 4.5 | åº«å­˜è­¦ç¤ºè™•ç† | ä¸è¶³æ™‚æç¤ºç¢ºèª |

### Phase 5ï¼šè½‰æ’ç¨‹åŠŸèƒ½æ•´åˆ

**é è¨ˆå·¥æ™‚**ï¼š6-8 å°æ™‚

| æ­¥é©Ÿ | æª”æ¡ˆ | èªªæ˜ |
|------|------|------|
| 5.1 | `Components/Shared/BaseModal/Modals/ProductionManagement/TransferToScheduleModal.razor` | æ–°å¢ï¼šå–®ä¸€æ˜ç´°è½‰æ’ç¨‹ç¢ºèª Modal |
| 5.2 | `Components/Shared/BaseModal/Modals/ProductionManagement/BatchTransferToScheduleModal.razor` | æ–°å¢ï¼šæ‰¹æ¬¡è½‰æ’ç¨‹ç¢ºèª Modal |
| 5.3 | `SalesOrderCompositionEditModal.razor` | ä¿®æ”¹ï¼šæ–°å¢ã€Œè½‰æ’ç¨‹ã€æŒ‰éˆ•ï¼ˆå…¥å£é» Aï¼‰ |
| 5.4 | `SalesOrderEditModalComponent.razor` | ä¿®æ”¹ï¼šæ–°å¢ã€Œè½‰æ’ç¨‹ã€æŒ‰éˆ•ï¼ˆå…¥å£é» Bï¼‰ |
| 5.5 | è½‰æ’ç¨‹é‚è¼¯ | å‘¼å« ProductionTransferService |
| 5.6 | å›å¯«è¨‚å–® | æ›´æ–° ScheduledQuantity |
| 5.7 | éƒ¨åˆ†æ’ç¨‹æ”¯æ´ | å…è¨±ä½¿ç”¨è€…è¼¸å…¥æœ¬æ¬¡æ’ç¨‹æ•¸é‡ |

### Phase 6ï¼šç‹€æ…‹è§¸ç™¼æ©Ÿåˆ¶

**é è¨ˆå·¥æ™‚**ï¼š4-6 å°æ™‚

| æ­¥é©Ÿ | æª”æ¡ˆ | èªªæ˜ |
|------|------|------|
| 6.1 | å…¥åº«å–®æ•´åˆ | å…¥åº«æ™‚è§¸ç™¼ç‹€æ…‹è®Šæ›´ |
| 6.2 | ç‹€æ…‹æ›´æ–°æœå‹™ | ProductionStatusUpdateService |
| 6.3 | å·²å®Œæˆæ•¸é‡æ›´æ–° | æ›´æ–° CompletedQuantity |

---

## ç›¸é—œæª”æ¡ˆæ¸…å–®

### ç¾æœ‰æª”æ¡ˆï¼ˆéœ€èª¿æ•´ï¼‰

| æª”æ¡ˆè·¯å¾‘ | èª¿æ•´å…§å®¹ |
|---------|---------|
| `Data/Entities/ProductionManagement/ProductionSchedule.cs` | æ–°å¢ Items å°èˆªå±¬æ€§ |
| `Data/Entities/ProductionManagement/ProductionScheduleDetail.cs` | æ”¹é—œè¯åˆ° ProductionScheduleItem |
| `Data/Entities/Sales/SalesOrderDetail.cs` | æ–°å¢ ScheduledQuantity |
| `Data/Context/AppDbContext.cs` | è¨»å†Šæ–°å¯¦é«”ã€è¨­å®šé—œè¯ |
| `Services/ProductionManagement/ProductionScheduleService.cs` | èª¿æ•´æŸ¥è©¢åŒ…å« Items |
| `Components/Pages/ProductionManagement/ProductionScheduleEditModalComponent.razor` | é‡æ§‹ UI |
| `Components/Shared/BaseModal/Modals/Sales/SalesOrderCompositionEditModal.razor` | æ–°å¢è½‰æ’ç¨‹æŒ‰éˆ• |

### æ–°å¢æª”æ¡ˆ

| æª”æ¡ˆè·¯å¾‘ | èªªæ˜ |
|---------|------|
| `Data/Enums/ProductionItemStatus.cs` | ç”Ÿç”¢ç‹€æ…‹åˆ—èˆ‰ |
| `Data/Entities/ProductionManagement/ProductionScheduleItem.cs` | æ’ç¨‹é …ç›®å¯¦é«” |
| `Data/Entities/ProductionManagement/ProductionScheduleCompletion.cs` | å®Œå·¥è¨˜éŒ„å¯¦é«” |
| `Services/ProductionManagement/IProductionScheduleItemService.cs` | æ’ç¨‹é …ç›®æœå‹™ä»‹é¢ |
| `Services/ProductionManagement/ProductionScheduleItemService.cs` | æ’ç¨‹é …ç›®æœå‹™å¯¦ä½œ |
| `Services/ProductionManagement/IProductionScheduleCompletionService.cs` | å®Œå·¥è¨˜éŒ„æœå‹™ä»‹é¢ |
| `Services/ProductionManagement/ProductionScheduleCompletionService.cs` | å®Œå·¥è¨˜éŒ„æœå‹™å¯¦ä½œ |
| `Components/Pages/ProductionManagement/ProductionScheduleIndex.razor` | ç”Ÿç”¢æ’ç¨‹ç´¢å¼•é é¢ |
| `Components/Pages/ProductionManagement/ProductionScheduleEditModalComponent.razor` | ç”Ÿç”¢æ’ç¨‹ç·¨è¼¯ Modal |
| `Components/Shared/BaseModal/Modals/ProductionManagement/ProductionScheduleItemEditModal.razor` | æ’ç¨‹é …ç›®ç·¨è¼¯ Modal |
| `Components/Shared/BaseModal/Modals/ProductionManagement/ProductionCompletionModal.razor` | å®Œå·¥ç™»éŒ„ Modal |
| `Components/Shared/BaseModal/Modals/ProductionManagement/MaterialIssueModal.razor` | çµ„ä»¶é ˜æ–™ Modal |

---

## è½‰æ’ç¨‹è³‡æ–™ä¾†æºèªªæ˜

### é—œéµå•é¡Œï¼šæ’ç¨‹å¦‚ä½•çŸ¥é“è¦è£½ä½œä»€éº¼ï¼Ÿ

ç•¶å¾éŠ·è²¨è¨‚å–®è½‰æ’ç¨‹æ™‚ï¼Œç³»çµ±éœ€è¦çŸ¥é“ï¼š
1. **è¦ç”Ÿç”¢ä»€éº¼æˆå“ï¼Ÿ** â†’ ä¾†è‡ª `SalesOrderDetail.ProductId`
2. **éœ€è¦å¤šå°‘æ•¸é‡ï¼Ÿ** â†’ ä¾†è‡ª `SalesOrderDetail.Quantity`
3. **éœ€è¦å“ªäº›çµ„ä»¶ï¼Ÿ** â†’ ä¾†è‡ª `SalesOrderCompositionDetail`ï¼ˆå®¢è£½ BOMï¼‰

### è³‡æ–™ä¾†æºï¼šSalesOrderCompositionDetail

```
SalesOrderDetail (è¨‚å–®æ˜ç´°)
â”‚
â”œâ”€ ProductId = æˆå“X (è¦ç”Ÿç”¢çš„æˆå“)
â”œâ”€ Quantity = 100 (ç”Ÿç”¢æ•¸é‡)
â”‚
â””â”€â”€ SalesOrderCompositionDetail (è©²è¨‚å–®çš„å®¢è£½ BOM)
        â”œâ”€ ComponentProductId = åŸæ–™A, Quantity = 2 (æ¯å€‹æˆå“éœ€è¦ 2 å€‹)
        â”œâ”€ ComponentProductId = åŸæ–™B, Quantity = 1.5
        â””â”€ ComponentProductId = åŠæˆå“C, Quantity = 1
```

### è½‰æ›è¨ˆç®—å…¬å¼

```
çµ„ä»¶éœ€æ±‚æ•¸é‡ = SalesOrderCompositionDetail.Quantity Ã— SalesOrderDetail.Quantity

ç¯„ä¾‹ï¼š
- æˆå“X éœ€è¦ç”Ÿç”¢ 100 å€‹
- æ¯å€‹æˆå“X éœ€è¦ 2 å€‹åŸæ–™A
- ç¸½å…±éœ€è¦åŸæ–™A = 2 Ã— 100 = 200 å€‹
```

### å®Œæ•´è½‰æ›æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: ä½¿ç”¨è€…åœ¨ SalesOrderCompositionEditModal é»æ“Šã€Œè½‰æ’ç¨‹ã€           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: ç³»çµ±è®€å– SalesOrderDetail + SalesOrderCompositionDetail         â”‚
â”‚                                                                         â”‚
â”‚   SalesOrderDetail:                                                     â”‚
â”‚   â”œâ”€ Id = 123                                                          â”‚
â”‚   â”œâ”€ ProductId = æˆå“X (Id: 1)                                         â”‚
â”‚   â””â”€ Quantity = 100                                                    â”‚
â”‚                                                                         â”‚
â”‚   SalesOrderCompositionDetail (where SalesOrderDetailId = 123):        â”‚
â”‚   â”œâ”€ { ComponentProductId: åŸæ–™A, Quantity: 2 }                        â”‚
â”‚   â”œâ”€ { ComponentProductId: åŸæ–™B, Quantity: 1.5 }                      â”‚
â”‚   â””â”€ { ComponentProductId: åŠæˆå“C, Quantity: 1 }                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: æŸ¥è©¢åº«å­˜ï¼Œè¨ˆç®—æ·¨éœ€æ±‚ï¼ˆä¾›ä½¿ç”¨è€…åƒè€ƒï¼‰                              â”‚
â”‚                                                                         â”‚
â”‚   æˆå“X:                                                                â”‚
â”‚   â”œâ”€ éœ€æ±‚: 100                                                         â”‚
â”‚   â”œâ”€ ç¾æœ‰åº«å­˜: 30                                                      â”‚
â”‚   â””â”€ ç¼ºå£: 70 (éœ€è¦ç”Ÿç”¢)                                                â”‚
â”‚                                                                         â”‚
â”‚   çµ„ä»¶åº«å­˜ç‹€æ…‹:                                                         â”‚
â”‚   â”œâ”€ åŸæ–™A: éœ€æ±‚ 200, åº«å­˜ 500 âœ…                                       â”‚
â”‚   â”œâ”€ åŸæ–™B: éœ€æ±‚ 150, åº«å­˜ 100 âš ï¸ ä¸è¶³ 50                              â”‚
â”‚   â””â”€ åŠæˆå“C: éœ€æ±‚ 100, åº«å­˜ 50 âš ï¸ ä¸è¶³ 50                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: å»ºç«‹æ’ç¨‹è³‡æ–™                                                    â”‚
â”‚                                                                         â”‚
â”‚   ProductionSchedule (ä¸»æª”):                                            â”‚
â”‚   â”œâ”€ Code = "PS2024-001"                                               â”‚
â”‚   â”œâ”€ ScheduleDate = 2024/12/10                                         â”‚
â”‚   â””â”€ SourceDocumentType = "SalesOrder", SourceDocumentId = è¨‚å–®ID      â”‚
â”‚                                                                         â”‚
â”‚   ProductionScheduleItem (æ’ç¨‹é …ç›®):                                    â”‚
â”‚   â”œâ”€ ProductId = æˆå“X                                                 â”‚
â”‚   â”œâ”€ TotalRequiredQuantity = 100                                       â”‚
â”‚   â”œâ”€ CurrentStockQuantity = 30 (å¿«ç…§)                                  â”‚
â”‚   â””â”€ ProductionStatus = Pending                                        â”‚
â”‚                                                                         â”‚
â”‚   ProductionScheduleAllocation (è¨‚å–®è¿½æº¯):                              â”‚
â”‚   â””â”€ SalesOrderDetailId = 123, Quantity = 100                          â”‚
â”‚                                                                         â”‚
â”‚   ProductionScheduleDetail (çµ„ä»¶éœ€æ±‚):                                  â”‚
â”‚   â”œâ”€ { ComponentProductId: åŸæ–™A, RequiredQuantity: 200 }              â”‚
â”‚   â”œâ”€ { ComponentProductId: åŸæ–™B, RequiredQuantity: 150 }              â”‚
â”‚   â””â”€ { ComponentProductId: åŠæˆå“C, RequiredQuantity: 100 }            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: å›å¯«è¨‚å–®æ˜ç´°çš„å·²æ’ç¨‹æ•¸é‡                                         â”‚
â”‚                                                                         â”‚
â”‚   SalesOrderDetail.ScheduledQuantity += 100                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è½‰æ’ç¨‹æœå‹™æ ¸å¿ƒé‚è¼¯ï¼ˆè™›æ“¬ç¢¼ï¼‰

```csharp
public class ProductionTransferService
{
    /// <summary>
    /// å¾éŠ·è²¨è¨‚å–®æ˜ç´°å»ºç«‹ç”Ÿç”¢æ’ç¨‹
    /// </summary>
    public async Task<ProductionSchedule> CreateFromSalesOrderDetailAsync(
        int salesOrderDetailId,
        decimal? overrideQuantity = null)  // å¯é¸ï¼šè¦†è“‹æ•¸é‡ï¼ˆéƒ¨åˆ†æ’ç¨‹ç”¨ï¼‰
    {
        // 1. è¼‰å…¥è¨‚å–®æ˜ç´°
        var orderDetail = await _salesOrderDetailService.GetByIdAsync(salesOrderDetailId);
        var quantity = overrideQuantity ?? orderDetail.Quantity;
        
        // 2. è¼‰å…¥è©²æ˜ç´°çš„ BOM çµ„æˆ
        var compositionDetails = await _salesOrderCompositionDetailService
            .GetBySalesOrderDetailIdAsync(salesOrderDetailId);
        
        // 3. æŸ¥è©¢åº«å­˜ï¼ˆä¾›åƒè€ƒï¼‰
        var productStock = await _inventoryStockService
            .GetTotalStockByProductIdAsync(orderDetail.ProductId);
        
        // 4. å»ºç«‹æ’ç¨‹ä¸»æª”
        var schedule = new ProductionSchedule
        {
            Code = await GenerateScheduleCode(),
            ScheduleDate = DateTime.Today,
            CustomerId = orderDetail.SalesOrder.CustomerId,
            SourceDocumentType = "SalesOrderDetail",
            SourceDocumentId = salesOrderDetailId
        };
        
        // 5. å»ºç«‹æ’ç¨‹é …ç›®ï¼ˆæˆå“å±¤ç´šï¼‰
        var scheduleItem = new ProductionScheduleItem
        {
            ProductId = orderDetail.ProductId,
            TotalRequiredQuantity = quantity,
            CurrentStockQuantity = productStock,  // å¿«ç…§
            ProductionStatus = ProductionItemStatus.Pending
        };
        
        // 6. å»ºç«‹è¨‚å–®è¿½æº¯
        scheduleItem.Allocations.Add(new ProductionScheduleAllocation
        {
            SalesOrderDetailId = salesOrderDetailId,
            Quantity = quantity
        });
        
        // 7. å±•é–‹ BOM å»ºç«‹çµ„ä»¶éœ€æ±‚
        foreach (var comp in compositionDetails)
        {
            scheduleItem.ScheduleDetails.Add(new ProductionScheduleDetail
            {
                ComponentProductId = comp.ComponentProductId,
                RequiredQuantity = comp.Quantity * quantity,  // é—œéµè¨ˆç®—
                ProductCompositionDetailId = comp.ProductCompositionDetailId
            });
        }
        
        schedule.Items.Add(scheduleItem);
        
        // 8. å„²å­˜
        await _productionScheduleService.CreateAsync(schedule);
        
        // 9. å›å¯«è¨‚å–®æ˜ç´°çš„å·²æ’ç¨‹æ•¸é‡
        orderDetail.ScheduledQuantity += quantity;
        await _salesOrderDetailService.UpdateAsync(orderDetail);
        
        return schedule;
    }
}
```

### ç›¸é—œå¯¦é«”é—œè¯åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    SalesOrder       â”‚     â”‚ ProductionSchedule  â”‚
â”‚    (éŠ·è²¨è¨‚å–®)        â”‚     â”‚   (ç”Ÿç”¢æ’ç¨‹)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ 1:N                       â”‚ 1:N
           â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SalesOrderDetail   â”‚â”€â”€â”€â”€â†’â”‚ ProductionScheduleItem  â”‚
â”‚   (è¨‚å–®æ˜ç´°)         â”‚     â”‚    (æ’ç¨‹é …ç›®)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ 1:N                  â”‚ 1:N     â”‚ 1:N
           â–¼                      â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚SalesOrderCompositionDetailâ”‚  â”‚Schedule  â”‚  â”‚ProductionScheduleAllocationâ”‚
â”‚   (è¨‚å–®å®¢è£½ BOM)          â”‚â”€â”€â†’â”‚Detail    â”‚  â”‚     (è¨‚å–®è¿½æº¯)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚(çµ„ä»¶éœ€æ±‚) â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç‚ºä»€éº¼ä½¿ç”¨ SalesOrderCompositionDetail è€Œé ProductCompositionDetailï¼Ÿ

| æ¯”è¼ƒé …ç›® | ProductCompositionDetail | SalesOrderCompositionDetail |
|---------|-------------------------|----------------------------|
| ä¾†æº | å•†å“ä¸»æª”çš„æ¨™æº– BOM | è¨‚å–®ä¸Šçš„å®¢è£½ BOM |
| ç‰¹æ€§ | å…¨åŸŸå…±ç”¨ | è¨‚å–®å°ˆå±¬ |
| éˆæ´»æ€§ | å›ºå®šé…æ–¹ | å¯ä¾å®¢æˆ¶éœ€æ±‚èª¿æ•´ |
| é©ç”¨å ´æ™¯ | æ¨™æº–åŒ–ç”Ÿç”¢ | å®¢è£½åŒ–ç”Ÿç”¢ |

**çµè«–**ï¼šæ¡ç”¨ `SalesOrderCompositionDetail` å¯æ”¯æ´å®¢è£½åŒ– BOMï¼Œæ›´ç¬¦åˆå¯¦éš›æ¥­å‹™éœ€æ±‚ã€‚

---

## åº«å­˜èˆ‡ç”Ÿç”¢æµç¨‹è¨­è¨ˆ

### åº«å­˜æ¬„ä½èªªæ˜

```
InventoryStockDetail
â”œâ”€ CurrentStock        // ç¾æœ‰åº«å­˜ï¼ˆå¯¦éš›åœ¨å€‰åº«çš„æ•¸é‡ï¼‰
â”œâ”€ ReservedStock       // é ç•™åº«å­˜ï¼ˆå·²è¢«è¨‚å–®é ç•™ï¼‰
â”œâ”€ InProductionStock   // ç”Ÿç”¢ä¸­åº«å­˜ï¼ˆå·²é ˜æ–™ï¼Œç”Ÿç”¢ä¸­ï¼‰â† æ–°å¢
â”œâ”€ InTransitStock      // åœ¨é€”åº«å­˜ï¼ˆæ¡è³¼ä¸­ï¼‰
â””â”€ AvailableStock      // å¯ç”¨åº«å­˜ = Current - Reserved - InProduction
```

### ç”Ÿç”¢æµç¨‹èˆ‡åº«å­˜è®ŠåŒ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”Ÿç”¢æµç¨‹èˆ‡åº«å­˜è®ŠåŒ–                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: å»ºç«‹æ’ç¨‹ï¼ˆè½‰æ’ç¨‹ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ç‹€æ…‹ï¼šPendingï¼ˆå¾…ç”Ÿç”¢ï¼‰
åº«å­˜ï¼šç„¡è®ŠåŒ–

Step 2: é–‹å§‹ç”Ÿç”¢ï¼ˆé»æ“Šã€Œé–‹å§‹ç”Ÿç”¢ã€ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ç‹€æ…‹ï¼šInProgressï¼ˆè£½ä½œä¸­ï¼‰
åº«å­˜è®ŠåŒ–ï¼š
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ çµ„ä»¶ï¼ˆåŸæ–™Aï¼‰                            â”‚
  â”‚   CurrentStock:      500 â†’ 300  (-200) â”‚
  â”‚   InProductionStock:   0 â†’ 200  (+200) â”‚
  â”‚   AvailableStock:    500 â†’ 100         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  
  ğŸ’¡ åŸæ–™å¾ã€Œç¾æœ‰åº«å­˜ã€è½‰ç§»åˆ°ã€Œç”Ÿç”¢ä¸­åº«å­˜ã€

Step 3: å®Œæˆå…¥åº«ï¼ˆé»æ“Šã€Œå®Œæˆå…¥åº«ã€ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ç‹€æ…‹ï¼šCompletedï¼ˆå·²å…¥åº«ï¼‰
åº«å­˜è®ŠåŒ–ï¼š
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ çµ„ä»¶ï¼ˆåŸæ–™Aï¼‰                            â”‚
  â”‚   InProductionStock: 200 â†’ 0    (-200) â”‚ â† æ¶ˆè€—
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ æˆå“ï¼ˆæˆå“Xï¼‰                            â”‚
  â”‚   CurrentStock:        0 â†’ 100  (+100) â”‚ â† å…¥åº«
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### éƒ¨åˆ†å®Œæˆçš„è™•ç†

å¦‚æœç”Ÿç”¢ 100 å€‹æˆå“ï¼Œä½†åªå®Œæˆå…¥åº« 60 å€‹ï¼š

```
ç¬¬ä¸€æ¬¡å®Œæˆå…¥åº«ï¼ˆ60å€‹ï¼‰ï¼š
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
çµ„ä»¶æŒ‰æ¯”ä¾‹æ¸…é™¤ï¼š60/100 = 60%
  åŸæ–™A.InProductionStock: 200 â†’ 80  (-120ï¼Œå³ 200Ã—60%)
  
æˆå“å…¥åº«ï¼š
  æˆå“X.CurrentStock: 0 â†’ 60  (+60)

æ’ç¨‹ç‹€æ…‹ï¼šInProgressï¼ˆä»åœ¨è£½ä½œä¸­ï¼Œå› ç‚ºé‚„æœ‰ 40 å€‹æœªå®Œæˆï¼‰

ç¬¬äºŒæ¬¡å®Œæˆå…¥åº«ï¼ˆ40å€‹ï¼‰ï¼š
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
çµ„ä»¶æ¸…é™¤å‰©é¤˜ï¼š
  åŸæ–™A.InProductionStock: 80 â†’ 0  (-80)
  
æˆå“å…¥åº«ï¼š
  æˆå“X.CurrentStock: 60 â†’ 100  (+40)

æ’ç¨‹ç‹€æ…‹ï¼šCompletedï¼ˆå·²å…¥åº«ï¼Œ100/100 å®Œæˆï¼‰
```

### æ’ç¨‹é …ç›®æ“ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã€æ’ç¨‹é …ç›®æ“ä½œæŒ‰éˆ•é‚è¼¯ã€‘                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  ç‹€æ…‹ï¼šPendingï¼ˆå¾…ç”Ÿç”¢ï¼‰                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [é–‹å§‹ç”Ÿç”¢] â† é»æ“Šå¾Œï¼š                                           â”‚   â”‚
â”‚  â”‚   1. æª¢æŸ¥çµ„ä»¶åº«å­˜                                               â”‚   â”‚
â”‚  â”‚   2. é¡¯ç¤ºç¢ºèªå°è©±æ¡†ï¼ˆå«åº«å­˜ä¸è¶³è­¦å‘Šï¼‰                            â”‚   â”‚
â”‚  â”‚   3. ç¢ºèªå¾Œï¼šæ‰£é™¤çµ„ä»¶åº«å­˜ã€å¢åŠ ç”Ÿç”¢ä¸­ã€ç‹€æ…‹æ”¹ InProgress        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  ç‹€æ…‹ï¼šInProgressï¼ˆè£½ä½œä¸­ï¼‰                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [å®Œæˆå…¥åº«] â† é»æ“Šå¾Œï¼š                                           â”‚   â”‚
â”‚  â”‚   1. è¼¸å…¥å…¥åº«æ•¸é‡ã€é¸æ“‡å€‰åº«                                      â”‚   â”‚
â”‚  â”‚   2. ç¢ºèªå¾Œï¼š                                                   â”‚   â”‚
â”‚  â”‚      - æ¸…é™¤çµ„ä»¶ã€Œç”Ÿç”¢ä¸­ã€ï¼ˆæŒ‰æ¯”ä¾‹ï¼‰                              â”‚   â”‚
â”‚  â”‚      - å¢åŠ æˆå“åº«å­˜                                             â”‚   â”‚
â”‚  â”‚      - å»ºç«‹ ProductionScheduleCompletion è¨˜éŒ„                   â”‚   â”‚
â”‚  â”‚      - æ›´æ–° CompletedQuantity                                   â”‚   â”‚
â”‚  â”‚      - è‹¥å…¨éƒ¨å®Œæˆï¼Œç‹€æ…‹æ”¹ Completed                             â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚ [æŸ¥çœ‹é ˜æ–™] â† é¡¯ç¤ºå·²é ˜ç”¨çš„çµ„ä»¶æ¸…å–®                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  ç‹€æ…‹ï¼šCompletedï¼ˆå·²å…¥åº«ï¼‰                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [æŸ¥çœ‹è¨˜éŒ„] â† é¡¯ç¤ºæ‰€æœ‰å…¥åº«è¨˜éŒ„ï¼ˆProductionScheduleCompletionï¼‰   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ–°å¢å¯¦é«”ï¼šProductionScheduleCompletion

```csharp
/// <summary>
/// ç”Ÿç”¢å®Œæˆå…¥åº«è¨˜éŒ„ - è¨˜éŒ„æ¯æ¬¡å…¥åº«çš„è©³ç´°è³‡è¨Š
/// </summary>
[Index(nameof(ProductionScheduleItemId))]
public class ProductionScheduleCompletion : BaseEntity
{
    // é—œè¯
    [Required(ErrorMessage = "æ’ç¨‹é …ç›®ç‚ºå¿…å¡«")]
    [ForeignKey(nameof(ProductionScheduleItem))]
    public int ProductionScheduleItemId { get; set; }
    
    // å…¥åº«è³‡è¨Š
    [Required(ErrorMessage = "å…¥åº«æ•¸é‡ç‚ºå¿…å¡«")]
    [Display(Name = "å…¥åº«æ•¸é‡")]
    [Column(TypeName = "decimal(18,4)")]
    public decimal Quantity { get; set; }
    
    [Required(ErrorMessage = "å…¥åº«å€‰åº«ç‚ºå¿…å¡«")]
    [ForeignKey(nameof(Warehouse))]
    [Display(Name = "å…¥åº«å€‰åº«")]
    public int WarehouseId { get; set; }
    
    [Required]
    [Display(Name = "å…¥åº«æ—¥æœŸ")]
    public DateTime CompletionDate { get; set; } = DateTime.Today;
    
    [Display(Name = "å‚™è¨»")]
    [StringLength(500)]
    public string? Remarks { get; set; }
    
    // Navigation
    public ProductionScheduleItem ProductionScheduleItem { get; set; } = null!;
    public Warehouse Warehouse { get; set; } = null!;
}
```

### èª¿æ•´ç¾æœ‰å¯¦é«”

#### InventoryStockDetail - æ–°å¢ç”Ÿç”¢ä¸­åº«å­˜

```csharp
// æ–°å¢æ¬„ä½
[Display(Name = "ç”Ÿç”¢ä¸­åº«å­˜")]
public int InProductionStock { get; set; } = 0;

// èª¿æ•´å¯ç”¨åº«å­˜è¨ˆç®—
[Display(Name = "å¯ç”¨åº«å­˜")]
public int AvailableStock => CurrentStock - ReservedStock - InProductionStock;
```

#### InventoryStock - æ–°å¢åŠ ç¸½

```csharp
// æ–°å¢åŠ ç¸½å±¬æ€§
[Display(Name = "ç¸½ç”Ÿç”¢ä¸­åº«å­˜")]
[NotMapped]
public int TotalInProductionStock => InventoryStockDetails?.Sum(d => d.InProductionStock) ?? 0;

// èª¿æ•´ç¸½å¯ç”¨åº«å­˜
[Display(Name = "ç¸½å¯ç”¨åº«å­˜")]
[NotMapped]
public int TotalAvailableStock => TotalCurrentStock - TotalReservedStock - TotalInProductionStock;
```

---

## é™„éŒ„

### A. ç‹€æ…‹æµè½‰è¦å‰‡

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     å¾…ç”Ÿç”¢          â”‚
                    â”‚   (Pending)         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    [å…¥åº«å–®å»ºç«‹/é–‹å§‹ç”Ÿç”¢]
                               â”‚
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     è£½ä½œä¸­          â”‚
                    â”‚   (InProgress)      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    [å…¥åº«å–®å®Œæˆå…¥åº«]
                    [CompletedQty >= RequiredQty]
                               â”‚
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     å·²å…¥åº«          â”‚
                    â”‚   (Completed)       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### B. åº«å­˜æª¢æŸ¥é‚è¼¯

```csharp
// è™›æ“¬ç¢¼ï¼šæª¢æŸ¥çµ„ä»¶åº«å­˜
foreach (var component in bomDetails)
{
    var requiredQty = component.Quantity * productRequiredQty;
    var stockQty = GetCurrentStock(component.ComponentProductId);
    
    if (stockQty < requiredQty)
    {
        insufficientComponents.Add(new {
            Component = component,
            Required = requiredQty,
            Stock = stockQty,
            Shortage = requiredQty - stockQty
        });
    }
}

if (insufficientComponents.Any())
{
    // é¡¯ç¤ºè­¦ç¤ºå°è©±æ¡†ï¼Œè®“ä½¿ç”¨è€…é¸æ“‡ç¹¼çºŒæˆ–å–æ¶ˆ
    var result = await ShowConfirmDialog(
        "çµ„ä»¶åº«å­˜ä¸è¶³è­¦ç¤º",
        $"ä»¥ä¸‹ {insufficientComponents.Count} é …çµ„ä»¶åº«å­˜ä¸è¶³ï¼Œæ˜¯å¦ä»è¦å»ºç«‹æ’ç¨‹ï¼Ÿ"
    );
    
    if (!result) return;
}
```

### C. åˆä½µé‚è¼¯è™›æ“¬ç¢¼

```csharp
// è™›æ“¬ç¢¼ï¼šåˆä½µç›¸åŒç”¢å“
public async Task<List<ProductionSchedule>> CreateSchedulesWithMerge(
    List<SalesOrderDetail> selectedItems,
    bool mergeByProduct)
{
    if (!mergeByProduct)
    {
        // å€‹åˆ¥å»ºç«‹ï¼šæ¯å€‹é …ç›®ä¸€å¼µæ’ç¨‹å–®
        return await CreateIndividualSchedules(selectedItems);
    }
    
    // åˆä½µå»ºç«‹ï¼šç›¸åŒç”¢å“åˆä½µ
    var groupedByProduct = selectedItems
        .GroupBy(x => x.ProductId)
        .ToList();
    
    var schedule = new ProductionSchedule { ... };
    
    foreach (var group in groupedByProduct)
    {
        var item = new ProductionScheduleItem
        {
            ProductId = group.Key,
            TotalRequiredQuantity = group.Sum(x => x.Quantity),
            CurrentStockQuantity = GetCurrentStock(group.Key)
        };
        
        // å»ºç«‹åˆ†é…æ˜ç´°ï¼ˆè¿½æº¯ï¼‰
        foreach (var orderDetail in group)
        {
            item.Allocations.Add(new ProductionScheduleAllocation
            {
                SalesOrderDetailId = orderDetail.Id,
                Quantity = orderDetail.Quantity
            });
        }
        
        // å±•é–‹ BOM
        await ExpandBomDetails(item);
        
        schedule.Items.Add(item);
    }
    
    return new List<ProductionSchedule> { schedule };
}
```

---

## è®Šæ›´ç´€éŒ„

| æ—¥æœŸ | ç‰ˆæœ¬ | è®Šæ›´å…§å®¹ | ä½œè€… |
|------|------|---------|------|
| 2024/12/06 | v1.0 | åˆç‰ˆå»ºç«‹ | AI Assistant |
| 2024/12/08 | v1.1 | Phase 1-2 å®Œæˆï¼šè³‡æ–™æ¨¡å‹å’Œæœå‹™å±¤ | AI Assistant |
| 2024/12/08 | v1.2 | Phase 3 éƒ¨åˆ†å®Œæˆï¼šè½‰æ’ç¨‹ UI æ•´åˆ | AI Assistant |
| 2024/12/09 | v1.3 | Phase 3-4 å®Œæˆï¼šæ’ç¨‹é …ç›®ç·¨è¼¯ã€å®Œå·¥ç™»éŒ„ | AI Assistant |
| 2024/12/09 | v1.4 | Phase 5 å®Œæˆï¼šçµ„ä»¶é ˜æ–™åŠŸèƒ½ | AI Assistant |
| 2024/12/06 | v1.5 | Phase 6 å®Œæˆï¼šåº«å­˜äº¤æ˜“æ•´åˆï¼ˆé ˜æ–™æ‰£åº«å­˜ã€å®Œå·¥åŠ åº«å­˜ï¼‰ | AI Assistant |

---
### âœ… Phase 1ï¼šè³‡æ–™æ¨¡å‹å»ºç«‹ - å®Œæˆ

å·²å®Œæˆé …ç›®ï¼š
- [x] `Data/Enums/ProductionItemStatus.cs` - ç”Ÿç”¢ç‹€æ…‹åˆ—èˆ‰
- [x] `Data/Entities/ProductionManagement/ProductionScheduleItem.cs` - æ’ç¨‹é …ç›®å¯¦é«”ï¼ˆåŒ…å« SalesOrderDetailId ç›´æ¥è¿½æº¯è¨‚å–®ï¼‰
- [x] `Data/Entities/ProductionManagement/ProductionScheduleCompletion.cs` - å®Œå·¥è¨˜éŒ„å¯¦é«”
- [x] `Data/Entities/ProductionManagement/ProductionScheduleDetail.cs` - èª¿æ•´é—œè¯åˆ° Itemï¼Œæ–°å¢ IssuedQuantity æ¬„ä½
- [x] `Data/Entities/Sales/SalesOrderDetail.cs` - æ–°å¢ ScheduledQuantity æ¬„ä½
- [x] `Data/Context/AppDbContext.cs` - è¨»å†Šæ–°å¯¦é«”ï¼Œé…ç½®å¤–éµé—œè¯
- [x] Migration å»ºç«‹ (`AddProductionScheduleItems`, `AddIssuedQuantityToProductionScheduleDetail`)

**æ¶æ§‹å„ªåŒ–**ï¼š
- âŒ ç§»é™¤ `ProductionScheduleAllocation` å¯¦é«” - æ”¹ç”¨ `ProductionScheduleItem.SalesOrderDetailId` ç›´æ¥è¿½æº¯
- âœ… ç°¡åŒ–è³‡æ–™çµæ§‹ï¼Œæ¯å€‹è¨‚å–®æ˜ç´°ç¨ç«‹å»ºç«‹æ’ç¨‹é …ç›®ï¼Œä¸åˆä½µç›¸åŒç”¢å“ionScheduleDetail.cs` - èª¿æ•´é—œè¯åˆ° Item
### âœ… Phase 2ï¼šService å±¤å»ºç«‹ - å®Œæˆ

å·²å®Œæˆé …ç›®ï¼š
- [x] `Services/ProductionManagement/IProductionScheduleItemService.cs` - ä»‹é¢å®šç¾©
- [x] `Services/ProductionManagement/ProductionScheduleItemService.cs` - æœå‹™å¯¦ä½œ
  - `CreateFromSalesOrderDetailAsync()` - å¾éŠ·è²¨è¨‚å–®æ˜ç´°å»ºç«‹æ’ç¨‹é …ç›®
  - `UpdateStatusAsync()` - æ›´æ–°ç”Ÿç”¢ç‹€æ…‹
  - `StartProductionAsync()` - é–‹å§‹ç”Ÿç”¢
  - `CompleteProductionAsync()` - å®Œæˆç”Ÿç”¢
- [x] `Services/ProductionManagement/IProductionScheduleCompletionService.cs` - å®Œå·¥è¨˜éŒ„ä»‹é¢
- [x] `Services/ProductionManagement/ProductionScheduleCompletionService.cs` - å®Œå·¥è¨˜éŒ„æœå‹™
- [x] `Services/ProductionManagement/IProductionScheduleDetailService.cs` - æ›´æ–°ä»‹é¢ï¼ˆé—œè¯åˆ° Itemï¼‰
- [x] `Services/ProductionManagement/ProductionScheduleDetailService.cs` - é‡æ§‹æœå‹™
  - `GetByScheduleItemIdAsync()` - æŸ¥è©¢æ’ç¨‹é …ç›®çš„çµ„ä»¶éœ€æ±‚
  - `IssueComponentsAsync()` - çµ„ä»¶é ˜æ–™è™•ç†
### âœ… Phase 3ï¼šè½‰æ’ç¨‹åŠŸèƒ½ - å®Œæˆ

å·²å®Œæˆé …ç›®ï¼š
- [x] `Components/Shared/BaseModal/Modals/ProductionManagement/TransferToScheduleModalComponent.razor` - è½‰æ’ç¨‹ç¢ºèª Modal
  - æ”¯æ´å¾éŠ·è²¨è¨‚å–®æ˜ç´°è½‰å…¥æ’ç¨‹
  - è‡ªå‹•è¼‰å…¥å¯æ’ç¨‹é …ç›®ï¼ˆProduct.ProcurementType = Manufactured ä¸”æœ‰å¾…æ’ç¨‹æ•¸é‡ï¼‰
  - é¡¯ç¤ºåº«å­˜æª¢æŸ¥èˆ‡è­¦ç¤º
  - æ”¯æ´æ‰¹æ¬¡é¸æ“‡èˆ‡æ•¸é‡èª¿æ•´
  - æä¾›åˆä½µ/åˆ†é–‹å»ºç«‹æ’ç¨‹é¸é …
- [x] `Components/Shared/BaseModal/Modals/Sales/SalesOrderEditModalComponent.razor` - æ–°å¢ã€Œè½‰æ’ç¨‹ã€æŒ‰éˆ•ï¼ˆæ‰¹æ¬¡è½‰æ’ç¨‹å…¥å£ï¼‰
- [x] ~~`Components/Shared/BaseModal/Modals/Sales/SalesOrderCompositionEditModal.razor`~~ - ç§»é™¤å€‹åˆ¥è½‰æ’ç¨‹åŠŸèƒ½ï¼ˆå·²æ•´åˆè‡³è¨‚å–®å±¤ç´šï¼‰

**æ¶æ§‹å„ªåŒ–**ï¼š
- âŒ ç§»é™¤ `BatchTransferToScheduleModal.razor` - åŠŸèƒ½æ•´åˆè‡³ `TransferToScheduleModalComponent.razor`
### âœ… Phase 4ï¼šç”Ÿç”¢æ’ç¨‹ç®¡ç† - å®Œæˆ

å·²å®Œæˆé …ç›®ï¼š
- [x] `Components/Pages/ProductionManagement/ProductionScheduleIndex.razor` - ç”Ÿç”¢æ’ç¨‹ç´¢å¼•é é¢
  - ä½¿ç”¨ `GenericIndexPageComponent` é¡¯ç¤ºæ’ç¨‹åˆ—è¡¨
  - æ”¯æ´ç¯©é¸ã€æœå°‹ã€åˆ†é 
- [x] `Components/Pages/ProductionManagement/ProductionScheduleEditModalComponent.razor` - æ’ç¨‹ç·¨è¼¯ä¸»é é¢
  - æ’ç¨‹ä¸»æª”è³‡è¨Šç·¨è¼¯
  - æ’ç¨‹é …ç›®å¡ç‰‡å±•ç¤ºï¼ˆInteractiveCardï¼‰
  - æ•´åˆæ’ç¨‹é …ç›®ç·¨è¼¯åŠŸèƒ½
- [x] `Components/Shared/BaseModal/Modals/ProductionManagement/ProductionScheduleItemEditModal.razor` - æ’ç¨‹é …ç›®è©³æƒ… Modal
  - é¡¯ç¤ºåŸºæœ¬è³‡è¨Šï¼ˆç”¢å“ã€æ•¸é‡ã€ç‹€æ…‹ï¼‰
  - è‡ªå‹•å±•é–‹ BOM çµ„ä»¶éœ€æ±‚
  - ç”Ÿç”¢é€²åº¦è¿½è¹¤ï¼ˆé€²åº¦æ¢ï¼‰
  - ä¾†æºè¨‚å–®è³‡è¨Šè¿½æº¯
  - æ•´åˆæ“ä½œæŒ‰éˆ•ï¼šé–‹å§‹ç”Ÿç”¢ã€çµ„ä»¶é ˜æ–™ã€å®Œå·¥ç™»éŒ„
- [x] `Components/Shared/BaseModal/Modals/ProductionManagement/ProductionCompletionModal.razor` - å®Œå·¥ç™»éŒ„ Modal
### âœ… Phase 5ï¼šç”Ÿç”¢åŸ·è¡ŒåŠŸèƒ½ - å®Œæˆ

å·²å®Œæˆé …ç›®ï¼š
- [x] `Components/Shared/BaseModal/Modals/ProductionManagement/MaterialIssueModal.razor` - çµ„ä»¶é ˜æ–™ Modal
  - é¡¯ç¤ºçµ„ä»¶éœ€æ±‚æ¸…å–®èˆ‡ç•¶å‰åº«å­˜
  - åº«å­˜ä¸è¶³è­¦å‘Šæç¤º
  - æ”¯æ´éƒ¨åˆ†é ˜æ–™ï¼ˆå¯èª¿æ•´é ˜æ–™æ•¸é‡ï¼‰
  - æ•´åˆåº«å­˜æœå‹™è‡ªå‹•æ‰£æ¸›åº«å­˜
  - è‡ªå‹•æ›´æ–° `IssuedQuantity` æ¬„ä½
  - è¨˜éŒ„åº«å­˜äº¤æ˜“ï¼ˆäº¤æ˜“é¡å‹ï¼šMaterialIssueï¼‰
- [x] `Components/Shared/BaseModal/Modals/ProductionManagement/ProductionCompletionModal.razor` - å®Œå·¥ç™»éŒ„ Modal
  - é¡¯ç¤ºç”Ÿç”¢é€²åº¦ï¼ˆé€²åº¦æ¢ã€å·²å®Œæˆ/ç¸½æ•¸é‡ï¼‰
  - æ”¯æ´åˆ†æ‰¹å®Œå·¥ç™»éŒ„
  - å¯é¸æ“‡å…¥åº«å€‰åº«
  - æ•´åˆåº«å­˜æœå‹™è‡ªå‹•å¢åŠ æˆå“åº«å­˜
  - å»ºç«‹å®Œå·¥è¨˜éŒ„ï¼ˆProductionScheduleCompletionï¼‰
  - è‡ªå‹•æ›´æ–°æ’ç¨‹é …ç›®ç‹€æ…‹ï¼ˆPending â†’ InProgress â†’ Completedï¼‰
  - è¨˜éŒ„åº«å­˜äº¤æ˜“ï¼ˆäº¤æ˜“é¡å‹ï¼šProductionCompletionï¼‰
- [x] `ProductionScheduleItemEditModal.razor` - æ•´åˆæ‰€æœ‰æ“ä½œæŒ‰éˆ•
  - é–‹å§‹ç”Ÿç”¢ï¼ˆç‹€æ…‹ï¼šPending â†’ InProgressï¼‰
  - çµ„ä»¶é ˜æ–™ï¼ˆç‹€æ…‹ï¼šInProgressï¼Œå¯å¤šæ¬¡é ˜æ–™ï¼‰
  - å®Œå·¥ç™»éŒ„ï¼ˆç‹€æ…‹ï¼šInProgress â†’ Completedï¼Œå¯åˆ†æ‰¹å®Œå·¥ï¼‰
  - æŸ¥çœ‹å®Œå·¥è¨˜éŒ„
- [x] `Data/Navigation/NavigationConfig.cs` - ç”Ÿç”¢æ’ç¨‹å°èˆªè¨­å®štail.cs` - æ–°å¢ IssuedQuantity æ¬„ä½
- [x] `Components/Shared/BaseModal/Modals/ProductionManagement/MaterialIssueModal.razor` - çµ„ä»¶é ˜æ–™ Modal
  - é¡¯ç¤ºçµ„ä»¶éœ€æ±‚æ¸…å–®
  - åº«å­˜ä¸è¶³è­¦å‘Š
  - æ”¯æ´éƒ¨åˆ†é ˜æ–™
  - è‡ªå‹•æ›´æ–°å·²é ˜æ•¸é‡
### âœ… Phase 6ï¼šåº«å­˜äº¤æ˜“æ•´åˆ - å®Œæˆ

å·²å®Œæˆé …ç›®ï¼š
- [x] `MaterialIssueModal.razor` - æ•´åˆåº«å­˜æœå‹™è‡ªå‹•æ‰£æ¸›åº«å­˜
  - å‘¼å« `InventoryStockService.ReduceStockAsync()`
  - äº¤æ˜“å–®è™Ÿæ ¼å¼ï¼š`MI{yyyyMMddHHmmss}`
  - äº¤æ˜“é¡å‹ï¼š`InventoryTransactionTypeEnum.MaterialIssue`
  - å‚™è¨»åŒ…å«æ’ç¨‹ä»£ç¢¼èˆ‡ç”¢å“è³‡è¨Š
- [x] `ProductionCompletionModal.razor` - æ•´åˆåº«å­˜æœå‹™è‡ªå‹•å¢åŠ åº«å­˜
  - å‘¼å« `InventoryStockService.AddStockAsync()`
  - äº¤æ˜“å–®è™Ÿæ ¼å¼ï¼š`PC{yyyyMMddHHmmss}`
  - äº¤æ˜“é¡å‹ï¼š`InventoryTransactionTypeEnum.ProductionCompletion`
  - å‚™è¨»åŒ…å«æ’ç¨‹ä»£ç¢¼èˆ‡å…¥åº«è³‡è¨Š
### ğŸ“ æ¶æ§‹å„ªåŒ–è¨˜éŒ„ - 2024/12/08

**ç§»é™¤çš„çµ„ä»¶èˆ‡å¯¦é«”**ï¼š
- âŒ `ProductionPendingWorkbench.razor` - å¾…æ’ç¨‹å·¥ä½œå°é é¢ï¼ˆåŠŸèƒ½æ•´åˆè‡³éŠ·è²¨è¨‚å–®é é¢ï¼‰
- âŒ `BatchTransferToScheduleModal.razor` - æ‰¹æ¬¡è½‰æ’ç¨‹ Modalï¼ˆåŠŸèƒ½æ•´åˆè‡³ TransferToScheduleModalComponentï¼‰
- âŒ `ProductionScheduleAllocation.cs` - è¨‚å–®åˆ†é…å¯¦é«”ï¼ˆæ”¹ç”¨ ProductionScheduleItem.SalesOrderDetailId ç›´æ¥è¿½æº¯ï¼‰
- âŒ `SalesOrderCompositionEditModal` çš„è½‰æ’ç¨‹åŠŸèƒ½ - å€‹åˆ¥è½‰æ’ç¨‹æŒ‰éˆ•ï¼ˆæ”¹ç‚ºçµ±ä¸€åœ¨è¨‚å–®å±¤ç´šæ‰¹æ¬¡è½‰æ’ç¨‹ï¼‰

**å„ªåŒ–ç†ç”±**ï¼š
1. **ç°¡åŒ–ä½¿ç”¨è€…æ“ä½œæµç¨‹**ï¼šçµ±ä¸€å¾éŠ·è²¨è¨‚å–®ç·¨è¼¯é é¢æ‰¹æ¬¡è½‰æ’ç¨‹ï¼Œé¿å…é‡è¤‡é»æ“Š
2. **ç°¡åŒ–è³‡æ–™çµæ§‹**ï¼šç›´æ¥ç”¨å¤–éµè¿½æº¯è¨‚å–®ï¼Œä¸éœ€è¦é¡å¤–çš„åˆ†é…è¡¨
3. **æ¸›å°‘é‡è¤‡åŠŸèƒ½**ï¼šéŠ·è²¨è¨‚å–®é é¢å·²å…·å‚™å®Œæ•´çš„ç¯©é¸èˆ‡æŸ¥è©¢èƒ½åŠ›
4. **é™ä½ç¶­è­·æˆæœ¬**ï¼šæ¸›å°‘ä¸å¿…è¦çš„ä¸­é–“é é¢èˆ‡è³‡æ–™è¡¨

**æ¡ç”¨çš„æ–°æ¶æ§‹**ï¼š
- âœ… æ¯å€‹è¨‚å–®æ˜ç´°ç¨ç«‹å»ºç«‹æ’ç¨‹é …ç›®ï¼ˆä¸åˆä½µç›¸åŒç”¢å“ï¼‰
- âœ… é€é `ProductionScheduleItem.SalesOrderDetailId` ç›´æ¥è¿½æº¯ä¾†æºè¨‚å–®
- âœ… æ‰¹æ¬¡è½‰æ’ç¨‹çµ±ä¸€åœ¨ `SalesOrderEditModalComponent` è™•ç†
- âœ… `TransferToScheduleModalComponent` æ”¯æ´å¤šé¸èˆ‡æ•¸é‡èª¿æ•´
**ç†ç”±**ï¼š
1. **ç°¡åŒ–ä½¿ç”¨è€…æ“ä½œæµç¨‹**ï¼šç›´æ¥å¾éŠ·è²¨è¨‚å–® BOM ç·¨è¼¯ç•«é¢è½‰æ’ç¨‹æ›´ç›´è§€
2. **æ¸›å°‘é‡è¤‡åŠŸèƒ½**ï¼šéŠ·è²¨è¨‚å–®é é¢å·²å…·å‚™ç¯©é¸èˆ‡æŸ¥è©¢èƒ½åŠ›
3. **é™ä½ç¶­è­·æˆæœ¬**ï¼šæ¸›å°‘ä¸å¿…è¦çš„ä¸­é–“é é¢èˆ‡è³‡æ–™è¡¨

**ä¿ç•™çš„æ ¸å¿ƒåŠŸèƒ½**ï¼š
- âœ… `ProductionScheduleIndex.razor` - ç®¡ç†å·²å»ºç«‹çš„æ’ç¨‹
- âœ… `ProductionScheduleEditModalComponent.razor` - ç·¨è¼¯æ’ç¨‹ä¸»æª”
- âœ… `ProductionScheduleItemEditModal.razor` - ç®¡ç†æ’ç¨‹é …ç›®èˆ‡ç”Ÿç”¢ç‹€æ…‹
- âœ… `ProductionCompletionModal.razor` - å®Œå·¥ç™»éŒ„
- âœ… `MaterialIssueModal.razor` - çµ„ä»¶é ˜æ–™
- âœ… `TransferToScheduleModalComponent.razor` - æ‰¹æ¬¡è½‰æ’ç¨‹ç¢ºèª

### â³ Phase 7ï¼šé€²éšåŠŸèƒ½ - å¾…é–‹ç™¼

å¾…å®Œæˆé …ç›®ï¼š
- [ ] è£½ç¨‹ç®¡ç† - ProcessDefinition å¯¦é«”èˆ‡æœå‹™ï¼ˆå·¥åºå®šç¾©ï¼‰
- [ ] å·¥ä½œç«™ç®¡ç† - WorkStation å¯¦é«”èˆ‡æœå‹™ï¼ˆç”¢ç·š/æ©Ÿå°ç®¡ç†ï¼‰
- [ ] è£½ç¨‹æ’ç¨‹è¿½è¹¤ - å·¥åºç´šåˆ¥çš„é€²åº¦è¿½è¹¤èˆ‡å·¥æ™‚è¨˜éŒ„
- [ ] å ±è¡¨åŠŸèƒ½ï¼š
  - [ ] ç”Ÿç”¢é€²åº¦å ±è¡¨ï¼ˆæŒ‰æ’ç¨‹ã€æŒ‰ç”¢å“ã€æŒ‰å®¢æˆ¶ï¼‰
  - [ ] çµ„ä»¶éœ€æ±‚å ±è¡¨ï¼ˆMRP ç‰©æ–™éœ€æ±‚è¨ˆåŠƒï¼‰
  - [ ] é ˜æ–™çµ±è¨ˆå ±è¡¨ï¼ˆçµ„ä»¶æ¶ˆè€—åˆ†æï¼‰
  - [ ] å®Œå·¥çµ±è¨ˆå ±è¡¨ï¼ˆç”¢èƒ½åˆ†æï¼‰
- [ ] ç”¢èƒ½è¦åŠƒï¼š
  - [ ] æ©Ÿå°ç”¢èƒ½è¨ˆç®—
  - [ ] æ’ç¨‹è¡çªæª¢æ¸¬
  - [ ] è‡ªå‹•æ’ç¨‹å»ºè­°

---

## ç³»çµ±ç•¶å‰ç‹€æ…‹

> **âœ… Phase 1-6 å·²å®Œæˆ**ï¼ˆ2024/12/08ï¼‰
> 
> ç³»çµ±å·²å…·å‚™å®Œæ•´çš„ç”Ÿç”¢æ’ç¨‹æ ¸å¿ƒåŠŸèƒ½ï¼š
> 
> **1. è½‰æ’ç¨‹æµç¨‹**
> - å¾éŠ·è²¨è¨‚å–®ç·¨è¼¯é é¢æ‰¹æ¬¡é¸æ“‡å¯æ’ç¨‹é …ç›®
> - è‡ªå‹•å±•é–‹ BOM çµ„ä»¶éœ€æ±‚
> - æ”¯æ´æ•¸é‡èª¿æ•´èˆ‡éƒ¨åˆ†æ’ç¨‹
> - åº«å­˜æª¢æŸ¥èˆ‡è­¦ç¤ºæç¤º
> 
> **2. ç”Ÿç”¢ç®¡ç†**
> - ç”Ÿç”¢æ’ç¨‹ç´¢å¼•é é¢ï¼ˆæŸ¥è©¢ã€ç¯©é¸ã€åˆ†é ï¼‰
> - æ’ç¨‹ç·¨è¼¯é é¢ï¼ˆä¸»æª”è³‡è¨Šã€æ’ç¨‹é …ç›®å¡ç‰‡ï¼‰
> - æ’ç¨‹é …ç›®è©³æƒ…ï¼ˆBOM å±•é–‹ã€é€²åº¦è¿½è¹¤ã€ä¾†æºè¨‚å–®è¿½æº¯ï¼‰
> 
> **3. ç”Ÿç”¢åŸ·è¡Œ**
> - é–‹å§‹ç”Ÿç”¢ï¼ˆç‹€æ…‹è®Šæ›´ï¼šPending â†’ InProgressï¼‰
> - çµ„ä»¶é ˜æ–™ï¼ˆè‡ªå‹•æ‰£æ¸›çµ„ä»¶åº«å­˜ï¼Œæ”¯æ´åˆ†æ‰¹é ˜æ–™ï¼‰
> - å®Œå·¥ç™»éŒ„ï¼ˆè‡ªå‹•å¢åŠ æˆå“åº«å­˜ï¼Œæ”¯æ´åˆ†æ‰¹å…¥åº«ï¼‰
> - ç‹€æ…‹è‡ªå‹•æ›´æ–°ï¼ˆInProgress â†’ Completedï¼‰
> 
> **4. åº«å­˜æ•´åˆ**
> - é ˜æ–™æ™‚å»ºç«‹ MaterialIssue äº¤æ˜“è¨˜éŒ„
> - å®Œå·¥æ™‚å»ºç«‹ ProductionCompletion äº¤æ˜“è¨˜éŒ„
> - æ‰€æœ‰åº«å­˜ç•°å‹•å¯è¿½æº¯ï¼ˆäº¤æ˜“å–®è™Ÿã€æ—¥æœŸã€æ•¸é‡ã€å€‰åº«ï¼‰
> 
> **5. è³‡æ–™è¿½æº¯**
> - æ’ç¨‹é …ç›® â†’ éŠ·è²¨è¨‚å–®æ˜ç´°ï¼ˆSalesOrderDetailIdï¼‰
> - çµ„ä»¶éœ€æ±‚ â†’ æ¨™æº– BOMï¼ˆProductCompositionDetailIdï¼‰
> - åº«å­˜ç•°å‹• â†’ æ’ç¨‹é …ç›®ï¼ˆé€éäº¤æ˜“å‚™è¨»ï¼‰
> 
> **æ¶æ§‹ç‰¹è‰²**ï¼š
> - ç°¡åŒ–è³‡æ–™çµæ§‹ï¼ˆç§»é™¤ ProductionScheduleAllocationï¼‰
> - çµ±ä¸€æ“ä½œå…¥å£ï¼ˆæ‰¹æ¬¡è½‰æ’ç¨‹ï¼‰
> - å®Œæ•´åº«å­˜æ•´åˆï¼ˆè‡ªå‹•æ‰£æ¸›/å¢åŠ ï¼‰
> - åˆ†æ‰¹è™•ç†æ”¯æ´ï¼ˆé ˜æ–™ã€å®Œå·¥å‡å¯åˆ†æ‰¹ï¼‰