# å•†å“æ’ç¨‹è£½ä½œç³»çµ±è¨­è¨ˆæ–‡ä»¶

> æ–‡ä»¶å»ºç«‹æ—¥æœŸï¼š2024/12/06  
> ç‰ˆæœ¬ï¼šv1.0

---

## ç›®éŒ„

1. [ç³»çµ±æ¦‚è¿°](#ç³»çµ±æ¦‚è¿°)
2. [æ¥­å‹™æµç¨‹](#æ¥­å‹™æµç¨‹)
3. [è¨­è¨ˆæ±ºç­–æ‘˜è¦](#è¨­è¨ˆæ±ºç­–æ‘˜è¦)
4. [è³‡æ–™æ¨¡å‹è¨­è¨ˆ](#è³‡æ–™æ¨¡å‹è¨­è¨ˆ)
5. [é é¢è¨­è¨ˆ](#é é¢è¨­è¨ˆ)
6. [å¯¦ä½œæ­¥é©Ÿè¦åŠƒ](#å¯¦ä½œæ­¥é©Ÿè¦åŠƒ)
7. [ç›¸é—œæª”æ¡ˆæ¸…å–®](#ç›¸é—œæª”æ¡ˆæ¸…å–®)

---

## ç³»çµ±æ¦‚è¿°

### ç›®æ¨™

å»ºç«‹å®Œæ•´çš„ç”Ÿç”¢æ’ç¨‹ç³»çµ±ï¼Œè®“ä½¿ç”¨è€…å¯ä»¥ï¼š

1. å¾**å¾…æ’ç¨‹å·¥ä½œå°ï¼ˆè¨‚å–®è¡¨ï¼‰**æŸ¥çœ‹ç›®å‰å·²ä¸‹è¨‚å–®ä¸­æœ‰å“ªäº›ç”¢å“éœ€è¦ç”Ÿç”¢
2. é€é**ç”Ÿç”¢æ’ç¨‹ï¼ˆè£½ä½œè¡¨ï¼‰**å®‰æ’å“ªäº›è¨‚å–®è¦è¢«åˆ—å…¥æ’ç¨‹
3. è¿½è¹¤ç”Ÿç”¢é€²åº¦ç›´åˆ°å®Œæˆå…¥åº«

### æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½æ¨¡çµ„ | èªªæ˜ |
|---------|------|
| å¾…æ’ç¨‹å·¥ä½œå° | é¡¯ç¤ºæ‰€æœ‰åº«å­˜ä¸è¶³ã€éœ€è¦ç”Ÿç”¢çš„è¨‚å–®æ˜ç´° |
| ç”Ÿç”¢æ’ç¨‹ç·¨è¼¯ | ç®¡ç†æ’ç¨‹é …ç›®ã€å±•é–‹ BOM çµ„ä»¶ã€è¿½è¹¤ç‹€æ…‹ |
| è½‰æ’ç¨‹åŠŸèƒ½ | å¾éŠ·è²¨è¨‚å–® BOM ç·¨è¼¯ç•«é¢ç›´æ¥è½‰å…¥æ’ç¨‹ |
| ç‹€æ…‹è¿½è¹¤ | é€éå…¥åº«å–®ç­‰å–®æ“šè‡ªå‹•æ›´æ–°ç”Ÿç”¢ç‹€æ…‹ |

---

## æ¥­å‹™æµç¨‹

### å®Œæ•´æµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”Ÿç”¢æ’ç¨‹å®Œæ•´æµç¨‹                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  éŠ·è²¨è¨‚å–®                    å¾…æ’ç¨‹å·¥ä½œå°                   ç”Ÿç”¢æ’ç¨‹
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ è¨‚å–®æ˜ç´° â”‚â”€â”€(åº«å­˜ä¸è¶³)â”€â”€â†’â”‚   è¨‚å–®è¡¨     â”‚â”€â”€(å‹¾é¸è½‰å…¥)â”€â”€â†’â”‚   è£½ä½œè¡¨    â”‚
 â”‚ + BOM   â”‚               â”‚ å¾…æ’ç¨‹æ¸…å–®   â”‚              â”‚ æ’ç¨‹æ˜ç´°    â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                           â”‚                           â”‚
      â”‚                    è©¢å•ï¼šæ˜¯å¦åˆä½µ                       â”‚
      â”‚                    ç›¸åŒç”¢å“ï¼Ÿ                          â”‚
      â”‚                           â”‚                           â–¼
      â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                    â”‚  æ˜¯    â”‚  å¦ â”‚              â”‚ å±•é–‹ BOM    â”‚
      â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜              â”‚ çµ„ä»¶éœ€æ±‚    â”‚
      â”‚                                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                                                        â”‚
      â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚    â”‚
      â”‚    â–¼
      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  â”‚   å¾…ç”Ÿç”¢    â”‚â”€â”€â”€â”€â†’â”‚   è£½ä½œä¸­    â”‚â”€â”€â”€â”€â†’â”‚   å·²å…¥åº«    â”‚
      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                                                â”‚
      â”‚                                                â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€(å›å¯«å·²æ’ç¨‹æ¨™è¨˜)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                       â”‚
                                              é€éå…¥åº«å–®è§¸ç™¼
                                              ç‹€æ…‹è‡ªå‹•è®Šæ›´
```

### æµç¨‹èªªæ˜

#### Step 1ï¼šéŠ·è²¨è¨‚å–®å»ºç«‹

1. å»ºç«‹éŠ·è²¨è¨‚å–®åŠæ˜ç´°
2. ç·¨è¼¯ BOM çµ„æˆï¼ˆSalesOrderCompositionDetailï¼‰
3. ç³»çµ±è‡ªå‹•æª¢æŸ¥åº«å­˜ç‹€æ…‹

#### Step 2ï¼šå¾…æ’ç¨‹å·¥ä½œå°

1. é¡¯ç¤ºæ‰€æœ‰ã€Œåº«å­˜ä¸è¶³ã€çš„è¨‚å–®æ˜ç´°
2. ä½¿ç”¨è€…å¯ä¾äº¤æœŸã€å®¢æˆ¶ã€ç”¢å“ç¯©é¸
3. å‹¾é¸è¦æ’ç¨‹çš„é …ç›®
4. é»æ“Šã€Œè½‰å…¥æ’ç¨‹ã€ï¼Œç³»çµ±è©¢å•æ˜¯å¦åˆä½µç›¸åŒç”¢å“

#### Step 3ï¼šå»ºç«‹ç”Ÿç”¢æ’ç¨‹

1. ç³»çµ±å»ºç«‹ ProductionSchedule ä¸»æª”
2. å»ºç«‹ ProductionScheduleItemï¼ˆæˆå“å±¤ç´šï¼‰
3. å¦‚é¸æ“‡åˆä½µï¼Œç›¸åŒç”¢å“çš„è¨‚å–®æœƒåˆä½µæˆä¸€å€‹ Item
4. å»ºç«‹ ProductionScheduleAllocationï¼ˆè¨‚å–®åˆ†é…è¿½æº¯ï¼‰
5. è‡ªå‹•å±•é–‹ BOMï¼Œå»ºç«‹ ProductionScheduleDetailï¼ˆçµ„ä»¶éœ€æ±‚ï¼‰

#### Step 4ï¼šç”Ÿç”¢èˆ‡å…¥åº«

1. ç”Ÿç”¢äººå“¡ä¾æ’ç¨‹é€²è¡Œç”Ÿç”¢
2. é€éå…¥åº«å–®è§¸ç™¼ç‹€æ…‹è®Šæ›´
3. ç‹€æ…‹ï¼šå¾…ç”Ÿç”¢ â†’ è£½ä½œä¸­ â†’ å·²å…¥åº«

---

## è¨­è¨ˆæ±ºç­–æ‘˜è¦

### æ ¸å¿ƒæ±ºç­–

| æ±ºç­–é …ç›® | é¸æ“‡ | èªªæ˜ |
|---------|------|------|
| æ•´é«”æ–¹æ¡ˆ | æ–¹æ¡ˆ Aï¼ˆç°¡æ˜“æ¨¡å¼ï¼‰ | é©åˆä¸­å°ä¼æ¥­ï¼Œæ‰‹å‹•é¸æ“‡è¦æ’ç¨‹çš„è¨‚å–® |
| æ’ç¨‹ç²’åº¦ | æ··åˆæ¨¡å¼ | ä»¥ç”¢å“ç‚ºå–®ä½ç”Ÿç”¢ï¼ˆæ•ˆç‡ï¼‰ï¼Œä½†ä¿ç•™è¨‚å–®è¿½æº¯ï¼ˆå¯è¿½æº¯æ€§ï¼‰ |
| åˆä½µç”Ÿç”¢æ™‚æ©Ÿ | ä½¿ç”¨è€…é¸æ“‡ | è½‰æ’ç¨‹æ™‚è©¢å•ã€Œæ˜¯å¦åˆä½µç›¸åŒç”¢å“ï¼Ÿã€ |
| åº«å­˜æ‰£æŠµ | é¡¯ç¤ºåƒè€ƒ | é¡¯ç¤ºåº«å­˜æ•¸é‡ä¾›ä½¿ç”¨è€…åƒè€ƒï¼Œä¸è‡ªå‹•æ‰£æŠµè¨ˆç®— |
| ç‹€æ…‹è¿½è¹¤ | ç°¡åŒ–ä¸‰æ…‹ | å¾…ç”Ÿç”¢ â†’ è£½ä½œä¸­ â†’ å·²å…¥åº« |
| BOM è™•ç† | å±•é–‹é¡¯ç¤º | å¾ ProductCompositionDetail å±•é–‹ BOM çµ„ä»¶ |

### ç´°ç¯€æ±ºç­–

| æ±ºç­–é …ç›® | é¸æ“‡ | èªªæ˜ |
|---------|------|------|
| ä¾†æºè¨‚å–®é¡¯ç¤º | å¯å±•é–‹æŸ¥çœ‹ | æ’ç¨‹é …ç›®å¯å±•é–‹æŸ¥çœ‹è©³ç´°çš„è¨‚å–®åˆ†é…æ˜ç´° |
| çµ„ä»¶åº«å­˜ä¸è¶³ | æç¤ºå¾Œé¸æ“‡ | é¡¯ç¤ºè­¦ç¤ºï¼Œä½¿ç”¨è€…å¯é¸æ“‡ç¹¼çºŒæˆ–å–æ¶ˆ |
| ç‹€æ…‹è®Šæ›´æ™‚æ©Ÿ | æŒ‰éˆ•è§¸ç™¼ | ã€Œé–‹å§‹ç”Ÿç”¢ã€â†’è£½ä½œä¸­ã€ã€Œå®Œæˆå…¥åº«ã€â†’å·²å…¥åº« |
| è½‰æ’ç¨‹å…¥å£é» | A + B | A: BOM ç·¨è¼¯ Modalã€B: è¨‚å–®ç·¨è¼¯ Modal |
| éƒ¨åˆ†æ’ç¨‹ | å…è¨± | å¯é¸æ“‡æ’ç¨‹éƒ¨åˆ†æ•¸é‡ï¼Œå‰©é¤˜æ•¸é‡å¯å¾ŒçºŒå†æ’ç¨‹ |
| åˆä½µç›¸åŒç”¢å“ | ä¸åˆä½µ | æ¯å€‹è¨‚å–®æ˜ç´°ç¨ç«‹å»ºç«‹æ’ç¨‹é …ç›®ï¼Œç°¡åŒ–è¿½æº¯ |
| å…¥åº«æ–¹å¼ | å®Œæ•´ç‰ˆ | å»ºç«‹ ProductionScheduleCompletion è¨˜éŒ„æ¯æ¬¡å…¥åº« |
| å…¥åº«è§¸ç™¼ | æ’ç¨‹å…§æ“ä½œ | é»æ“Šã€Œå®Œæˆå…¥åº«ã€æŒ‰éˆ•ç›´æ¥è™•ç† |
| çµ„ä»¶é ˜æ–™ | è‡ªå‹•æ‰£é™¤ | é–‹å§‹ç”Ÿç”¢æ™‚è‡ªå‹•æ‰£åº«å­˜ï¼Œè¨˜éŒ„ã€Œç”Ÿç”¢ä¸­ã€æ•¸é‡ |

---

## è³‡æ–™æ¨¡å‹è¨­è¨ˆ

### å¯¦é«”é—œè¯åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ProductionSchedule              â”‚  (ç”Ÿç”¢æ’ç¨‹ä¸»æª”) â† ç¾æœ‰ï¼Œå°å¹…èª¿æ•´
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ Id                              â”‚
â”‚ Code (æ’ç¨‹ä»£ç¢¼)                  â”‚
â”‚ ScheduleDate (æ’ç¨‹æ—¥æœŸ)          â”‚
â”‚ CustomerId (å®¢æˆ¶ï¼Œå¯ç‚ºç©º)         â”‚
â”‚ CreatedByEmployeeId (è£½å–®äººå“¡)   â”‚
â”‚ SourceDocumentType (ä¾†æºé¡å‹)    â”‚
â”‚ SourceDocumentId (ä¾†æºID)        â”‚
â”‚ Remarks (å‚™è¨»)                   â”‚
â”‚ Status (EntityStatus)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ 1:N
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ProductionScheduleItem (æ’ç¨‹é …ç›® - æˆå“å±¤ç´š)          â”‚  â† æ–°å¢
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ Id                                                  â”‚
â”‚ ProductionScheduleId (FK â†’ ProductionSchedule)      â”‚
â”‚ ProductId (FK â†’ Productï¼Œæˆå“)                       â”‚
â”‚ TotalRequiredQuantity (ç¸½éœ€æ±‚æ•¸é‡)                   â”‚
â”‚ CurrentStockQuantity (ç•¶æ™‚åº«å­˜ - å¿«ç…§åƒè€ƒç”¨)          â”‚
â”‚ CompletedQuantity (å·²å®Œæˆæ•¸é‡)                       â”‚
â”‚ Priority (å„ªå…ˆé †åºï¼Œé è¨­ 0)                          â”‚
â”‚ ProductionStatus (å¾…ç”Ÿç”¢/è£½ä½œä¸­/å·²å…¥åº«)               â”‚
â”‚ Remarks (å‚™è¨»)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ 1:N           â”‚ 1:N
                â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ProductionScheduleDetail      â”‚  â”‚ ProductionScheduleAllocation    â”‚  â† æ–°å¢
â”‚ (çµ„ä»¶éœ€æ±‚ - ç¾æœ‰ï¼Œèª¿æ•´é—œè¯)    â”‚  â”‚ (è¨‚å–®åˆ†é…è¿½æº¯)                   â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ Id                            â”‚  â”‚ Id                              â”‚
â”‚ ProductionScheduleItemId (FK) â”‚  â”‚ ProductionScheduleItemId (FK)   â”‚
â”‚ ComponentProductId (FK)       â”‚  â”‚ SalesOrderDetailId (FK)         â”‚
â”‚ ProductCompositionDetailId    â”‚  â”‚ Quantity (æ­¤è¨‚å–®çš„éœ€æ±‚æ•¸é‡)       â”‚
â”‚ RequiredQuantity (éœ€æ±‚æ•¸é‡)    â”‚  â”‚ DeliveredQuantity (å·²å‡ºè²¨æ•¸é‡)   â”‚
â”‚ EstimatedUnitCost (é ä¼°æˆæœ¬)   â”‚  â”‚ Remarks                         â”‚
â”‚ ActualUnitCost (å¯¦éš›æˆæœ¬)      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ TotalCost (ç¸½æˆæœ¬)             â”‚
â”‚ WarehouseId (é ˜æ–™å€‰åº«)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ–°å¢åˆ—èˆ‰

```csharp
// æª”æ¡ˆï¼šData/Enums/ProductionItemStatus.cs

namespace ERPCore2.Data.Enums
{
    /// <summary>
    /// ç”Ÿç”¢æ’ç¨‹é …ç›®ç‹€æ…‹
    /// </summary>
    public enum ProductionItemStatus
    {
        /// <summary>
        /// å¾…ç”Ÿç”¢ - æ’ç¨‹å·²å»ºç«‹ï¼Œç­‰å¾…é–‹å§‹ç”Ÿç”¢
        /// </summary>
        Pending = 0,

        /// <summary>
        /// è£½ä½œä¸­ - æ­£åœ¨ç”Ÿç”¢
        /// </summary>
        InProgress = 1,

        /// <summary>
        /// å·²å…¥åº« - ç”Ÿç”¢å®Œæˆä¸¦å·²å…¥åº«
        /// </summary>
        Completed = 2
    }
}
```

### æ–°å¢å¯¦é«”ï¼šProductionScheduleItem

```csharp
// æª”æ¡ˆï¼šData/Entities/ProductionManagement/ProductionScheduleItem.cs

using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;
using Microsoft.EntityFrameworkCore;
using ERPCore2.Data.Enums;

namespace ERPCore2.Data.Entities
{
    /// <summary>
    /// ç”Ÿç”¢æ’ç¨‹é …ç›® - æˆå“å±¤ç´šï¼Œå¯åˆä½µå¤šå¼µè¨‚å–®çš„ç›¸åŒç”¢å“
    /// </summary>
    [Index(nameof(ProductionScheduleId), nameof(ProductId))]
    [Index(nameof(ProductId))]
    [Index(nameof(ProductionStatus))]
    public class ProductionScheduleItem : BaseEntity
    {
        // é—œè¯è³‡è¨Š
        [Required(ErrorMessage = "ç”Ÿç”¢æ’ç¨‹ä¸»æª”ç‚ºå¿…å¡«")]
        [Display(Name = "ç”Ÿç”¢æ’ç¨‹ä¸»æª”")]
        [ForeignKey(nameof(ProductionSchedule))]
        public int ProductionScheduleId { get; set; }

        [Required(ErrorMessage = "æˆå“ç‚ºå¿…å¡«")]
        [Display(Name = "æˆå“")]
        [ForeignKey(nameof(Product))]
        public int ProductId { get; set; }

        // æ•¸é‡è³‡è¨Š
        [Required(ErrorMessage = "ç¸½éœ€æ±‚æ•¸é‡ç‚ºå¿…å¡«")]
        [Display(Name = "ç¸½éœ€æ±‚æ•¸é‡")]
        [Column(TypeName = "decimal(18,4)")]
        public decimal TotalRequiredQuantity { get; set; } = 0;

        [Display(Name = "ç•¶æ™‚åº«å­˜æ•¸é‡")]
        [Column(TypeName = "decimal(18,4)")]
        public decimal CurrentStockQuantity { get; set; } = 0;

        [Display(Name = "å·²å®Œæˆæ•¸é‡")]
        [Column(TypeName = "decimal(18,4)")]
        public decimal CompletedQuantity { get; set; } = 0;

        // ç‹€æ…‹èˆ‡å„ªå…ˆåº
        [Display(Name = "å„ªå…ˆé †åº")]
        public int Priority { get; set; } = 0;

        [Display(Name = "ç”Ÿç”¢ç‹€æ…‹")]
        public ProductionItemStatus ProductionStatus { get; set; } = ProductionItemStatus.Pending;

        [Display(Name = "å‚™è¨»")]
        [StringLength(500)]
        public string? Remarks { get; set; }

        // Navigation Properties
        public ProductionSchedule ProductionSchedule { get; set; } = null!;
        public Product Product { get; set; } = null!;
        
        // ä¸€å°å¤šï¼šçµ„ä»¶éœ€æ±‚
        public ICollection<ProductionScheduleDetail> ScheduleDetails { get; set; } = new List<ProductionScheduleDetail>();
        
        // ä¸€å°å¤šï¼šè¨‚å–®åˆ†é…
        public ICollection<ProductionScheduleAllocation> Allocations { get; set; } = new List<ProductionScheduleAllocation>();

        // è¨ˆç®—å±¬æ€§
        [NotMapped]
        public decimal RemainingQuantity => TotalRequiredQuantity - CompletedQuantity;

        [NotMapped]
        public bool IsCompleted => CompletedQuantity >= TotalRequiredQuantity;

        [NotMapped]
        public decimal CompletionPercentage => TotalRequiredQuantity > 0 
            ? Math.Round(CompletedQuantity / TotalRequiredQuantity * 100, 2) 
            : 0;
    }
}
```

### æ–°å¢å¯¦é«”ï¼šProductionScheduleAllocation

```csharp
// æª”æ¡ˆï¼šData/Entities/ProductionManagement/ProductionScheduleAllocation.cs

using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;
using Microsoft.EntityFrameworkCore;

namespace ERPCore2.Data.Entities
{
    /// <summary>
    /// ç”Ÿç”¢æ’ç¨‹åˆ†é… - è¿½æº¯æ’ç¨‹é …ç›®èˆ‡éŠ·è²¨è¨‚å–®æ˜ç´°çš„é—œè¯
    /// </summary>
    [Index(nameof(ProductionScheduleItemId))]
    [Index(nameof(SalesOrderDetailId))]
    [Index(nameof(ProductionScheduleItemId), nameof(SalesOrderDetailId), IsUnique = true)]
    public class ProductionScheduleAllocation : BaseEntity
    {
        // é—œè¯è³‡è¨Š
        [Required(ErrorMessage = "ç”Ÿç”¢æ’ç¨‹é …ç›®ç‚ºå¿…å¡«")]
        [Display(Name = "ç”Ÿç”¢æ’ç¨‹é …ç›®")]
        [ForeignKey(nameof(ProductionScheduleItem))]
        public int ProductionScheduleItemId { get; set; }

        [Required(ErrorMessage = "éŠ·è²¨è¨‚å–®æ˜ç´°ç‚ºå¿…å¡«")]
        [Display(Name = "éŠ·è²¨è¨‚å–®æ˜ç´°")]
        [ForeignKey(nameof(SalesOrderDetail))]
        public int SalesOrderDetailId { get; set; }

        // æ•¸é‡è³‡è¨Š
        [Required(ErrorMessage = "åˆ†é…æ•¸é‡ç‚ºå¿…å¡«")]
        [Display(Name = "åˆ†é…æ•¸é‡")]
        [Column(TypeName = "decimal(18,4)")]
        public decimal Quantity { get; set; } = 0;

        [Display(Name = "å·²å‡ºè²¨æ•¸é‡")]
        [Column(TypeName = "decimal(18,4)")]
        public decimal DeliveredQuantity { get; set; } = 0;

        [Display(Name = "å‚™è¨»")]
        [StringLength(500)]
        public string? Remarks { get; set; }

        // Navigation Properties
        public ProductionScheduleItem ProductionScheduleItem { get; set; } = null!;
        public SalesOrderDetail SalesOrderDetail { get; set; } = null!;

        // è¨ˆç®—å±¬æ€§
        [NotMapped]
        public decimal RemainingQuantity => Quantity - DeliveredQuantity;

        [NotMapped]
        public bool IsFullyDelivered => DeliveredQuantity >= Quantity;
    }
}
```

### èª¿æ•´ç¾æœ‰å¯¦é«”ï¼šProductionScheduleDetail

éœ€èª¿æ•´é—œè¯å¾ `ProductionScheduleId` æ”¹ç‚º `ProductionScheduleItemId`ï¼š

```csharp
// åŸæœ¬ï¼špublic int ProductionScheduleId { get; set; }
// æ”¹ç‚ºï¼špublic int ProductionScheduleItemId { get; set; }

// ä¸¦æ›´æ–° Navigation Property
// åŸæœ¬ï¼špublic ProductionSchedule ProductionSchedule { get; set; } = null!;
// æ”¹ç‚ºï¼špublic ProductionScheduleItem ProductionScheduleItem { get; set; } = null!;
```

### SalesOrderDetail æ–°å¢æ¬„ä½

```csharp
// åœ¨ SalesOrderDetail ä¸­æ–°å¢ï¼Œç”¨æ–¼è¿½è¹¤æ’ç¨‹ç‹€æ…‹

[Display(Name = "å·²æ’ç¨‹æ•¸é‡")]
[Column(TypeName = "decimal(18,4)")]
public decimal ScheduledQuantity { get; set; } = 0;

[NotMapped]
public bool IsFullyScheduled => ScheduledQuantity >= Quantity;

[NotMapped]
public decimal UnscheduledQuantity => Quantity - ScheduledQuantity;
```

---

## è½‰æ’ç¨‹å…¥å£é»è¨­è¨ˆ

### å…¥å£é» Aï¼šBOM ç·¨è¼¯ Modalï¼ˆå–®ä¸€æ˜ç´°ï¼‰

**ä½ç½®**ï¼š`SalesOrderCompositionEditModal.razor` çš„ HeaderButtons

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ ç·¨è¼¯ BOM çµ„æˆ - æˆå“X                          [è½‰æ’ç¨‹] [å„²å­˜] [å–æ¶ˆ] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ...BOM çµ„ä»¶åˆ—è¡¨...                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åŠŸèƒ½**ï¼š
- å°‡ç•¶å‰ç·¨è¼¯çš„å–®ä¸€è¨‚å–®æ˜ç´°è½‰å…¥æ’ç¨‹
- é»æ“Šå¾Œå½ˆå‡ºã€Œè½‰æ’ç¨‹ç¢ºèª Modalã€

### å…¥å£é» Bï¼šè¨‚å–®ç·¨è¼¯ Modalï¼ˆæ•´å¼µè¨‚å–®ï¼‰

**ä½ç½®**ï¼š`SalesOrderEditModalComponent.razor` çš„ CustomActionButtons

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ éŠ·è²¨è¨‚å–® SO2024-001              [è½‰æ’ç¨‹] [è½‰éŠ·è²¨] [åˆ—å°] [å„²å­˜] [å–æ¶ˆ]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ...è¨‚å–®å…§å®¹...                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åŠŸèƒ½**ï¼š
- å°‡æ•´å¼µè¨‚å–®æ‰€æœ‰ã€Œå¯æ’ç¨‹ã€çš„æ˜ç´°è½‰å…¥æ’ç¨‹
- é»æ“Šå¾Œå½ˆå‡ºã€Œæ‰¹æ¬¡è½‰æ’ç¨‹ç¢ºèª Modalã€

---

## è½‰æ’ç¨‹ç¢ºèª Modal è¨­è¨ˆ

### å–®ä¸€æ˜ç´°è½‰æ’ç¨‹ï¼ˆå…¥å£é» Aï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ è½‰å…¥ç”Ÿç”¢æ’ç¨‹                                                    [X]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   ç”¢å“è³‡è¨Š                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ ç”¢å“ï¼š[P001] æˆå“X                                              â”‚  â”‚
â”‚   â”‚ è¨‚å–®ç·¨è™Ÿï¼šSO2024-001                                            â”‚  â”‚
â”‚   â”‚ å®¢æˆ¶ï¼šå®¢æˆ¶A                                                     â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â”‚   æ•¸é‡è³‡è¨Š                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ è¨‚å–®æ•¸é‡ï¼š      100                                             â”‚  â”‚
â”‚   â”‚ å·²æ’ç¨‹æ•¸é‡ï¼š    30                                              â”‚  â”‚
â”‚   â”‚ å¯æ’ç¨‹æ•¸é‡ï¼š    70                                              â”‚  â”‚
â”‚   â”‚                                                                 â”‚  â”‚
â”‚   â”‚ æœ¬æ¬¡æ’ç¨‹æ•¸é‡ï¼š  [____70____]  â† å¯ç·¨è¼¯ï¼Œé è¨­ç‚ºå¯æ’ç¨‹æ•¸é‡         â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â”‚   åº«å­˜ç‹€æ…‹                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ æˆå“åº«å­˜ï¼š30                                                    â”‚  â”‚
â”‚   â”‚ åº«å­˜ç¼ºå£ï¼š40 (æœ¬æ¬¡æ’ç¨‹ 70 - åº«å­˜ 30)                            â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â”‚   BOM çµ„ä»¶åº«å­˜æª¢æŸ¥                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ çµ„ä»¶      â”‚ éœ€æ±‚æ•¸é‡ â”‚ åº«å­˜  â”‚ ç‹€æ…‹                             â”‚  â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚   â”‚ åŸæ–™A     â”‚ 140     â”‚ 500  â”‚ âœ… è¶³å¤                            â”‚  â”‚
â”‚   â”‚ åŸæ–™B     â”‚ 105     â”‚ 100  â”‚ âš ï¸ ä¸è¶³ 5                        â”‚  â”‚
â”‚   â”‚ åŠæˆå“C   â”‚ 70      â”‚ 50   â”‚ âš ï¸ ä¸è¶³ 20                       â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â”‚   âš ï¸ æœ‰ 2 é …çµ„ä»¶åº«å­˜ä¸è¶³ï¼Œæ˜¯å¦ä»è¦å»ºç«‹æ’ç¨‹ï¼Ÿ                            â”‚
â”‚                                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              [å–æ¶ˆ]  [ç¢ºèªè½‰æ’ç¨‹]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•´å¼µè¨‚å–®è½‰æ’ç¨‹ï¼ˆå…¥å£é» Bï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ æ‰¹æ¬¡è½‰å…¥ç”Ÿç”¢æ’ç¨‹                                                [X]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   è¨‚å–®è³‡è¨Šï¼šSO2024-001 | å®¢æˆ¶A | è¨‚å–®æ—¥æœŸ 2024/12/01                    â”‚
â”‚                                                                         â”‚
â”‚   å¯æ’ç¨‹æ˜ç´°                                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚â˜‘â”‚ ç”¢å“     â”‚è¨‚å–®æ•¸é‡â”‚å·²æ’ç¨‹â”‚å¯æ’ç¨‹â”‚æœ¬æ¬¡æ’ç¨‹â”‚ åº«å­˜ â”‚ ç¼ºå£        â”‚  â”‚
â”‚   â”œâ”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚   â”‚â˜‘â”‚ æˆå“X    â”‚ 100   â”‚ 0   â”‚ 100 â”‚[_100_]â”‚ 30  â”‚ 70           â”‚  â”‚
â”‚   â”‚â˜‘â”‚ æˆå“Y    â”‚ 50    â”‚ 20  â”‚ 30  â”‚[__30_]â”‚ 10  â”‚ 20           â”‚  â”‚
â”‚   â”‚â˜â”‚ æˆå“Z    â”‚ 80    â”‚ 80  â”‚ 0   â”‚ -     â”‚ -   â”‚ (å·²å®Œå…¨æ’ç¨‹) â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â”‚   æ’ç¨‹é¸é …                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ â—‹ å€‹åˆ¥å»ºç«‹æ’ç¨‹å–®ï¼ˆæ¯å€‹ç”¢å“ä¸€å¼µï¼‰                                 â”‚  â”‚
â”‚   â”‚ â— åˆä½µç‚ºä¸€å¼µæ’ç¨‹å–®                                              â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â”‚   å·²é¸ 2 é …ï¼Œå…±æ’ç¨‹ 130 å€‹ç”¢å“                                          â”‚
â”‚                                                                         â”‚
â”‚   âš ï¸ çµ„ä»¶åº«å­˜æª¢æŸ¥çµæœï¼š3 é …çµ„ä»¶åº«å­˜ä¸è¶³ [æŸ¥çœ‹è©³æƒ…]                      â”‚
â”‚                                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              [å–æ¶ˆ]  [ç¢ºèªè½‰æ’ç¨‹]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## é é¢è¨­è¨ˆ

### 1. å¾…æ’ç¨‹å·¥ä½œå°ï¼ˆè¨‚å–®è¡¨ï¼‰

**æª”æ¡ˆè·¯å¾‘**ï¼š`Components/Pages/ProductionManagement/ProductionPendingWorkbench.razor`

**URL**ï¼š`/production/pending-workbench`

#### UI è¨­è¨ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ å¾…æ’ç¨‹å·¥ä½œå°                                          [é‡æ–°æ•´ç†]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç¯©é¸æ¢ä»¶                                                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ äº¤æœŸç¯„åœï¼š[èµ·å§‹æ—¥æœŸ] ~ [çµæŸæ—¥æœŸ]  å®¢æˆ¶ï¼š[é¸æ“‡å®¢æˆ¶ â–¼]                  â”‚â”‚
â”‚ â”‚ ç”¢å“ï¼š[é¸æ“‡ç”¢å“ â–¼]                 [æœå°‹] [æ¸…é™¤ç¯©é¸]                  â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚â˜‘â”‚ è¨‚å–®ç·¨è™Ÿ     â”‚ å®¢æˆ¶åç¨±  â”‚ ç”¢å“åç¨±    â”‚éœ€æ±‚æ•¸é‡â”‚ åº«å­˜ â”‚ ç¼ºå£ â”‚äº¤æœŸ    â”‚â”‚
â”‚ â”œâ”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚ â”‚â˜‘â”‚ SO2024-001  â”‚ å®¢æˆ¶A    â”‚ [P001]æˆå“Xâ”‚ 100   â”‚ 30  â”‚ 70  â”‚12/15  â”‚â”‚
â”‚ â”‚â˜‘â”‚ SO2024-002  â”‚ å®¢æˆ¶B    â”‚ [P001]æˆå“Xâ”‚ 80    â”‚ 30  â”‚ 50  â”‚12/18  â”‚â”‚
â”‚ â”‚â˜â”‚ SO2024-003  â”‚ å®¢æˆ¶C    â”‚ [P002]æˆå“Yâ”‚ 50    â”‚ 60  â”‚ -   â”‚12/20  â”‚â”‚
â”‚ â”‚â˜‘â”‚ SO2024-004  â”‚ å®¢æˆ¶A    â”‚ [P003]æˆå“Zâ”‚ 30    â”‚ 10  â”‚ 20  â”‚12/15  â”‚â”‚
â”‚ â”‚â˜â”‚ SO2024-005  â”‚ å®¢æˆ¶D    â”‚ [P001]æˆå“Xâ”‚ 40    â”‚ 30  â”‚ 10  â”‚12/25  â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                         â”‚
â”‚ å·²é¸æ“‡ 3 ç­†ï¼Œå…± 3 ç¨®ç”¢å“                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                           [è½‰å…¥æ’ç¨‹ â–¼]                  â”‚
â”‚                                           â”œâ”€ å€‹åˆ¥å»ºç«‹æ’ç¨‹ï¼ˆ3å¼µæ’ç¨‹å–®ï¼‰    â”‚
â”‚                                           â””â”€ åˆä½µç›¸åŒç”¢å“ï¼ˆ2å¼µæ’ç¨‹å–®ï¼‰    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### åŠŸèƒ½èªªæ˜

| åŠŸèƒ½ | èªªæ˜ |
|------|------|
| è³‡æ–™ä¾†æº | SalesOrderDetail + SalesOrderCompositionDetail |
| ç¯©é¸æ¢ä»¶ | åº«å­˜ä¸è¶³ï¼ˆç¼ºå£ > 0ï¼‰ã€æœªå®Œå…¨æ’ç¨‹ã€è¨‚å–®ç‹€æ…‹æœ‰æ•ˆ |
| åº«å­˜é¡¯ç¤º | å¾ InventoryStock å³æ™‚è¨ˆç®— |
| ç¼ºå£è¨ˆç®— | éœ€æ±‚æ•¸é‡ - åº«å­˜ï¼Œè² æ•¸é¡¯ç¤º "-" |
| å€‹åˆ¥å»ºç«‹ | æ¯å€‹å‹¾é¸é …ç›®å»ºç«‹ç¨ç«‹çš„æ’ç¨‹å–® |
| åˆä½µç›¸åŒç”¢å“ | ç›¸åŒç”¢å“çš„ä¸åŒè¨‚å–®åˆä½µæˆä¸€å€‹æ’ç¨‹é …ç›® |

---

### 2. ç”Ÿç”¢æ’ç¨‹ç·¨è¼¯ï¼ˆè£½ä½œè¡¨ï¼‰

**æª”æ¡ˆè·¯å¾‘**ï¼š`Components/Pages/ProductionManagement/ProductionScheduleEditModalComponent.razor`ï¼ˆå¢å¼·ç¾æœ‰ï¼‰

#### UI è¨­è¨ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ ç”Ÿç”¢æ’ç¨‹ PS2024-001                              [å„²å­˜] [å–æ¶ˆ]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åŸºæœ¬è³‡è¨Š                                                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ æ’ç¨‹ä»£ç¢¼ï¼šPS2024-001          æ’ç¨‹æ—¥æœŸï¼š2024/12/10                   â”‚â”‚
â”‚ â”‚ å®¢æˆ¶ï¼š(ä¾é …ç›®)                è£½å–®äººå“¡ï¼šç‹å°æ˜                        â”‚â”‚
â”‚ â”‚ å‚™è¨»ï¼š_______________________________________________                 â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ã€æ’ç¨‹é …ç›®ã€‘                                               [æ–°å¢é …ç›®]   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ç”¢å“      â”‚éœ€æ±‚æ•¸é‡â”‚ åº«å­˜ â”‚å·²å®Œæˆâ”‚ ç‹€æ…‹  â”‚å„ªå…ˆåºâ”‚ ä¾†æºè¨‚å–®    â”‚ æ“ä½œ  â”‚â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚ â”‚[P001]æˆå“Xâ”‚ 180   â”‚ 30  â”‚ 0   â”‚å¾…ç”Ÿç”¢ â”‚ 1   â”‚ 2ç­† [å±•é–‹â–¼]â”‚[åˆªé™¤]â”‚â”‚
â”‚ â”‚[P003]æˆå“Zâ”‚ 30    â”‚ 10  â”‚ 0   â”‚å¾…ç”Ÿç”¢ â”‚ 2   â”‚ 1ç­† [å±•é–‹â–¼]â”‚[åˆªé™¤]â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                         â”‚
â”‚ ã€è¨‚å–®åˆ†é…æ˜ç´° - æˆå“Xã€‘                                   [æ”¶åˆ â–²]     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ è¨‚å–®ç·¨è™Ÿ     â”‚ å®¢æˆ¶     â”‚ åˆ†é…æ•¸é‡ â”‚ å·²å‡ºè²¨ â”‚ äº¤æœŸ     â”‚ å‚™è¨»       â”‚â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚ â”‚ SO2024-001   â”‚ å®¢æˆ¶A   â”‚ 100     â”‚ 0     â”‚ 12/15   â”‚            â”‚â”‚
â”‚ â”‚ SO2024-002   â”‚ å®¢æˆ¶B   â”‚ 80      â”‚ 0     â”‚ 12/18   â”‚            â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                         â”‚
â”‚ ã€BOM çµ„ä»¶å±•é–‹ - æˆå“X (éœ€æ±‚: 180)ã€‘                       [æ”¶åˆ â–²]     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ çµ„ä»¶        â”‚å–®ä½éœ€æ±‚ â”‚ ç¸½éœ€æ±‚  â”‚ åº«å­˜  â”‚ ç‹€æ…‹     â”‚ é ˜æ–™å€‰åº«    â”‚â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚ â”‚ [M001]åŸæ–™A â”‚ 2.00   â”‚ 360    â”‚ 500  â”‚ âœ… è¶³å¤   â”‚ [åŸæ–™å€‰ â–¼] â”‚â”‚
â”‚ â”‚ [M002]åŸæ–™B â”‚ 1.50   â”‚ 270    â”‚ 100  â”‚ âš ï¸ ä¸è¶³ â”‚ [åŸæ–™å€‰ â–¼] â”‚â”‚
â”‚ â”‚ [S001]åŠæˆå“Câ”‚ 1.00   â”‚ 180    â”‚ 50   â”‚ âš ï¸ ä¸è¶³ â”‚ [åŠæˆå“å€‰â–¼]â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                         â”‚
â”‚ âš ï¸ è­¦å‘Šï¼šæœ‰ 2 é …çµ„ä»¶åº«å­˜ä¸è¶³ï¼Œè«‹ç¢ºèªæ˜¯å¦ç¹¼çºŒå»ºç«‹æ’ç¨‹ï¼Ÿ                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### åŠŸèƒ½èªªæ˜

| å€å¡Š | åŠŸèƒ½ |
|------|------|
| åŸºæœ¬è³‡è¨Š | æ’ç¨‹ä¸»æª”è³‡è¨Šç·¨è¼¯ |
| æ’ç¨‹é …ç›® | ä½¿ç”¨ InteractiveTableComponent ç®¡ç†æˆå“é …ç›® |
| è¨‚å–®åˆ†é…æ˜ç´° | å¯å±•é–‹æŸ¥çœ‹è©²é …ç›®ä¾†è‡ªå“ªäº›è¨‚å–®ï¼ˆå”¯è®€ï¼‰ |
| BOM çµ„ä»¶å±•é–‹ | è‡ªå‹•å¾ ProductCompositionDetail å±•é–‹ï¼Œé¡¯ç¤ºåº«å­˜ç‹€æ…‹ |
| åº«å­˜è­¦ç¤º | çµ„ä»¶åº«å­˜ä¸è¶³æ™‚é¡¯ç¤ºè­¦ç¤ºï¼Œä½¿ç”¨è€…å¯é¸æ“‡ç¹¼çºŒæˆ–å–æ¶ˆ |

---

### 3. éŠ·è²¨è¨‚å–® BOM ç·¨è¼¯ï¼ˆæ–°å¢è½‰æ’ç¨‹åŠŸèƒ½ï¼‰

**æª”æ¡ˆè·¯å¾‘**ï¼š`Components/Shared/BaseModal/Modals/Sales/SalesOrderCompositionEditModal.razor`

#### æ–°å¢æŒ‰éˆ•

åœ¨ HeaderButtons å€åŸŸæ–°å¢ã€Œè½‰æ’ç¨‹ã€æŒ‰éˆ•ï¼š

```razor
<GenericButtonComponent Text="è½‰æ’ç¨‹"
                       Icon="bi bi-calendar-plus"
                       Variant="ButtonVariant.Success"
                       OnClick="@HandleTransferToSchedule"
                       IsDisabled="@(!CanTransferToSchedule())" />
```

#### åŠŸèƒ½æµç¨‹

1. æª¢æŸ¥æ˜¯å¦æœ‰åº«å­˜ä¸è¶³çš„çµ„ä»¶
2. å¦‚æœ‰ä¸è¶³ï¼Œé¡¯ç¤ºç¢ºèªå°è©±æ¡†
3. å»ºç«‹ ProductionSchedule + ProductionScheduleItem
4. å±•é–‹ BOM å»ºç«‹ ProductionScheduleDetail
5. å»ºç«‹ ProductionScheduleAllocation é—œè¯
6. å›å¯« SalesOrderDetail.ScheduledQuantity
7. é¡¯ç¤ºæˆåŠŸè¨Šæ¯

---

## å¯¦ä½œæ­¥é©Ÿè¦åŠƒ

### Phase 1ï¼šè³‡æ–™æ¨¡å‹å»ºç«‹

**é è¨ˆå·¥æ™‚**ï¼š6-8 å°æ™‚

| æ­¥é©Ÿ | æª”æ¡ˆ | èªªæ˜ |
|------|------|------|
| 1.1 | `Data/Enums/ProductionItemStatus.cs` | æ–°å¢ç”Ÿç”¢ç‹€æ…‹åˆ—èˆ‰ |
| 1.2 | `Data/Entities/ProductionManagement/ProductionScheduleItem.cs` | æ–°å¢æ’ç¨‹é …ç›®å¯¦é«” |
| 1.3 | `Data/Entities/ProductionManagement/ProductionScheduleAllocation.cs` | æ–°å¢è¨‚å–®åˆ†é…å¯¦é«” |
| 1.4 | `Data/Entities/ProductionManagement/ProductionScheduleCompletion.cs` | æ–°å¢å…¥åº«è¨˜éŒ„å¯¦é«” |
| 1.5 | `Data/Entities/ProductionManagement/ProductionScheduleDetail.cs` | èª¿æ•´é—œè¯åˆ° Item |
| 1.6 | `Data/Entities/Sales/SalesOrderDetail.cs` | æ–°å¢ ScheduledQuantity æ¬„ä½ |
| 1.7 | `Data/Entities/Warehouses/InventoryStockDetail.cs` | æ–°å¢ InProductionStock æ¬„ä½ |
| 1.8 | `Data/Entities/Warehouses/InventoryStock.cs` | èª¿æ•´ TotalAvailableStock è¨ˆç®— |
| 1.9 | `Data/Context/AppDbContext.cs` | è¨»å†Šæ–°å¯¦é«” |
| 1.10 | `Migrations/` | å»ºç«‹ Migration |

### Phase 2ï¼šService å±¤å»ºç«‹

**é è¨ˆå·¥æ™‚**ï¼š6-8 å°æ™‚

| æ­¥é©Ÿ | æª”æ¡ˆ | èªªæ˜ |
|------|------|------|
| 2.1 | `Services/ProductionManagement/IProductionScheduleItemService.cs` | ä»‹é¢å®šç¾© |
| 2.2 | `Services/ProductionManagement/ProductionScheduleItemService.cs` | æœå‹™å¯¦ä½œ |
| 2.3 | `Services/ProductionManagement/IProductionScheduleAllocationService.cs` | ä»‹é¢å®šç¾© |
| 2.4 | `Services/ProductionManagement/ProductionScheduleAllocationService.cs` | æœå‹™å¯¦ä½œ |
| 2.5 | `Services/ProductionManagement/IProductionScheduleCompletionService.cs` | å…¥åº«è¨˜éŒ„ä»‹é¢ |
| 2.6 | `Services/ProductionManagement/ProductionScheduleCompletionService.cs` | å…¥åº«è¨˜éŒ„æœå‹™ |
| 2.7 | `Services/ProductionManagement/ProductionScheduleService.cs` | èª¿æ•´ç¾æœ‰æœå‹™ |
| 2.8 | `Services/ProductionManagement/IProductionTransferService.cs` | è½‰æ’ç¨‹ä»‹é¢ |
| 2.9 | `Services/ProductionManagement/ProductionTransferService.cs` | è½‰æ’ç¨‹æ¥­å‹™é‚è¼¯ |
| 2.10 | `Services/ProductionManagement/IProductionExecutionService.cs` | ç”Ÿç”¢åŸ·è¡Œä»‹é¢ï¼ˆé–‹å§‹ç”Ÿç”¢ã€å®Œæˆå…¥åº«ï¼‰ |
| 2.11 | `Services/ProductionManagement/ProductionExecutionService.cs` | ç”Ÿç”¢åŸ·è¡Œæœå‹™ |
| 2.12 | `Data/ServiceRegistration.cs` | è¨»å†Šæ–°æœå‹™ |

### Phase 3ï¼šå¾…æ’ç¨‹å·¥ä½œå°

**é è¨ˆå·¥æ™‚**ï¼š6-8 å°æ™‚ï¼ˆPhase 2 é€²éšåŠŸèƒ½ï¼Œå¯å»¶å¾Œï¼‰

| æ­¥é©Ÿ | æª”æ¡ˆ | èªªæ˜ |
|------|------|------|
| 3.1 | `Components/Pages/ProductionManagement/ProductionPendingWorkbench.razor` | é é¢å»ºç«‹ |
| 3.2 | `Services/ProductionManagement/PendingScheduleQueryService.cs` | å¾…æ’ç¨‹æŸ¥è©¢æœå‹™ |
| 3.3 | ç¯©é¸åŠŸèƒ½ | äº¤æœŸã€å®¢æˆ¶ã€ç”¢å“ç¯©é¸ |
| 3.4 | å‹¾é¸åŠŸèƒ½ | å¤šé¸é …ç›® |
| 3.5 | è½‰æ’ç¨‹åŠŸèƒ½ | å€‹åˆ¥/åˆä½µå»ºç«‹ |

### Phase 4ï¼šç”Ÿç”¢æ’ç¨‹ç·¨è¼¯å¢å¼·

**é è¨ˆå·¥æ™‚**ï¼š8-10 å°æ™‚

| æ­¥é©Ÿ | æª”æ¡ˆ | èªªæ˜ |
|------|------|------|
| 4.1 | `ProductionScheduleEditModalComponent.razor` | é‡æ§‹ç¾æœ‰çµ„ä»¶ |
| 4.2 | æ’ç¨‹é …ç›®è¡¨æ ¼ | ä½¿ç”¨ InteractiveTableComponent |
| 4.3 | è¨‚å–®åˆ†é…å±•é–‹ | å¯å±•é–‹/æ”¶åˆçš„å­è¡¨æ ¼ |
| 4.4 | BOM å±•é–‹é¡¯ç¤º | è‡ªå‹•å±•é–‹ä¸¦é¡¯ç¤ºåº«å­˜ç‹€æ…‹ |
| 4.5 | åº«å­˜è­¦ç¤ºè™•ç† | ä¸è¶³æ™‚æç¤ºç¢ºèª |

### Phase 5ï¼šè½‰æ’ç¨‹åŠŸèƒ½æ•´åˆ

**é è¨ˆå·¥æ™‚**ï¼š6-8 å°æ™‚

| æ­¥é©Ÿ | æª”æ¡ˆ | èªªæ˜ |
|------|------|------|
| 5.1 | `Components/Shared/BaseModal/Modals/ProductionManagement/TransferToScheduleModal.razor` | æ–°å¢ï¼šå–®ä¸€æ˜ç´°è½‰æ’ç¨‹ç¢ºèª Modal |
| 5.2 | `Components/Shared/BaseModal/Modals/ProductionManagement/BatchTransferToScheduleModal.razor` | æ–°å¢ï¼šæ‰¹æ¬¡è½‰æ’ç¨‹ç¢ºèª Modal |
| 5.3 | `SalesOrderCompositionEditModal.razor` | ä¿®æ”¹ï¼šæ–°å¢ã€Œè½‰æ’ç¨‹ã€æŒ‰éˆ•ï¼ˆå…¥å£é» Aï¼‰ |
| 5.4 | `SalesOrderEditModalComponent.razor` | ä¿®æ”¹ï¼šæ–°å¢ã€Œè½‰æ’ç¨‹ã€æŒ‰éˆ•ï¼ˆå…¥å£é» Bï¼‰ |
| 5.5 | è½‰æ’ç¨‹é‚è¼¯ | å‘¼å« ProductionTransferService |
| 5.6 | å›å¯«è¨‚å–® | æ›´æ–° ScheduledQuantity |
| 5.7 | éƒ¨åˆ†æ’ç¨‹æ”¯æ´ | å…è¨±ä½¿ç”¨è€…è¼¸å…¥æœ¬æ¬¡æ’ç¨‹æ•¸é‡ |

### Phase 6ï¼šç‹€æ…‹è§¸ç™¼æ©Ÿåˆ¶

**é è¨ˆå·¥æ™‚**ï¼š4-6 å°æ™‚

| æ­¥é©Ÿ | æª”æ¡ˆ | èªªæ˜ |
|------|------|------|
| 6.1 | å…¥åº«å–®æ•´åˆ | å…¥åº«æ™‚è§¸ç™¼ç‹€æ…‹è®Šæ›´ |
| 6.2 | ç‹€æ…‹æ›´æ–°æœå‹™ | ProductionStatusUpdateService |
| 6.3 | å·²å®Œæˆæ•¸é‡æ›´æ–° | æ›´æ–° CompletedQuantity |

---

## ç›¸é—œæª”æ¡ˆæ¸…å–®

### ç¾æœ‰æª”æ¡ˆï¼ˆéœ€èª¿æ•´ï¼‰

| æª”æ¡ˆè·¯å¾‘ | èª¿æ•´å…§å®¹ |
|---------|---------|
| `Data/Entities/ProductionManagement/ProductionSchedule.cs` | æ–°å¢ Items å°èˆªå±¬æ€§ |
| `Data/Entities/ProductionManagement/ProductionScheduleDetail.cs` | æ”¹é—œè¯åˆ° ProductionScheduleItem |
| `Data/Entities/Sales/SalesOrderDetail.cs` | æ–°å¢ ScheduledQuantity |
| `Data/Context/AppDbContext.cs` | è¨»å†Šæ–°å¯¦é«”ã€è¨­å®šé—œè¯ |
| `Services/ProductionManagement/ProductionScheduleService.cs` | èª¿æ•´æŸ¥è©¢åŒ…å« Items |
| `Components/Pages/ProductionManagement/ProductionScheduleEditModalComponent.razor` | é‡æ§‹ UI |
| `Components/Shared/BaseModal/Modals/Sales/SalesOrderCompositionEditModal.razor` | æ–°å¢è½‰æ’ç¨‹æŒ‰éˆ• |

### æ–°å¢æª”æ¡ˆ

| æª”æ¡ˆè·¯å¾‘ | èªªæ˜ |
|---------|------|
| `Data/Enums/ProductionItemStatus.cs` | ç”Ÿç”¢ç‹€æ…‹åˆ—èˆ‰ |
| `Data/Entities/ProductionManagement/ProductionScheduleItem.cs` | æ’ç¨‹é …ç›®å¯¦é«” |
| `Data/Entities/ProductionManagement/ProductionScheduleAllocation.cs` | è¨‚å–®åˆ†é…å¯¦é«” |
| `Data/Entities/ProductionManagement/ProductionScheduleCompletion.cs` | å…¥åº«è¨˜éŒ„å¯¦é«” |
| `Services/ProductionManagement/IProductionScheduleItemService.cs` | æœå‹™ä»‹é¢ |
| `Services/ProductionManagement/ProductionScheduleItemService.cs` | æœå‹™å¯¦ä½œ |
| `Services/ProductionManagement/IProductionScheduleAllocationService.cs` | æœå‹™ä»‹é¢ |
| `Services/ProductionManagement/ProductionScheduleAllocationService.cs` | æœå‹™å¯¦ä½œ |
| `Services/ProductionManagement/IProductionScheduleCompletionService.cs` | å…¥åº«è¨˜éŒ„ä»‹é¢ |
| `Services/ProductionManagement/ProductionScheduleCompletionService.cs` | å…¥åº«è¨˜éŒ„æœå‹™ |
| `Services/ProductionManagement/IProductionTransferService.cs` | è½‰æ’ç¨‹æœå‹™ä»‹é¢ |
| `Services/ProductionManagement/ProductionTransferService.cs` | è½‰æ’ç¨‹æœå‹™å¯¦ä½œ |
| `Services/ProductionManagement/IProductionExecutionService.cs` | ç”Ÿç”¢åŸ·è¡Œä»‹é¢ |
| `Services/ProductionManagement/ProductionExecutionService.cs` | ç”Ÿç”¢åŸ·è¡Œæœå‹™ï¼ˆé–‹å§‹ç”Ÿç”¢ã€å®Œæˆå…¥åº«ã€åº«å­˜è™•ç†ï¼‰ |
| `Services/ProductionManagement/IPendingScheduleQueryService.cs` | å¾…æ’ç¨‹æŸ¥è©¢ä»‹é¢ |
| `Services/ProductionManagement/PendingScheduleQueryService.cs` | å¾…æ’ç¨‹æŸ¥è©¢æœå‹™ |
| `Components/Pages/ProductionManagement/ProductionPendingWorkbench.razor` | å¾…æ’ç¨‹å·¥ä½œå°é é¢ï¼ˆPhase 2ï¼‰ |
| `Components/Shared/BaseModal/Modals/ProductionManagement/TransferToScheduleModal.razor` | å–®ä¸€æ˜ç´°è½‰æ’ç¨‹ç¢ºèª Modal |
| `Components/Shared/BaseModal/Modals/ProductionManagement/BatchTransferToScheduleModal.razor` | æ‰¹æ¬¡è½‰æ’ç¨‹ç¢ºèª Modal |
| `Components/Shared/BaseModal/Modals/ProductionManagement/StartProductionModal.razor` | é–‹å§‹ç”Ÿç”¢ç¢ºèª Modal |
| `Components/Shared/BaseModal/Modals/ProductionManagement/ProductionCompletionModal.razor` | å®Œæˆå…¥åº« Modal |

---

## è½‰æ’ç¨‹è³‡æ–™ä¾†æºèªªæ˜

### é—œéµå•é¡Œï¼šæ’ç¨‹å¦‚ä½•çŸ¥é“è¦è£½ä½œä»€éº¼ï¼Ÿ

ç•¶å¾éŠ·è²¨è¨‚å–®è½‰æ’ç¨‹æ™‚ï¼Œç³»çµ±éœ€è¦çŸ¥é“ï¼š
1. **è¦ç”Ÿç”¢ä»€éº¼æˆå“ï¼Ÿ** â†’ ä¾†è‡ª `SalesOrderDetail.ProductId`
2. **éœ€è¦å¤šå°‘æ•¸é‡ï¼Ÿ** â†’ ä¾†è‡ª `SalesOrderDetail.Quantity`
3. **éœ€è¦å“ªäº›çµ„ä»¶ï¼Ÿ** â†’ ä¾†è‡ª `SalesOrderCompositionDetail`ï¼ˆå®¢è£½ BOMï¼‰

### è³‡æ–™ä¾†æºï¼šSalesOrderCompositionDetail

```
SalesOrderDetail (è¨‚å–®æ˜ç´°)
â”‚
â”œâ”€ ProductId = æˆå“X (è¦ç”Ÿç”¢çš„æˆå“)
â”œâ”€ Quantity = 100 (ç”Ÿç”¢æ•¸é‡)
â”‚
â””â”€â”€ SalesOrderCompositionDetail (è©²è¨‚å–®çš„å®¢è£½ BOM)
        â”œâ”€ ComponentProductId = åŸæ–™A, Quantity = 2 (æ¯å€‹æˆå“éœ€è¦ 2 å€‹)
        â”œâ”€ ComponentProductId = åŸæ–™B, Quantity = 1.5
        â””â”€ ComponentProductId = åŠæˆå“C, Quantity = 1
```

### è½‰æ›è¨ˆç®—å…¬å¼

```
çµ„ä»¶éœ€æ±‚æ•¸é‡ = SalesOrderCompositionDetail.Quantity Ã— SalesOrderDetail.Quantity

ç¯„ä¾‹ï¼š
- æˆå“X éœ€è¦ç”Ÿç”¢ 100 å€‹
- æ¯å€‹æˆå“X éœ€è¦ 2 å€‹åŸæ–™A
- ç¸½å…±éœ€è¦åŸæ–™A = 2 Ã— 100 = 200 å€‹
```

### å®Œæ•´è½‰æ›æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: ä½¿ç”¨è€…åœ¨ SalesOrderCompositionEditModal é»æ“Šã€Œè½‰æ’ç¨‹ã€           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: ç³»çµ±è®€å– SalesOrderDetail + SalesOrderCompositionDetail         â”‚
â”‚                                                                         â”‚
â”‚   SalesOrderDetail:                                                     â”‚
â”‚   â”œâ”€ Id = 123                                                          â”‚
â”‚   â”œâ”€ ProductId = æˆå“X (Id: 1)                                         â”‚
â”‚   â””â”€ Quantity = 100                                                    â”‚
â”‚                                                                         â”‚
â”‚   SalesOrderCompositionDetail (where SalesOrderDetailId = 123):        â”‚
â”‚   â”œâ”€ { ComponentProductId: åŸæ–™A, Quantity: 2 }                        â”‚
â”‚   â”œâ”€ { ComponentProductId: åŸæ–™B, Quantity: 1.5 }                      â”‚
â”‚   â””â”€ { ComponentProductId: åŠæˆå“C, Quantity: 1 }                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: æŸ¥è©¢åº«å­˜ï¼Œè¨ˆç®—æ·¨éœ€æ±‚ï¼ˆä¾›ä½¿ç”¨è€…åƒè€ƒï¼‰                              â”‚
â”‚                                                                         â”‚
â”‚   æˆå“X:                                                                â”‚
â”‚   â”œâ”€ éœ€æ±‚: 100                                                         â”‚
â”‚   â”œâ”€ ç¾æœ‰åº«å­˜: 30                                                      â”‚
â”‚   â””â”€ ç¼ºå£: 70 (éœ€è¦ç”Ÿç”¢)                                                â”‚
â”‚                                                                         â”‚
â”‚   çµ„ä»¶åº«å­˜ç‹€æ…‹:                                                         â”‚
â”‚   â”œâ”€ åŸæ–™A: éœ€æ±‚ 200, åº«å­˜ 500 âœ…                                       â”‚
â”‚   â”œâ”€ åŸæ–™B: éœ€æ±‚ 150, åº«å­˜ 100 âš ï¸ ä¸è¶³ 50                              â”‚
â”‚   â””â”€ åŠæˆå“C: éœ€æ±‚ 100, åº«å­˜ 50 âš ï¸ ä¸è¶³ 50                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: å»ºç«‹æ’ç¨‹è³‡æ–™                                                    â”‚
â”‚                                                                         â”‚
â”‚   ProductionSchedule (ä¸»æª”):                                            â”‚
â”‚   â”œâ”€ Code = "PS2024-001"                                               â”‚
â”‚   â”œâ”€ ScheduleDate = 2024/12/10                                         â”‚
â”‚   â””â”€ SourceDocumentType = "SalesOrder", SourceDocumentId = è¨‚å–®ID      â”‚
â”‚                                                                         â”‚
â”‚   ProductionScheduleItem (æ’ç¨‹é …ç›®):                                    â”‚
â”‚   â”œâ”€ ProductId = æˆå“X                                                 â”‚
â”‚   â”œâ”€ TotalRequiredQuantity = 100                                       â”‚
â”‚   â”œâ”€ CurrentStockQuantity = 30 (å¿«ç…§)                                  â”‚
â”‚   â””â”€ ProductionStatus = Pending                                        â”‚
â”‚                                                                         â”‚
â”‚   ProductionScheduleAllocation (è¨‚å–®è¿½æº¯):                              â”‚
â”‚   â””â”€ SalesOrderDetailId = 123, Quantity = 100                          â”‚
â”‚                                                                         â”‚
â”‚   ProductionScheduleDetail (çµ„ä»¶éœ€æ±‚):                                  â”‚
â”‚   â”œâ”€ { ComponentProductId: åŸæ–™A, RequiredQuantity: 200 }              â”‚
â”‚   â”œâ”€ { ComponentProductId: åŸæ–™B, RequiredQuantity: 150 }              â”‚
â”‚   â””â”€ { ComponentProductId: åŠæˆå“C, RequiredQuantity: 100 }            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: å›å¯«è¨‚å–®æ˜ç´°çš„å·²æ’ç¨‹æ•¸é‡                                         â”‚
â”‚                                                                         â”‚
â”‚   SalesOrderDetail.ScheduledQuantity += 100                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è½‰æ’ç¨‹æœå‹™æ ¸å¿ƒé‚è¼¯ï¼ˆè™›æ“¬ç¢¼ï¼‰

```csharp
public class ProductionTransferService
{
    /// <summary>
    /// å¾éŠ·è²¨è¨‚å–®æ˜ç´°å»ºç«‹ç”Ÿç”¢æ’ç¨‹
    /// </summary>
    public async Task<ProductionSchedule> CreateFromSalesOrderDetailAsync(
        int salesOrderDetailId,
        decimal? overrideQuantity = null)  // å¯é¸ï¼šè¦†è“‹æ•¸é‡ï¼ˆéƒ¨åˆ†æ’ç¨‹ç”¨ï¼‰
    {
        // 1. è¼‰å…¥è¨‚å–®æ˜ç´°
        var orderDetail = await _salesOrderDetailService.GetByIdAsync(salesOrderDetailId);
        var quantity = overrideQuantity ?? orderDetail.Quantity;
        
        // 2. è¼‰å…¥è©²æ˜ç´°çš„ BOM çµ„æˆ
        var compositionDetails = await _salesOrderCompositionDetailService
            .GetBySalesOrderDetailIdAsync(salesOrderDetailId);
        
        // 3. æŸ¥è©¢åº«å­˜ï¼ˆä¾›åƒè€ƒï¼‰
        var productStock = await _inventoryStockService
            .GetTotalStockByProductIdAsync(orderDetail.ProductId);
        
        // 4. å»ºç«‹æ’ç¨‹ä¸»æª”
        var schedule = new ProductionSchedule
        {
            Code = await GenerateScheduleCode(),
            ScheduleDate = DateTime.Today,
            CustomerId = orderDetail.SalesOrder.CustomerId,
            SourceDocumentType = "SalesOrderDetail",
            SourceDocumentId = salesOrderDetailId
        };
        
        // 5. å»ºç«‹æ’ç¨‹é …ç›®ï¼ˆæˆå“å±¤ç´šï¼‰
        var scheduleItem = new ProductionScheduleItem
        {
            ProductId = orderDetail.ProductId,
            TotalRequiredQuantity = quantity,
            CurrentStockQuantity = productStock,  // å¿«ç…§
            ProductionStatus = ProductionItemStatus.Pending
        };
        
        // 6. å»ºç«‹è¨‚å–®è¿½æº¯
        scheduleItem.Allocations.Add(new ProductionScheduleAllocation
        {
            SalesOrderDetailId = salesOrderDetailId,
            Quantity = quantity
        });
        
        // 7. å±•é–‹ BOM å»ºç«‹çµ„ä»¶éœ€æ±‚
        foreach (var comp in compositionDetails)
        {
            scheduleItem.ScheduleDetails.Add(new ProductionScheduleDetail
            {
                ComponentProductId = comp.ComponentProductId,
                RequiredQuantity = comp.Quantity * quantity,  // é—œéµè¨ˆç®—
                ProductCompositionDetailId = comp.ProductCompositionDetailId
            });
        }
        
        schedule.Items.Add(scheduleItem);
        
        // 8. å„²å­˜
        await _productionScheduleService.CreateAsync(schedule);
        
        // 9. å›å¯«è¨‚å–®æ˜ç´°çš„å·²æ’ç¨‹æ•¸é‡
        orderDetail.ScheduledQuantity += quantity;
        await _salesOrderDetailService.UpdateAsync(orderDetail);
        
        return schedule;
    }
}
```

### ç›¸é—œå¯¦é«”é—œè¯åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    SalesOrder       â”‚     â”‚ ProductionSchedule  â”‚
â”‚    (éŠ·è²¨è¨‚å–®)        â”‚     â”‚   (ç”Ÿç”¢æ’ç¨‹)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ 1:N                       â”‚ 1:N
           â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SalesOrderDetail   â”‚â”€â”€â”€â”€â†’â”‚ ProductionScheduleItem  â”‚
â”‚   (è¨‚å–®æ˜ç´°)         â”‚     â”‚    (æ’ç¨‹é …ç›®)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ 1:N                  â”‚ 1:N     â”‚ 1:N
           â–¼                      â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚SalesOrderCompositionDetailâ”‚  â”‚Schedule  â”‚  â”‚ProductionScheduleAllocationâ”‚
â”‚   (è¨‚å–®å®¢è£½ BOM)          â”‚â”€â”€â†’â”‚Detail    â”‚  â”‚     (è¨‚å–®è¿½æº¯)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚(çµ„ä»¶éœ€æ±‚) â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç‚ºä»€éº¼ä½¿ç”¨ SalesOrderCompositionDetail è€Œé ProductCompositionDetailï¼Ÿ

| æ¯”è¼ƒé …ç›® | ProductCompositionDetail | SalesOrderCompositionDetail |
|---------|-------------------------|----------------------------|
| ä¾†æº | å•†å“ä¸»æª”çš„æ¨™æº– BOM | è¨‚å–®ä¸Šçš„å®¢è£½ BOM |
| ç‰¹æ€§ | å…¨åŸŸå…±ç”¨ | è¨‚å–®å°ˆå±¬ |
| éˆæ´»æ€§ | å›ºå®šé…æ–¹ | å¯ä¾å®¢æˆ¶éœ€æ±‚èª¿æ•´ |
| é©ç”¨å ´æ™¯ | æ¨™æº–åŒ–ç”Ÿç”¢ | å®¢è£½åŒ–ç”Ÿç”¢ |

**çµè«–**ï¼šæ¡ç”¨ `SalesOrderCompositionDetail` å¯æ”¯æ´å®¢è£½åŒ– BOMï¼Œæ›´ç¬¦åˆå¯¦éš›æ¥­å‹™éœ€æ±‚ã€‚

---

## åº«å­˜èˆ‡ç”Ÿç”¢æµç¨‹è¨­è¨ˆ

### åº«å­˜æ¬„ä½èªªæ˜

```
InventoryStockDetail
â”œâ”€ CurrentStock        // ç¾æœ‰åº«å­˜ï¼ˆå¯¦éš›åœ¨å€‰åº«çš„æ•¸é‡ï¼‰
â”œâ”€ ReservedStock       // é ç•™åº«å­˜ï¼ˆå·²è¢«è¨‚å–®é ç•™ï¼‰
â”œâ”€ InProductionStock   // ç”Ÿç”¢ä¸­åº«å­˜ï¼ˆå·²é ˜æ–™ï¼Œç”Ÿç”¢ä¸­ï¼‰â† æ–°å¢
â”œâ”€ InTransitStock      // åœ¨é€”åº«å­˜ï¼ˆæ¡è³¼ä¸­ï¼‰
â””â”€ AvailableStock      // å¯ç”¨åº«å­˜ = Current - Reserved - InProduction
```

### ç”Ÿç”¢æµç¨‹èˆ‡åº«å­˜è®ŠåŒ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”Ÿç”¢æµç¨‹èˆ‡åº«å­˜è®ŠåŒ–                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: å»ºç«‹æ’ç¨‹ï¼ˆè½‰æ’ç¨‹ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ç‹€æ…‹ï¼šPendingï¼ˆå¾…ç”Ÿç”¢ï¼‰
åº«å­˜ï¼šç„¡è®ŠåŒ–

Step 2: é–‹å§‹ç”Ÿç”¢ï¼ˆé»æ“Šã€Œé–‹å§‹ç”Ÿç”¢ã€ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ç‹€æ…‹ï¼šInProgressï¼ˆè£½ä½œä¸­ï¼‰
åº«å­˜è®ŠåŒ–ï¼š
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ çµ„ä»¶ï¼ˆåŸæ–™Aï¼‰                            â”‚
  â”‚   CurrentStock:      500 â†’ 300  (-200) â”‚
  â”‚   InProductionStock:   0 â†’ 200  (+200) â”‚
  â”‚   AvailableStock:    500 â†’ 100         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  
  ğŸ’¡ åŸæ–™å¾ã€Œç¾æœ‰åº«å­˜ã€è½‰ç§»åˆ°ã€Œç”Ÿç”¢ä¸­åº«å­˜ã€

Step 3: å®Œæˆå…¥åº«ï¼ˆé»æ“Šã€Œå®Œæˆå…¥åº«ã€ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ç‹€æ…‹ï¼šCompletedï¼ˆå·²å…¥åº«ï¼‰
åº«å­˜è®ŠåŒ–ï¼š
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ çµ„ä»¶ï¼ˆåŸæ–™Aï¼‰                            â”‚
  â”‚   InProductionStock: 200 â†’ 0    (-200) â”‚ â† æ¶ˆè€—
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ æˆå“ï¼ˆæˆå“Xï¼‰                            â”‚
  â”‚   CurrentStock:        0 â†’ 100  (+100) â”‚ â† å…¥åº«
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### éƒ¨åˆ†å®Œæˆçš„è™•ç†

å¦‚æœç”Ÿç”¢ 100 å€‹æˆå“ï¼Œä½†åªå®Œæˆå…¥åº« 60 å€‹ï¼š

```
ç¬¬ä¸€æ¬¡å®Œæˆå…¥åº«ï¼ˆ60å€‹ï¼‰ï¼š
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
çµ„ä»¶æŒ‰æ¯”ä¾‹æ¸…é™¤ï¼š60/100 = 60%
  åŸæ–™A.InProductionStock: 200 â†’ 80  (-120ï¼Œå³ 200Ã—60%)
  
æˆå“å…¥åº«ï¼š
  æˆå“X.CurrentStock: 0 â†’ 60  (+60)

æ’ç¨‹ç‹€æ…‹ï¼šInProgressï¼ˆä»åœ¨è£½ä½œä¸­ï¼Œå› ç‚ºé‚„æœ‰ 40 å€‹æœªå®Œæˆï¼‰

ç¬¬äºŒæ¬¡å®Œæˆå…¥åº«ï¼ˆ40å€‹ï¼‰ï¼š
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
çµ„ä»¶æ¸…é™¤å‰©é¤˜ï¼š
  åŸæ–™A.InProductionStock: 80 â†’ 0  (-80)
  
æˆå“å…¥åº«ï¼š
  æˆå“X.CurrentStock: 60 â†’ 100  (+40)

æ’ç¨‹ç‹€æ…‹ï¼šCompletedï¼ˆå·²å…¥åº«ï¼Œ100/100 å®Œæˆï¼‰
```

### æ’ç¨‹é …ç›®æ“ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã€æ’ç¨‹é …ç›®æ“ä½œæŒ‰éˆ•é‚è¼¯ã€‘                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  ç‹€æ…‹ï¼šPendingï¼ˆå¾…ç”Ÿç”¢ï¼‰                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [é–‹å§‹ç”Ÿç”¢] â† é»æ“Šå¾Œï¼š                                           â”‚   â”‚
â”‚  â”‚   1. æª¢æŸ¥çµ„ä»¶åº«å­˜                                               â”‚   â”‚
â”‚  â”‚   2. é¡¯ç¤ºç¢ºèªå°è©±æ¡†ï¼ˆå«åº«å­˜ä¸è¶³è­¦å‘Šï¼‰                            â”‚   â”‚
â”‚  â”‚   3. ç¢ºèªå¾Œï¼šæ‰£é™¤çµ„ä»¶åº«å­˜ã€å¢åŠ ç”Ÿç”¢ä¸­ã€ç‹€æ…‹æ”¹ InProgress        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  ç‹€æ…‹ï¼šInProgressï¼ˆè£½ä½œä¸­ï¼‰                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [å®Œæˆå…¥åº«] â† é»æ“Šå¾Œï¼š                                           â”‚   â”‚
â”‚  â”‚   1. è¼¸å…¥å…¥åº«æ•¸é‡ã€é¸æ“‡å€‰åº«                                      â”‚   â”‚
â”‚  â”‚   2. ç¢ºèªå¾Œï¼š                                                   â”‚   â”‚
â”‚  â”‚      - æ¸…é™¤çµ„ä»¶ã€Œç”Ÿç”¢ä¸­ã€ï¼ˆæŒ‰æ¯”ä¾‹ï¼‰                              â”‚   â”‚
â”‚  â”‚      - å¢åŠ æˆå“åº«å­˜                                             â”‚   â”‚
â”‚  â”‚      - å»ºç«‹ ProductionScheduleCompletion è¨˜éŒ„                   â”‚   â”‚
â”‚  â”‚      - æ›´æ–° CompletedQuantity                                   â”‚   â”‚
â”‚  â”‚      - è‹¥å…¨éƒ¨å®Œæˆï¼Œç‹€æ…‹æ”¹ Completed                             â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚ [æŸ¥çœ‹é ˜æ–™] â† é¡¯ç¤ºå·²é ˜ç”¨çš„çµ„ä»¶æ¸…å–®                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  ç‹€æ…‹ï¼šCompletedï¼ˆå·²å…¥åº«ï¼‰                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [æŸ¥çœ‹è¨˜éŒ„] â† é¡¯ç¤ºæ‰€æœ‰å…¥åº«è¨˜éŒ„ï¼ˆProductionScheduleCompletionï¼‰   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ–°å¢å¯¦é«”ï¼šProductionScheduleCompletion

```csharp
/// <summary>
/// ç”Ÿç”¢å®Œæˆå…¥åº«è¨˜éŒ„ - è¨˜éŒ„æ¯æ¬¡å…¥åº«çš„è©³ç´°è³‡è¨Š
/// </summary>
[Index(nameof(ProductionScheduleItemId))]
public class ProductionScheduleCompletion : BaseEntity
{
    // é—œè¯
    [Required(ErrorMessage = "æ’ç¨‹é …ç›®ç‚ºå¿…å¡«")]
    [ForeignKey(nameof(ProductionScheduleItem))]
    public int ProductionScheduleItemId { get; set; }
    
    // å…¥åº«è³‡è¨Š
    [Required(ErrorMessage = "å…¥åº«æ•¸é‡ç‚ºå¿…å¡«")]
    [Display(Name = "å…¥åº«æ•¸é‡")]
    [Column(TypeName = "decimal(18,4)")]
    public decimal Quantity { get; set; }
    
    [Required(ErrorMessage = "å…¥åº«å€‰åº«ç‚ºå¿…å¡«")]
    [ForeignKey(nameof(Warehouse))]
    [Display(Name = "å…¥åº«å€‰åº«")]
    public int WarehouseId { get; set; }
    
    [Required]
    [Display(Name = "å…¥åº«æ—¥æœŸ")]
    public DateTime CompletionDate { get; set; } = DateTime.Today;
    
    [Display(Name = "å‚™è¨»")]
    [StringLength(500)]
    public string? Remarks { get; set; }
    
    // Navigation
    public ProductionScheduleItem ProductionScheduleItem { get; set; } = null!;
    public Warehouse Warehouse { get; set; } = null!;
}
```

### èª¿æ•´ç¾æœ‰å¯¦é«”

#### InventoryStockDetail - æ–°å¢ç”Ÿç”¢ä¸­åº«å­˜

```csharp
// æ–°å¢æ¬„ä½
[Display(Name = "ç”Ÿç”¢ä¸­åº«å­˜")]
public int InProductionStock { get; set; } = 0;

// èª¿æ•´å¯ç”¨åº«å­˜è¨ˆç®—
[Display(Name = "å¯ç”¨åº«å­˜")]
public int AvailableStock => CurrentStock - ReservedStock - InProductionStock;
```

#### InventoryStock - æ–°å¢åŠ ç¸½

```csharp
// æ–°å¢åŠ ç¸½å±¬æ€§
[Display(Name = "ç¸½ç”Ÿç”¢ä¸­åº«å­˜")]
[NotMapped]
public int TotalInProductionStock => InventoryStockDetails?.Sum(d => d.InProductionStock) ?? 0;

// èª¿æ•´ç¸½å¯ç”¨åº«å­˜
[Display(Name = "ç¸½å¯ç”¨åº«å­˜")]
[NotMapped]
public int TotalAvailableStock => TotalCurrentStock - TotalReservedStock - TotalInProductionStock;
```

---

## é™„éŒ„

### A. ç‹€æ…‹æµè½‰è¦å‰‡

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     å¾…ç”Ÿç”¢          â”‚
                    â”‚   (Pending)         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    [å…¥åº«å–®å»ºç«‹/é–‹å§‹ç”Ÿç”¢]
                               â”‚
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     è£½ä½œä¸­          â”‚
                    â”‚   (InProgress)      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    [å…¥åº«å–®å®Œæˆå…¥åº«]
                    [CompletedQty >= RequiredQty]
                               â”‚
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     å·²å…¥åº«          â”‚
                    â”‚   (Completed)       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### B. åº«å­˜æª¢æŸ¥é‚è¼¯

```csharp
// è™›æ“¬ç¢¼ï¼šæª¢æŸ¥çµ„ä»¶åº«å­˜
foreach (var component in bomDetails)
{
    var requiredQty = component.Quantity * productRequiredQty;
    var stockQty = GetCurrentStock(component.ComponentProductId);
    
    if (stockQty < requiredQty)
    {
        insufficientComponents.Add(new {
            Component = component,
            Required = requiredQty,
            Stock = stockQty,
            Shortage = requiredQty - stockQty
        });
    }
}

if (insufficientComponents.Any())
{
    // é¡¯ç¤ºè­¦ç¤ºå°è©±æ¡†ï¼Œè®“ä½¿ç”¨è€…é¸æ“‡ç¹¼çºŒæˆ–å–æ¶ˆ
    var result = await ShowConfirmDialog(
        "çµ„ä»¶åº«å­˜ä¸è¶³è­¦ç¤º",
        $"ä»¥ä¸‹ {insufficientComponents.Count} é …çµ„ä»¶åº«å­˜ä¸è¶³ï¼Œæ˜¯å¦ä»è¦å»ºç«‹æ’ç¨‹ï¼Ÿ"
    );
    
    if (!result) return;
}
```

### C. åˆä½µé‚è¼¯è™›æ“¬ç¢¼

```csharp
// è™›æ“¬ç¢¼ï¼šåˆä½µç›¸åŒç”¢å“
public async Task<List<ProductionSchedule>> CreateSchedulesWithMerge(
    List<SalesOrderDetail> selectedItems,
    bool mergeByProduct)
{
    if (!mergeByProduct)
    {
        // å€‹åˆ¥å»ºç«‹ï¼šæ¯å€‹é …ç›®ä¸€å¼µæ’ç¨‹å–®
        return await CreateIndividualSchedules(selectedItems);
    }
    
    // åˆä½µå»ºç«‹ï¼šç›¸åŒç”¢å“åˆä½µ
    var groupedByProduct = selectedItems
        .GroupBy(x => x.ProductId)
        .ToList();
    
    var schedule = new ProductionSchedule { ... };
    
    foreach (var group in groupedByProduct)
    {
        var item = new ProductionScheduleItem
        {
            ProductId = group.Key,
            TotalRequiredQuantity = group.Sum(x => x.Quantity),
            CurrentStockQuantity = GetCurrentStock(group.Key)
        };
        
        // å»ºç«‹åˆ†é…æ˜ç´°ï¼ˆè¿½æº¯ï¼‰
        foreach (var orderDetail in group)
        {
            item.Allocations.Add(new ProductionScheduleAllocation
            {
                SalesOrderDetailId = orderDetail.Id,
                Quantity = orderDetail.Quantity
            });
        }
        
        // å±•é–‹ BOM
        await ExpandBomDetails(item);
        
        schedule.Items.Add(item);
    }
    
    return new List<ProductionSchedule> { schedule };
}
```

---

## è®Šæ›´ç´€éŒ„

| æ—¥æœŸ | ç‰ˆæœ¬ | è®Šæ›´å…§å®¹ | ä½œè€… |
|------|------|---------|------|
| 2024/12/06 | v1.0 | åˆç‰ˆå»ºç«‹ | AI Assistant |

---

> **ä¸‹ä¸€æ­¥**ï¼šç¢ºèªæ­¤è¨­è¨ˆæ–‡ä»¶å¾Œï¼Œå³å¯é–‹å§‹ Phase 1 çš„è³‡æ–™æ¨¡å‹å»ºç«‹å·¥ä½œã€‚
