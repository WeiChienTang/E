# Index é é¢åˆ—å°å¯¦ä½œæŒ‡å—

## æ›´æ–°æ—¥æœŸ
2026-02-10

---

## ğŸ“‹ æ¶æ§‹æ¦‚è¿°

ç³»çµ±æä¾›å››å€‹å…¥å£é»å¯ä»¥å¯¦ç¾åˆ—å°åŠŸèƒ½ï¼Œæ¯å€‹å…¥å£é»æœ‰ä¸åŒçš„æµç¨‹ç‰¹æ€§ï¼š

| å…¥å£é» | æµç¨‹ | èªªæ˜ |
|--------|------|------|
| **å¿«æ·éµæŸ¥è©¢ (Alt+R)** | é¸æ“‡å ±è¡¨ â†’ ç¯©é¸ â†’ åˆ—å° | å…¨åŸŸå ±è¡¨æœå°‹ |
| **å ±è¡¨ä¸­å¿ƒ** | é¸æ“‡å ±è¡¨ â†’ ç¯©é¸ â†’ åˆ—å° | åˆ†é¡ç€è¦½å ±è¡¨ |
| **EditModal åˆ—å°** | ç›´æ¥åˆ—å° | å–®ç­†åˆ—å°ç•¶å‰å–®æ“š |
| **Index åˆ—å°** | ç¯©é¸ â†’ åˆ—å° | æ‰¹æ¬¡åˆ—å°ï¼Œä¸éœ€é¸æ“‡å ±è¡¨ |

---

## ğŸ—ï¸ å…¥å£é»æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         åˆ—å°åŠŸèƒ½å…¥å£é»                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  å…¥å£ Aï¼šå¿«æ·éµ Alt+R                å…¥å£ Bï¼šå ±è¡¨ä¸­å¿ƒ               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ GenericSearchModal  â”‚            â”‚ GenericReportIndex  â”‚        â”‚
â”‚  â”‚ (æœå°‹å ±è¡¨)           â”‚            â”‚ (å ±è¡¨æ¸…å–®)           â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚            â”‚ OnItemSelected                   â”‚ OnReportSelected   â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                         â†“                                           â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚            â”‚ GenericReportFilterModal   â”‚ â† æ ¹æ“š ReportId è¼‰å…¥     â”‚
â”‚            â”‚ (ç¯©é¸ â†’ é è¦½ â†’ åˆ—å°)       â”‚   å°æ‡‰çš„ FilterTemplate  â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  å…¥å£ Cï¼šEditModal åˆ—å°æŒ‰éˆ•          å…¥å£ Dï¼šIndex æ‰¹æ¬¡åˆ—å°         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ GenericEditModal    â”‚            â”‚ GenericIndexPage    â”‚        â”‚
â”‚  â”‚ ShowPrintButton     â”‚            â”‚ ShowBatchPrintButtonâ”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚            â”‚                                   â”‚                    â”‚
â”‚            â†“ å‘¼å« ReportService                â†“ é–‹å•Ÿ Modal        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ ReportPreviewModal  â”‚            â”‚ GenericReportFilterModalâ”‚    â”‚
â”‚  â”‚ (ç›´æ¥é è¦½ç•¶å‰å–®æ“š)   â”‚            â”‚ (ç¯©é¸ â†’ é è¦½ â†’ åˆ—å°)    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ Index é é¢åˆ—å°å¯¦ä½œæ­¥é©Ÿ

### å‰ç½®æ¢ä»¶

ç¢ºèªä»¥ä¸‹é …ç›®å·²å®Œæˆï¼š
1. âœ… å°æ‡‰çš„å ±è¡¨æœå‹™å·²å¯¦ä½œï¼ˆå¦‚ `IPurchaseOrderReportService`ï¼‰
2. âœ… ç¯©é¸æ¢ä»¶ DTO å·²å»ºç«‹ï¼ˆå¦‚ `PurchaseOrderBatchPrintCriteria`ï¼‰
3. âœ… ç¯©é¸æ¨¡æ¿çµ„ä»¶å·²å»ºç«‹ï¼ˆå¦‚ `PurchaseOrderBatchFilterTemplate`ï¼‰
4. âœ… å·²åœ¨ `FilterTemplateRegistry` è¨»å†Šé…ç½®

---

### æ­¥é©Ÿ 1ï¼šåœ¨ Index é é¢å®£å‘Š Modal

```razor
@using ERPCore2.Models.Reports

@* æ‰¹æ¬¡åˆ—å°ç¯©é¸ Modal - ä½¿ç”¨ GenericReportFilterModalComponent çµ±ä¸€æ¶æ§‹ *@
<GenericReportFilterModalComponent IsVisible="@showBatchPrintModal"
                                  IsVisibleChanged="@((bool visible) => showBatchPrintModal = visible)"
                                  ReportId="@ReportIds.PurchaseOrder"
                                  OnPrintSuccess="@HandleBatchPrintSuccess" />
```

**åƒæ•¸èªªæ˜ï¼š**

| åƒæ•¸ | èªªæ˜ |
|------|------|
| `IsVisible` | æ§åˆ¶ Modal é¡¯ç¤º/éš±è— |
| `ReportId` | å ±è¡¨ IDï¼Œå°æ‡‰ FilterTemplateRegistry ä¸­çš„é…ç½® |
| `OnPrintSuccess` | åˆ—å°æˆåŠŸå¾Œçš„å›èª¿ï¼ˆé¸ç”¨ï¼‰ |

---

### æ­¥é©Ÿ 2ï¼šè¨­å®š Index é é¢åƒæ•¸

```razor
<GenericIndexPageComponent TEntity="PurchaseOrder" 
                          TService="IPurchaseOrderService"
                          ...
                          ShowBatchPrintButton="true"
                          OnBatchPrintClick="@HandleBatchPrintAsync">
</GenericIndexPageComponent>
```

---

### æ­¥é©Ÿ 3ï¼šå¯¦ä½œè™•ç†æ–¹æ³•

```csharp
@code {
    // æ‰¹æ¬¡åˆ—å° Modal ç‹€æ…‹
    private bool showBatchPrintModal = false;

    /// <summary>
    /// æ‰¹æ¬¡åˆ—å°æŒ‰éˆ•é»æ“Šè™•ç†
    /// </summary>
    private async Task HandleBatchPrintAsync()
    {
        try
        {
            // ç›´æ¥é–‹å•Ÿç¯©é¸ Modalï¼ˆä½¿ç”¨ GenericReportFilterModalComponentï¼‰
            showBatchPrintModal = true;
        }
        catch (Exception ex)
        {
            await ErrorHandlingHelper.HandlePageErrorAsync(ex, nameof(HandleBatchPrintAsync), GetType());
            await NotificationService.ShowErrorAsync("é–‹å•Ÿæ‰¹æ¬¡åˆ—å°è¦–çª—å¤±æ•—");
        }
    }

    /// <summary>
    /// åˆ—å°æˆåŠŸå¾Œè™•ç†ï¼ˆé¸ç”¨ï¼‰
    /// </summary>
    private void HandleBatchPrintSuccess()
    {
        showBatchPrintModal = false;
        StateHasChanged();
    }
}
```

---

## ğŸ”§ å®Œæ•´ç¯„ä¾‹ï¼šPurchaseOrderIndex.razor

```razor
@page "/purchase/orders"
@using ERPCore2.Models.Reports
@inject IPurchaseOrderService PurchaseOrderService
@inject INotificationService NotificationService
@rendermode InteractiveServer

<GenericIndexPageComponent TEntity="PurchaseOrder" 
                          TService="IPurchaseOrderService"
                          Service="@PurchaseOrderService"
                          ...
                          ShowBatchPrintButton="true"
                          OnBatchPrintClick="@HandleBatchPrintAsync">
</GenericIndexPageComponent>

@* æ‰¹æ¬¡åˆ—å°ç¯©é¸ Modal *@
<GenericReportFilterModalComponent IsVisible="@showBatchPrintModal"
                                  IsVisibleChanged="@((bool visible) => showBatchPrintModal = visible)"
                                  ReportId="@ReportIds.PurchaseOrder"
                                  OnPrintSuccess="@HandleBatchPrintSuccess" />

@code {
    private bool showBatchPrintModal = false;

    private async Task HandleBatchPrintAsync()
    {
        try
        {
            showBatchPrintModal = true;
        }
        catch (Exception ex)
        {
            await ErrorHandlingHelper.HandlePageErrorAsync(ex, nameof(HandleBatchPrintAsync), GetType());
            await NotificationService.ShowErrorAsync("é–‹å•Ÿæ‰¹æ¬¡åˆ—å°è¦–çª—å¤±æ•—");
        }
    }

    private void HandleBatchPrintSuccess()
    {
        showBatchPrintModal = false;
        StateHasChanged();
    }
}
```

---

## ğŸ“Š å ±è¡¨ ID å°ç…§è¡¨

> **é‡è¦**ï¼šæ‰€æœ‰å ±è¡¨ ID å®šç¾©æ–¼ `Models/Reports/ReportIds.cs`ã€‚ä½¿ç”¨ç¨‹å¼ç¢¼æ™‚å¿…é ˆä½¿ç”¨å¸¸æ•¸ï¼Œç¦æ­¢ç›´æ¥å¯«æ­»å­—ä¸²ã€‚

| æ¨¡çµ„ | Index é é¢ | å ±è¡¨ ID å¸¸æ•¸ | ç¯©é¸æ¨¡æ¿ |
|------|-----------|---------|----------|
| æ¡è³¼ | PurchaseOrderIndex | `ReportIds.PurchaseOrder` | PurchaseOrderBatchFilterTemplate |
| æ¡è³¼ | PurchaseReceivingIndex | `ReportIds.PurchaseReceiving` | ï¼ˆå¾…å»ºç«‹ï¼‰ |
| æ¡è³¼ | PurchaseReturnIndex | `ReportIds.PurchaseReturn` | ï¼ˆå¾…å»ºç«‹ï¼‰ |
| éŠ·å”® | SalesOrderIndex | `ReportIds.SalesOrder` | ï¼ˆå¾…å»ºç«‹ï¼‰ |
| éŠ·å”® | SalesReturnIndex | `ReportIds.SalesReturn` | ï¼ˆå¾…å»ºç«‹ï¼‰ |
| éŠ·å”® | QuotationIndex | `ReportIds.Quotation` | ï¼ˆå¾…å»ºç«‹ï¼‰ |

---

## âš ï¸ å¸¸è¦‹éŒ¯èª¤èˆ‡è§£æ±ºæ–¹æ¡ˆ

### éŒ¯èª¤ 1ï¼šæ‰¾ä¸åˆ°å ±è¡¨é…ç½®

**ç—‡ç‹€**ï¼šç¯©é¸ Modal é¡¯ç¤ºã€Œæ‰¾ä¸åˆ°å ±è¡¨ IDã€ŒXXXã€çš„ç¯©é¸é…ç½®ã€

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. ç¢ºèª `FilterTemplateRegistry.cs` çš„ `Initialize()` ä¸­å·²è¨»å†Šé…ç½®
2. ç¢ºèª `FilterTemplateTypeName` æ˜¯å®Œæ•´çš„é¡åˆ¥åç¨±

```csharp
// FilterTemplateRegistry.cs
RegisterConfig(new ReportFilterConfig
{
    ReportId = ReportIds.PurchaseOrder,
    FilterTemplateTypeName = "ERPCore2.Components.Shared.Report.FilterTemplates.PurchaseOrderBatchFilterTemplate",
    // ...
});
```

### éŒ¯èª¤ 2ï¼šåˆ—å°çµæœç‚ºç©º

**ç—‡ç‹€**ï¼šé è¦½æ™‚æ²’æœ‰ä»»ä½•å ±è¡¨

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. ç¢ºèªç¯©é¸æ¢ä»¶ DTO çš„ `ToQueryParameters()` æ­£ç¢ºè½‰æ›æ¢ä»¶
2. ç¢ºèªå ±è¡¨æœå‹™çš„ `GetByCriteriaAsync()` æ­£ç¢ºè™•ç†ç¯©é¸æ¢ä»¶

### éŒ¯èª¤ 3ï¼šé è¦½åœ–ç‰‡ç”¢ç”Ÿå¤±æ•—

**ç—‡ç‹€**ï¼šLoading çµæŸå¾Œæ²’æœ‰é¡¯ç¤ºé è¦½

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. ç¢ºèª `ReportFilterConfig.ReportServiceType` è¨­å®šæ­£ç¢º
2. ç¢ºèªå ±è¡¨æœå‹™å¯¦ä½œäº† `RenderBatchToImagesAsync()` æ–¹æ³•

---

## ğŸ”„ æµç¨‹åœ–

```
Index æ‰¹æ¬¡åˆ—å°æµç¨‹ï¼š

1. é»æ“Šã€Œæ‰¹æ¬¡åˆ—å°ã€æŒ‰éˆ•
   â†“
2. é–‹å•Ÿ GenericReportFilterModalComponent
   â†“ å‚³å…¥ ReportIdï¼ˆå¦‚ "PO001"ï¼‰
   â†“
3. Modal å¾ FilterTemplateRegistry è¼‰å…¥é…ç½®
   â†“
4. å‹•æ…‹è¼‰å…¥ç¯©é¸æ¨¡æ¿çµ„ä»¶ï¼ˆå¦‚ PurchaseOrderBatchFilterTemplateï¼‰
   â†“
5. ä½¿ç”¨è€…è¨­å®šç¯©é¸æ¢ä»¶
   â†“
6. é»æ“Šã€Œé è¦½åˆ—å°ã€
   â†“
7. å¾æ¨¡æ¿å–å¾— IReportFilterCriteria
   â†“
8. è½‰æ›ç‚º BatchPrintCriteria
   â†“
9. å‘¼å«å ±è¡¨æœå‹™ RenderBatchToImagesAsync
   â†“
10. é–‹å•Ÿ ReportPreviewModalComponent é¡¯ç¤ºé è¦½
   â†“
11. é»æ“Šã€Œåˆ—å°ã€æˆ–ã€Œå„²å­˜ã€å®Œæˆæ“ä½œ
```

---

## ğŸ“‹ å¯¦ä½œæª¢æŸ¥æ¸…å–®

æ–°å¢ä¸€å€‹ Index åˆ—å°åŠŸèƒ½æ™‚ï¼Œç¢ºèªä»¥ä¸‹é …ç›®ï¼š

- [ ] **å ±è¡¨ ID å¸¸æ•¸**
  - åœ¨ `ReportIds.cs` æ–°å¢å¸¸æ•¸

- [ ] **ç¯©é¸æ¢ä»¶ DTO**
  - å»ºç«‹ `XxxBatchPrintCriteria.cs` ç¹¼æ‰¿ `IReportFilterCriteria`
  - å¯¦ä½œ `Validate()` å’Œ `ToQueryParameters()` æ–¹æ³•

- [ ] **ç¯©é¸æ¨¡æ¿çµ„ä»¶**
  - å»ºç«‹ `XxxBatchFilterTemplate.razor` å¯¦ä½œ `IFilterTemplateComponent`
  - å¯¦ä½œ `GetCriteria()` å’Œ `Reset()` æ–¹æ³•

- [ ] **è¨»å†Šé…ç½®**
  - åœ¨ `FilterTemplateRegistry.cs` çš„ `Initialize()` ä¸­æ–°å¢é…ç½®
  - è¨­å®š `FilterTemplateTypeName` ç‚ºå®Œæ•´é¡åˆ¥åç¨±
  - ç¢ºèª `ReportServiceType` è¨­å®šæ­£ç¢º

- [ ] **å ±è¡¨æœå‹™**
  - ç¢ºèªæœå‹™å¯¦ä½œäº†æ‰¹æ¬¡æ¸²æŸ“æ–¹æ³•

- [ ] **Index é é¢**
  - è¨­å®š `ShowBatchPrintButton="true"`
  - è¨­å®š `OnBatchPrintClick="@HandleBatchPrintAsync"`
  - æ”¾ç½® `GenericReportFilterModalComponent` ä¸¦ä½¿ç”¨ `ReportId="@ReportIds.Xxx"`

---

## ç›¸é—œæª”æ¡ˆ

- [README_å ±è¡¨ç³»çµ±ç¸½ç¶±.md](README_å ±è¡¨ç³»çµ±ç¸½ç¶±.md) - å ±è¡¨ç³»çµ±å…¥å£
- [README_å ±è¡¨ç¯©é¸æ¶æ§‹è¨­è¨ˆç¸½ç¶±.md](../Components/Shared/Report/README_å ±è¡¨ç¯©é¸æ¶æ§‹è¨­è¨ˆç¸½ç¶±.md) - ç¯©é¸æ¨¡æ¿æ©Ÿåˆ¶
- [README_å ±è¡¨ä¸­å¿ƒè¨­è¨ˆ.md](../Components/Pages/Reports/README_å ±è¡¨ä¸­å¿ƒè¨­è¨ˆ.md) - å ±è¡¨ä¸­å¿ƒå…¥å£
- [README_å ±è¡¨æª”è¨­è¨ˆç¸½ç¶±.md](README_å ±è¡¨æª”è¨­è¨ˆç¸½ç¶±.md) - å ±è¡¨æœå‹™èˆ‡åˆ—å°
