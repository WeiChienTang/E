# ERP系統 - 客戶端部署與更新指南

## 首次安裝步驟

### 1. 系統需求
- Windows 10/11 或 Windows Server 2016+
- SQL Server 2017 或更新版本
- 約 200MB 硬碟空間

### 2. 安裝流程

#### 步驟 1：解壓縮檔案
將整個資料夾解壓縮到指定位置（例如：`C:\ERP\`）

#### 步驟 2：設定資料庫連接
編輯 `appsettings.json`，修改資料庫連接字串：

```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Server=您的伺服器名稱;Database=ERPCore2;Trusted_Connection=True;TrustServerCertificate=True;"
  }
}
```

**連接字串範例：**
- 本機 SQL Server：`Server=localhost;Database=ERPCore2;Trusted_Connection=True;TrustServerCertificate=True;`
- 遠端伺服器：`Server=192.168.1.100;Database=ERPCore2;User Id=sa;Password=您的密碼;TrustServerCertificate=True;`

#### 步驟 3：執行資料庫設定
**雙擊執行 `setup.bat`**

這個工具會自動：
- 檢查資料庫連接
- 建立資料庫（如果不存在）
- 執行所有資料庫架構更新
- 初始化系統必要資料

#### 步驟 4：啟動系統
執行 `ERPCore2.exe` 啟動系統

預設登入資訊：
- 網址：`http://localhost:5000`
- 管理員帳號：（請詢問系統管理員）

---

## 系統更新步驟

當收到新版本的 ERP 系統時：

### 方案 A：自動更新（推薦）
1. 停止舊版系統
2. 備份整個資料夾（建議）
3. 用新版檔案覆蓋舊版
4. **直接啟動 ERPCore2.exe**

系統會自動偵測資料庫是否需要更新，並自動執行必要的架構變更。

### 方案 B：手動設定
如果您想確保資料庫更新成功：
1. 停止舊版系統
2. 備份資料庫（建議）
3. 用新版檔案覆蓋舊版
4. **執行 setup.bat**
5. 啟動 ERPCore2.exe

---

## 資料庫遷移說明

### 什麼是資料庫遷移？
當系統新增功能或修改資料結構時，需要更新資料庫的欄位、資料表等架構。這個過程稱為「資料庫遷移」。

### 系統如何處理遷移？

#### 自動模式（預設行為）
- 當您啟動 `ERPCore2.exe` 時，系統會自動檢查資料庫版本
- 如果發現資料庫版本較舊，會自動執行更新
- 更新完成後繼續正常啟動
- **優點**：完全自動化，使用者無感
- **注意**：第一次啟動新版本時可能需要多等待 10-30 秒

#### 手動模式（可選）
- 執行 `setup.bat` 進行獨立的資料庫設定
- **適用情境**：
  - 首次安裝系統
  - 重大版本更新
  - 需要確認資料庫更新狀態
  - 自動更新失敗時的備用方案

---

## 常見問題排解

### Q1：執行 setup.bat 顯示「無法連接資料庫」
**檢查項目：**
1. SQL Server 服務是否啟動
2. `appsettings.json` 連接字串是否正確
3. 防火牆是否阻擋連接
4. 資料庫使用者權限是否足夠

### Q2：啟動系統時顯示錯誤
**解決方式：**
1. 先執行 `setup.bat` 確保資料庫正確設定
2. 檢查 `Logs` 資料夾中的錯誤記錄
3. 確認 SQL Server 正常運作

### Q3：更新後資料消失
**預防措施：**
- 系統更新**不會**刪除資料
- 資料庫遷移只會修改資料結構，不會刪除現有資料
- 建議更新前備份資料庫以防萬一

### Q4：如何確認資料庫版本
執行 `setup.bat`，工具會顯示目前資料庫版本和待處理的更新

---

## 備份建議

### 定期備份
建議每天或每週備份 SQL Server 資料庫：

```sql
-- SQL Server Management Studio 中執行
BACKUP DATABASE ERPCore2 
TO DISK = 'C:\Backup\ERPCore2_20250101.bak'
WITH FORMAT, COMPRESSION;
```

### 更新前備份
在執行系統更新前：
1. 備份整個程式資料夾
2. 備份 SQL Server 資料庫
3. 確認備份檔案可以正常還原

---

## 技術支援

如遇到無法解決的問題，請聯繫技術支援並提供：
1. 錯誤訊息截圖
2. `Logs` 資料夾中的最新記錄檔
3. 系統版本號碼
4. SQL Server 版本資訊

---

**重要提醒：**
- 不要刪除或修改系統檔案（除了 `appsettings.json`）
- 資料庫連接字串中的密碼請妥善保管
- 定期備份資料以確保資料安全
